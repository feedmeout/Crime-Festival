<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Φάκελος Υπόθεσης - Φεστιβάλ Αστυνομικής Λογοτεχνίας 2025</title>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA_9_40aa_wO_19g-1bIrSB6742aMOPwjo",
            authDomain: "crime-festival-2025.firebaseapp.com",
            projectId: "crime-festival-2025",
            storageBucket: "crime-festival-2025.firebasestorage.app",
            messagingSenderId: "663770004335",
            appId: "1:663770004335:web:e42dbd983ab9b5277bc69a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

window.firebaseDB = db;
window.firebaseDoc = doc;
window.firebaseSetDoc = setDoc;
window.firebaseGetDoc = getDoc;
window.firebaseOnSnapshot = onSnapshot;
window.firebaseCollection = collection;
window.firebaseGetDocs = getDocs;
        
        console.log("✅ Firebase connected in index.html!");
    </script>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    min-height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    position: relative;
    overflow-x: hidden;
}

.animated-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.1;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,107,0,0.5) 35px, rgba(255,107,0,0.5) 70px);
    animation: slide 20s linear infinite;
}

@keyframes slide {
    0% { transform: translateX(0); }
    100% { transform: translateX(70px); }
}

.header {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    padding: clamp(20px, 4vw, 30px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    position: relative;
    z-index: 10;
    text-align: center;
}

.header h1 {
    color: #000;
    font-size: clamp(18px, 5vw, 32px);
    font-weight: bold;
    letter-spacing: clamp(1px, 0.3vw, 2px);
    text-shadow: 2px 2px 4px rgba(255,255,255,0.3);
    margin-bottom: 10px;
    word-wrap: break-word;
}

.header p {
    color: #1a1a1a;
    font-size: clamp(13px, 3vw, 16px);
    font-weight: bold;
}

.team-info {
    background: rgba(0,0,0,0.2);
    padding: clamp(8px, 2vw, 10px) clamp(15px, 3vw, 20px);
    border-radius: 8px;
    margin-top: 15px;
    display: block;
    max-width: 96%;
    margin-left: auto;
    margin-right: auto;
}

.team-info strong {
    color: #fff;
    font-size: clamp(12px, 2.5vw, 14px);
    text-transform: uppercase;
}

.logout-btn {
    position: absolute;
    top: clamp(15px, 3vw, 20px);
    right: clamp(10px, 2vw, 20px);
    padding: clamp(10px, 2vw, 12px) clamp(12px, 2.5vw, 20px);
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: clamp(11px, 2vw, 14px);
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(220,53,69,0.3);
    transition: all 0.2s ease;
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220,53,69,0.5);
}

.container {
    padding: clamp(20px, 4vw, 40px) clamp(15px, 3vw, 20px);
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

.timer-section {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #17a2b8;
    border-radius: 12px;
    padding: clamp(15px, 3vw, 20px);
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    display: none;
}

.timer-section h2 {
    color: #1a1a2e;
    font-size: clamp(14px, 3vw, 16px);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.timer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.timer-box {
    background: #f8f9fa;
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 8px;
    border-left: 4px solid #17a2b8;
    min-height: 70px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.timer-box strong {
    display: block;
    color: #0f3460;
    font-size: clamp(10px, 2vw, 11px);
    margin-bottom: 6px;
    text-transform: uppercase;
}

.timer-box .value {
    font-size: clamp(18px, 4vw, 20px);
    font-weight: bold;
    color: #17a2b8;
    font-family: monospace;
}

.tabs-container {
    margin-bottom: clamp(25px, 5vw, 40px);
}

.tabs-nav {
    display: flex;
    gap: 8px;
    margin-bottom: 25px;
    flex-wrap: wrap;
    background: rgba(0, 0, 0, 0.2);
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 12px;
}

.tab-button {
    flex: 1 1 auto;
    min-width: clamp(120px, 30%, 150px);
    padding: clamp(12px, 2.5vw, 15px) clamp(15px, 3vw, 20px);
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 107, 0, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: clamp(11px, 2.5vw, 14px);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.tab-button:hover,
.tab-button:focus {
    background: rgba(255, 107, 0, 0.2);
    border-color: rgba(255, 107, 0, 0.6);
    transform: translateY(-2px);
    outline: none;
}

.tab-button.active {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    border-color: #ff6b00;
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4);
    color: #000;
}

.intro-box,
.forensic-box,
.timeline-box,
.story-box {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(20px, 4vw, 30px);
    margin-bottom: clamp(25px, 5vw, 40px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.forensic-box {
    border-color: #28a745;
}

.timeline-box,
.story-box {
    border-color: #6c757d;
}

.intro-box h2,
.forensic-box h2,
.timeline-box h2,
.story-box h2 {
    color: #1a1a2e;
    font-size: clamp(16px, 3.5vw, 18px);
    text-transform: uppercase;
    border-bottom: 2px solid #000;
    padding-bottom: 8px;
    margin-bottom: clamp(15px, 3vw, 20px);
    letter-spacing: 1px;
}

.intro-box p,
.forensic-box p,
.timeline-box p,
.story-box p {
    color: #333;
    line-height: 1.7;
    font-size: clamp(13px, 2.8vw, 14px);
    margin: 12px 0;
    text-align: justify;
    word-wrap: break-word;
}

.intro-box p strong,
.forensic-box p strong {
    color: #000;
}

.red-highlight {
    color: #dc3545;
    font-weight: bold;
    background: rgba(220,53,69,0.1);
    padding: 2px 6px;
    border-radius: 3px;
}

.timeline-item {
    margin: 8px 0;
    padding-left: clamp(18px, 4vw, 20px);
    position: relative;
    color: #333;
    font-size: clamp(12px, 2.8vw, 13px);
    line-height: 1.6;
    text-align: justify;
    word-wrap: break-word;
}

.timeline-item::before {
    content: "◉";
    position: absolute;
    left: 0;
    font-size: 11px;
    color: #000;
}

.timeline-item strong {
    color: #1a1a2e;
    font-weight: 600;
}

.timeline-critical {
    color: #dc3545;
    font-weight: bold;
    background: rgba(220,53,69,0.1);
    padding: 2px 6px;
    border-radius: 3px;
}

.progress-bar-container {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(20px, 4vw, 25px);
    margin-bottom: clamp(25px, 5vw, 40px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.progress-title {
    color: #1a1a2e;
    font-size: clamp(16px, 4vw, 20px);
    margin-bottom: 15px;
    font-weight: bold;
}

.progress-bar {
    background: #e0e0e0;
    height: clamp(25px, 5vw, 30px);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    margin-bottom: 10px;
}

.progress-fill {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    height: 100%;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: clamp(12px, 3vw, 14px);
}

.progress-text {
    color: #666;
    font-size: clamp(13px, 3vw, 16px);
    text-align: center;
}

.section-title {
    color: #fff;
    margin-bottom: 25px;
    font-size: clamp(18px, 4vw, 24px);
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255, 107, 0, 0.5);
    flex-wrap: wrap;
}

.evidence-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr));
    gap: clamp(15px, 3vw, 25px);
    margin-bottom: clamp(25px, 5vw, 40px);
}

.evidence-card {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(18px, 4vw, 25px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    min-height: 200px;
    display: flex;
    flex-direction: column;
}

.evidence-card.unlocked:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px rgba(255, 107, 0, 0.4);
}

.evidence-card.locked {
    opacity: 0.6;
    border-color: #999;
    background: rgba(200, 200, 200, 0.95);
}

.evidence-header {
    display: flex;
    align-items: center;
    gap: clamp(10px, 2vw, 15px);
    margin-bottom: 15px;
}

.evidence-icon {
    width: clamp(50px, 10vw, 60px);
    height: clamp(50px, 10vw, 60px);
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(24px, 5vw, 30px);
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
    flex-shrink: 0;
}

.evidence-card.locked .evidence-icon {
    background: linear-gradient(135deg, #999 0%, #666 100%);
    filter: grayscale(100%);
}

.evidence-info h3 {
    color: #1a1a2e;
    font-size: clamp(16px, 3.5vw, 20px);
    margin-bottom: 5px;
    font-family: monospace;
    letter-spacing: 1px;
    word-wrap: break-word;
}

.evidence-card.locked .evidence-info h3 {
    color: #666;
}

.evidence-info p {
    color: #666;
    font-size: clamp(12px, 2.5vw, 14px);
    line-height: 1.4;
}

.evidence-description {
    color: #333;
    line-height: 1.6;
    margin-bottom: 20px;
    font-size: clamp(12px, 2.8vw, 14px);
    flex-grow: 1;
}

.evidence-card.locked .evidence-description {
    color: #999;
}

.evidence-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: auto;
}

.btn {
    padding: clamp(12px, 2.5vw, 14px) clamp(20px, 4vw, 24px);
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    font-size: clamp(12px, 2.8vw, 14px);
    border: 2px solid transparent;
    cursor: pointer;
    min-height: 48px;
    min-width: 48px;
    text-align: center;
}

.btn:hover:not(:disabled),
.btn:focus:not(:disabled) {
    transform: translateY(-2px);
    outline: none;
}

.btn-ar {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
}

.btn-ar:hover:not(:disabled) {
    box-shadow: 0 6px 20px rgba(255, 107, 0, 0.5);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #ccc;
    color: #666;
}

.btn-primary {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    color: #000;
    font-weight: bold;
}

.status-badge {
    display: inline-block;
    padding: clamp(5px, 1.5vw, 6px) clamp(10px, 2vw, 12px);
    border-radius: 6px;
    font-size: clamp(11px, 2.2vw, 12px);
    font-weight: bold;
    margin-top: 10px;
}

.status-unlocked {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-locked {
    background: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
}

.critical-tag {
    position: absolute;
    top: clamp(12px, 2.5vw, 15px);
    right: clamp(12px, 2.5vw, 15px);
    background: #dc3545;
    color: white;
    padding: clamp(3px, 1vw, 4px) clamp(6px, 1.5vw, 8px);
    border-radius: 4px;
    font-size: clamp(9px, 2vw, 11px);
    font-weight: bold;
}

.lock-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(36px, 8vw, 48px);
    opacity: 0.3;
}


.suspects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 320px), 1fr));
    gap: clamp(18px, 4vw, 25px);
    margin-top: 20px;
}

.suspect-card {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #dc3545;
    border-radius: 12px;
    padding: clamp(15px, 3vw, 20px);
    box-shadow: 0 10px 40px rgba(220, 53, 69, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.suspect-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px rgba(220, 53, 69, 0.5);
}

.suspect-photo-container {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
}

.suspect-canvas {
    border: 3px solid #333;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
    transform: rotate(-1deg);
    background: #f5f5f5;
    max-width: 100%;
    height: auto;
}

.suspect-number {
    position: absolute;
    top: -10px;
    right: 10px;
    background: #dc3545;
    color: white;
    padding: clamp(4px, 1vw, 5px) clamp(10px, 2vw, 12px);
    border-radius: 6px;
    font-size: clamp(10px, 2vw, 11px);
    font-weight: bold;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}

.suspect-details {
    font-size: clamp(12px, 2.8vw, 13px);
    line-height: 1.6;
}

.suspect-details h3 {
    color: #1a1a2e;
    font-size: clamp(14px, 3vw, 16px);
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #dc3545;
    font-family: monospace;
    letter-spacing: 0.5px;
}

.suspect-field {
    margin-bottom: 10px;
    padding: clamp(6px, 1.5vw, 8px);
    background: rgba(0,0,0,0.02);
    border-radius: 4px;
    text-align: justify;
    word-wrap: break-word;
}

.suspect-field strong {
    color: #dc3545;
    display: block;
    margin-bottom: 3px;
    font-size: clamp(10px, 2.2vw, 11px);
    letter-spacing: 0.5px;
}

.solution-form {
    background: white;
    padding: clamp(20px, 4vw, 25px);
    border-radius: 10px;
    margin: 20px 0;
}

.solution-form h3 {
    color: #1a1a2e;
    margin-bottom: 20px;
    font-size: clamp(16px, 3.5vw, 20px);
}

.suspect-options {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 250px), 1fr));
    gap: clamp(12px, 2.5vw, 15px);
    margin: 20px 0;
}

.suspect-option {
    background: #f8f9fa;
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: clamp(12px, 2.5vw, 15px);
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: 56px;
    display: flex;
    align-items: center;
}

.suspect-option:hover {
    border-color: #ff6b00;
    background: #fff5f0;
    transform: translateY(-2px);
}

.suspect-option input[type="checkbox"] {
    width: clamp(20px, 4vw, 24px);
    height: clamp(20px, 4vw, 24px);
    margin-right: clamp(10px, 2vw, 12px);
    cursor: pointer;
    flex-shrink: 0;
}

.suspect-option label {
    cursor: pointer;
    display: flex;
    align-items: center;
    font-weight: bold;
    color: #1a1a2e;
    font-size: clamp(13px, 2.8vw, 14px);
    flex-grow: 1;
}

.suspect-option input[type="checkbox"]:checked + label {
    color: #ff6b00;
}

.form-group {
    margin: clamp(18px, 4vw, 20px) 0;
}

.form-group label {
    display: block;
    font-weight: bold;
    color: #1a1a2e;
    margin-bottom: 10px;
    font-size: clamp(13px, 2.8vw, 14px);
}

.form-group textarea {
    width: 100%;
    min-height: clamp(120px, 25vw, 150px);
    padding: clamp(12px, 2.5vw, 15px);
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: clamp(13px, 2.8vw, 14px);
    font-family: inherit;
    resize: vertical;
}

.form-group input[type="number"] {
    width: 100%;
    max-width: 200px;
    padding: clamp(10px, 2vw, 12px);
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: clamp(14px, 3vw, 16px);
    min-height: 48px;
}

.form-group textarea:focus,
.form-group input:focus {
    outline: none;
    border-color: #ff6b00;
}

.submit-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: clamp(14px, 3vw, 16px) clamp(30px, 6vw, 40px);
    border: none;
    border-radius: 10px;
    font-size: clamp(15px, 3.5vw, 18px);
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(40,167,69,0.3);
    transition: all 0.2s ease;
    width: 100%;
    min-height: 56px;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40,167,69,0.5);
}

.info-box {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 8px;
    margin: 15px 0;
    font-size: clamp(12px, 2.5vw, 13px);
    color: #0d47a1;
    line-height: 1.6;
}

.footer {
    background: rgba(255, 255, 255, 0.1);
    padding: clamp(15px, 3vw, 20px);
    text-align: center;
    color: #fff;
    border-top: 2px solid rgba(255, 107, 0, 0.3);
    margin-top: clamp(30px, 6vw, 40px);
}

.footer p {
    margin: 5px 0;
    font-size: clamp(12px, 2.5vw, 14px);
    opacity: 0.9;
}

.tabs-content {
    position: relative;
}

.tab-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-pane.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (min-width: 576px) {
    .header {
        padding: 25px 20px;
    }
    
    .header h1 {
        font-size: clamp(24px, 5vw, 28px);
    }
    
    .tabs-nav {
        gap: 10px;
    }
    
    .tab-button {
        min-width: 140px;
    }
    
    .evidence-grid,
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
    
    .suspect-options {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    }
    
    .submit-btn {
        width: auto;
        min-width: 200px;
    }
}

@media (min-width: 768px) {
    .header {
        padding: 30px 20px;
    }
    
    .header h1 {
        font-size: 32px;
    }
    
    .header p {
        font-size: 16px;
    }
    
    .container {
        padding: 40px 20px;
    }
    
    .tabs-nav {
        flex-wrap: nowrap;
    }
    
    .tab-button {
        flex: 1;
        min-width: 150px;
    }
    
    .evidence-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
    
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
    
    .suspect-options {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
    
    .timer-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .evidence-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
    
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
    
    .evidence-actions {
        flex-direction: row;
    }
    
    .btn {
        width: auto;
    }
}

@media (min-width: 1440px) {
    .container {
        max-width: 1400px;
    }
}


@media (max-width: 768px) and (orientation: landscape) {
    .header {
        padding: 15px 20px;
    }
    
    .container {
        padding: 20px 15px;
    }
    
    .timer-section h2 {
        font-size: 14px;
    }
    
    .tab-button {
        padding: 10px 15px;
        min-height: 42px;
    }
}


*:focus-visible {
    outline: 3px solid #ff6b00;
    outline-offset: 2px;
}

button:focus-visible,
.btn:focus-visible,
.tab-button:focus-visible {
    outline: 3px solid #ff6b00;
    outline-offset: 2px;
}

.survey-tab-content {
    text-align: center;
    padding: clamp(30px, 8vw, 60px) clamp(20px, 5vw, 40px);
}

.survey-icon {
    font-size: clamp(50px, 15vw, 80px);
    margin-bottom: clamp(20px, 5vw, 30px);
}

.survey-title {
    font-size: clamp(18px, 4vw, 28px) !important;
    margin-bottom: clamp(15px, 4vw, 20px) !important;
}

.intro-box .survey-btn.btn.btn-primary {
    font-size: clamp(16px, 3.5vw, 20px);
    padding: clamp(15px, 3vw, 20px) clamp(30px, 6vw, 50px);
}

@media print {
    .animated-background,
    .header button,
    .tabs-nav,
    .evidence-actions {
        display: none !important;
    }
    
    .container {
        max-width: 100%;
        padding: 20px;
    }
    
    .tab-pane {
        display: block !important;
    }
}
@keyframes swing {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-10deg); }
    75% { transform: rotate(10deg); }
}

.loading-dots {
    display: inline-block;
    margin-left: 5px;
}

.loading-dots span {
    animation: blink 1.4s infinite;
    animation-fill-mode: both;
}

.loading-dots span:nth-child(2) {
    animation-delay: 0.2s;
}

.loading-dots span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes blink {
    0%, 80%, 100% { opacity: 0; }
    40% { opacity: 1; }
}

.stat-card {
    background: white;
    padding: 20px 15px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    text-align: center;
}

.stat-card h3 {
    color: #666;
    font-size: clamp(11px, 2.5vw, 14px);
    margin-bottom: 10px;
    text-transform: uppercase;
}

.stat-card .value {
    font-size: clamp(24px, 6vw, 32px);
    font-weight: bold;
    color: #ff6b00;
}

</style>

</head>

<body>
    <div class="animated-background"></div>

<div class="header">
        <h1>⚠️ ΦΑΚΕΛΟΣ ΥΠΟΘΕΣΗΣ ⚠️</h1>
        <div class="team-info" id="teamInfo" style="display: none;">
            <strong id="teamName"></strong>
        </div>
    </div>

    <div class="container">
        <div class="timer-section" id="timerSection">
            <h2>⏱️ΧΡΟΝΟΜΕΤΡΗΣΗ ΟΜΑΔΑΣ</h2>
            <div class="timer-grid">
                <div class="timer-box">
                    <strong>Έναρξη</strong>
                    <div class="value" id="startTime">--:--</div>
                </div>
                <div class="timer-box">
                    <strong id="liveTimerLabel">Χρόνος</strong>
                    <div class="value" id="liveTimer">0λ 0δ</div>
                </div>
            </div>
        </div>

<div class="tabs-container">
    <div class="tabs-nav">
        <button class="tab-button active" data-tab="intro">📋 ΠΕΡΙΣΤΑΤΙΚΟ</button>
        <button class="tab-button" data-tab="forensics">🥼 ΙΑΤΡΟΔΙΚΑΣΤΙΚΗ & ΧΡΟΝΟΛΟΓΙΟ</button>
        <button class="tab-button" data-tab="suspects">👥 ΚΑΤΑΛΟΓΟΣ ΥΠΟΠΤΩΝ</button>
        <button class="tab-button" data-tab="evidence">📦 ΤΕΚΜΗΡΙΑ</button>
        <button class="tab-button" data-tab="solution">✅ ΛΥΣΗ</button>
        <button class="tab-button" data-tab="survey">📊 ΕΡΕΥΝΑ</button>
        <button class="tab-button" data-tab="results">🏆 ΚΑΤΑΤΑΞΗ</button>
    </div>

            <div class="tabs-content">
                <div class="tab-pane active" id="tab-intro">
                    <div class="intro-box">
                        <h2>📋 ΠΕΡΙΣΤΑΤΙΚΟ</h2>
                        <p><strong>ΘΥΜΑ:</strong> ΔΗΜΗΤΡΙΟΥ ΠΕΤΡΟΣ του ΙΩΑΝΝΗ, ΑΦΜ: 074XXXXXX</p>
                        <p><strong>ΗΛΙΚΙΑ:</strong> 55 ετών | <strong>ΟΙΚ. ΚΑΤΑΣΤΑΣΗ:</strong> Διαζευγμένος, 2 τέκνα</p>
                        <p><strong>ΕΠΑΓΓΕΛΜΑ:</strong> Εκδότης, Ιδρυτής/CEO «ΛΟΓΟΣ ΕΚΔΟΣΕΙΣ Α.Ε.»</p>
                        <p><strong>ΤΟΠΟΣ ΕΥΡΕΣΗΣ:</strong> Ιδιωτικό γραφείο, Σταδίου 47, 7ος όροφος</p>
                        <p><strong>ΗΜΕΡΑ ΕΥΡΕΣΗΣ:</strong> Παρασκευή 31/10, 07:00 π.μ. | <strong>ΚΛΗΣΗ ΑΣΤΥΝΟΜΙΑΣ:</strong> 07:03</p>
                        <p style="font-style: italic; color: #00008b; margin-top: 15px;">Σημείωση: Ασφάλεια ζωής €1εκ. - ακυρώνεται σε περίπτωση αυτοκτονίας</p>
                    </div>

                    <div class="story-box">
                        <h2>📖 Η ΥΠΟΘΕΣΗ</h2>
                        <p>Ο Πέτρος Δημητρίου ήταν γνωστός εκδοτικός μεγιστάνας με επιτυχημένη καριέρα τριών δεκαετιών. Πριν από τρεις εβδομάδες έλαβε μια διάγνωση που άλλαξε τα πάντα: καρκίνος παγκρέατος τελικού σταδίου, με προσδόκιμο ζωής 2-3 μήνες. Η είδηση ήταν γνωστή μόνο στον ιατρό του, τη γραμματέα του και την πρώην σύζυγό του.</p>
                        <p>Το πρωί της Παρασκευής 31 Οκτωβρίου, η καθαρίστρια Μαρία Παπαδοπούλου φτάνει για τον συνηθισμένο καθαρισμό του γραφείου του στον 7ο όροφο και ανακαλύπτει το άψυχο σώμα του στις τουαλέτες του ορόφου. Στον υπολογιστή του γραφείου βρέθηκε ένα email «αυτοκτονίας» αποσταλμένο στις 21:25 το προηγούμενο βράδυ. Οι πρώτες ενδείξεις έδειχναν αυτοκτονία από δηλητηρίαση με κυάνιο.</p>
                        <p>Ωστόσο, η εξέταση της σκηνής και η ανάκριση του προσωπικού αποκάλυψαν ανωμαλίες που προκαλούν υποψίες...</p>
                    </div>
                </div>
                <div class="tab-pane" id="tab-forensics">
                    <div class="forensic-box">
                        <h2>🥼 ΙΑΤΡΟΔΙΚΑΣΤΙΚΗ ΕΚΘΕΣΗ</h2>
                        <p><strong>ΤΟΠΟΣ ΕΥΡΕΣΗΣ:</strong> Τουαλέτες, 7ος όροφος</p>
                        <p><strong>ΩΡΑ ΘΑΝΑΤΟΥ:</strong> 21:30 - 21:50 (ακρίβεια ±10 λεπτά)</p>
                        <p><strong>ΑΙΤΙΑ:</strong> Οξεία δηλητηρίαση από κυανιούχο κάλιο (75mg εντεροδιαλυτή κάψουλα)</p>
                        <p><strong>ΤΟΞΙΚΟΛΟΓΙΚΗ:</strong> Αλκοόλ 0.12%, αλπραζολάμη 2mg (ενισχύει δράση κυανίου)</p>
                        <p><strong>ΤΡΑΥΜΑΤΑ:</strong> Κανένα αμυντικό τραύμα - το θύμα δεν αντιστάθηκε</p>
                        <p><strong>ΠΑΘΟΛΟΓΙΚΗ:</strong> <span class="red-highlight">Καρκίνος παγκρέατος τελικού σταδίου - προσδόκιμο ζωής 2-3 μήνες</span></p>
                    </div>
                    <div class="timeline-box">
                        <h2>🕐 ΧΡΟΝΟΛΟΓΙΟ ΣΥΜΒΑΝΤΩΝ</h2>
                        <div class="timeline-item"><strong>17:30-18:30</strong> - Οι περισσότεροι υπάλληλοι αποχωρούν από το κτίριο</div>
                        <div class="timeline-item"><strong>19:00</strong> - Παράδοση φαγητού στο γραφείο του θύματος (για 2 άτομα)</div>
                        <div class="timeline-item"><strong>20:00-21:00</strong> - Κρίσιμο χρονικό παράθυρο - πολλαπλές κινήσεις στο κτίριο</div>
                        <div class="timeline-item"><strong>20:45</strong> - SMS στο κινητό του θύματος: «Θα τελειώσει απόψε»</div>
                        <div class="timeline-item"><strong>21:25</strong> - Email «αυτοκτονίας» αποστέλλεται</div>
                        <div class="timeline-item"><strong>21:30-21:50</strong> - <span class="timeline-critical">ΘΑΝΑΤΟΣ ΘΥΜΑΤΟΣ</span></div>
                        <div class="timeline-item"><strong>07:00 (επόμενη μέρα)</strong> - Ανακάλυψη πτώματος από καθαρίστρια</div>
                    </div>
                </div>

                <div class="tab-pane" id="tab-suspects">
                    <div id="suspectsContainer"></div>
                </div>

                <div class="tab-pane" id="tab-evidence">
                    <div class="progress-bar-container">
                        <div class="progress-title">📊 ΠΡΟΟΔΟΣ ΕΡΕΥΝΑΣ</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                        <div class="progress-text" id="progressText">ΕΧΕΤΕ ΞΕΚΛΕΙΔΩΣΕΙ 0 ΑΠΟ 11 ΤΕΚΜΗΡΙΑ</div>
                    </div>
					
					</div>

    <div style="text-align: center; margin: 25px 0;">
        <button onclick="window.location.href='qr_scanner.html'" 
                style="background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); 
                       color: white; 
                       padding: 18px 40px; 
                       border: none; 
                       border-radius: 12px; 
                       font-size: 18px; 
                       font-weight: bold; 
                       cursor: pointer; 
                       box-shadow: 0 4px 15px rgba(255,107,0,0.4);
                       transition: all 0.3s ease;
                       min-height: 56px;
                       display: inline-flex;
                       align-items: center;
                       gap: 10px;"
                onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(255,107,0,0.6)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,107,0,0.4)'">
            📷 ΣΑΡΩΣΗ QR CODE
        </button>
    </div>

    <h2 class="section-title">📦 ΤΕΚΜΗΡΙΑ ΑΠΟ ΤΗ ΣΚΗΝΗ ΤΟΥ ΕΓΚΛΗΜΑΤΟΣ</h2>

                    <h2 class="section-title">📦 ΤΕΚΜΗΡΙΑ ΑΠΟ ΤΗ ΣΚΗΝΗ ΤΟΥ ΕΓΚΛΗΜΑΤΟΣ</h2>

                    <div class="evidence-grid" id="evidenceGrid">
                    </div>
                </div>

                <div class="tab-pane" id="tab-solution">
                    <div class="intro-box" id="solutionIntroBox">
                        <h2>✅ ΥΠΟΒΟΛΗ ΛΥΣΗΣ</h2>
                        <p>Έχετε μελετήσει όλα τα τεκμήρια και είστε έτοιμοι να υποβάλετε τη λύση σας;</p>
                    </div>

                    <div class="solution-form" id="solutionForm">
                        <h3 style="color: #1a1a2e; margin-bottom: 20px;">ΕΠΙΛΟΓΗ</h3>
                        
                        <div class="suspect-options">
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_maria" name="suspect" value="maria">
                                <label for="suspect_maria">👩 Παπαδοπούλου Μαρία</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_konstantinos" name="suspect" value="konstantinos">
                                <label for="suspect_konstantinos">👨‍💼 Αναγνώστου Κωνσταντίνος</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_eleni" name="suspect" value="eleni">
                                <label for="suspect_eleni">👩‍🦰 Μαυρίδη Ελένη</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_georgios" name="suspect" value="georgios">
                                <label for="suspect_georgios">👮 Πετρόπουλος Γεώργιος</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_alexandra" name="suspect" value="alexandra">
                                <label for="suspect_alexandra">👩‍💻 Νικολάου Αλεξάνδρα</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_suicide" name="suspect" value="suicide">
                                <label for="suspect_suicide">💀 Αυτοκτονία</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="justification">ΑΙΤΙΟΛΟΓΗΣΗ ΛΥΣΗΣ: *</label>
                            <textarea 
                                id="justification" 
                                placeholder="Προσθέστε την ανάλυση / αιτιολόγησή σας..."
                                required
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="promptCount">ΑΡΙΘΜΟΣ PROMPTS ΠΟΥ ΧΡΗΣΙΜΟΠΟΙΗΣΑΤΕ: *</label>
                            <input 
                                type="number" 
                                id="promptCount" 
                                min="0" 
                                step="1" 
                                placeholder="π.χ. 5"
                                required
                            >
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">
                                Να γίνει υπό την επίβλεψη ενός Game Master.
                            </p>
                        </div>

                        <button type="button" class="submit-btn" onclick="submitSolution()">
                            ✅ ΥΠΟΒΟΛΗ ΛΥΣΗΣ
                        </button>
                    </div>

                    <div id="solutionResult" style="display: none;"></div>
                </div>
<div class="tab-pane" id="tab-survey">
    <div class="intro-box survey-tab-content">
        <div class="survey-icon">📊</div>
        <h2 class="survey-title">ΕΡΕΥΝΑ ΑΞΙΟΛΟΓΗΣΗΣ ΑΠΟΨΕΩΝ & ΕΜΠΕΙΡΙΩΝ</h2>                     
        <a href="#" 
           onclick="openSurvey(); return false;" 
           class="btn btn-primary" 
           style="margin-top: 20px; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
            📊 ΜΕΤΑΒΑΣΗ ΣΤΟ ΕΡΩΤΗΜΑΤΟΛΟΓΙΟ
        </a>
    </div>
</div>

<div class="tab-pane" id="tab-results">
    <div id="surveysIncomplete" style="display: none; padding-bottom: 80px;">
        <div class="intro-box" style="text-align: center; padding: 60px 30px;">
            <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px;">🔒</div>
            <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                Ολοκληρώστε Πρώτα τις Έρευνες
            </h2>
            <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 12px; padding: 20px; margin: 20px auto; max-width: 500px;">
                <div style="font-size: 24px; margin-bottom: 10px;">📝</div>
                <div style="color: #856404; font-weight: bold; margin-bottom: 10px;">ΚΑΤΑΣΤΑΣΗ ΕΡΕΥΝΩΝ:</div>
                <div id="surveyStatus" style="color: #666; font-size: 14px; line-height: 1.8;">
                    <div id="preSurveyStatus">⏳ Έλεγχος...</div>
                    <div id="postSurveyStatus">⏳ Έλεγχος...</div>
                </div>
            </div>
            <a href="#" 
               onclick="window.location.href='survey.html?team=' + encodeURIComponent(sessionStorage.getItem('teamCode')) + '&member=' + encodeURIComponent(sessionStorage.getItem('memberName')); return false;"
               class="btn btn-primary" 
               style="margin-top: 20px; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
                📊 ΜΕΤΑΒΑΣΗ ΣΤΟ ΕΡΩΤΗΜΑΤΟΛΟΓΙΟ
            </a>
        </div>
    </div>

    <div id="leaderboardLocked" style="display: none; padding-bottom: 80px;">
        <div class="intro-box" style="text-align: center; padding: 60px 30px;">
            <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px; animation: swing 3s ease-in-out infinite;">
                🔒
            </div>
            <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                ΤΑ ΑΠΟΤΕΛΕΣΜΑΤΑ ΔΕΝ ΕΙΝΑΙ ΑΚΟΜΑ ΔΙΑΘΕΣΙΜΑ
            </h2>
            <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 12px; padding: 20px; margin: 30px auto; max-width: 500px;">
                <div style="font-size: 24px; margin-bottom: 10px;"></div>
                <div style="color: #155724; font-weight: bold;">
                    Η ΣΕΛΙΔΑ ΘΑ ΑΝΑΝΕΩΘΕΙ ΟΤΑΝ ΟΛΕΣ ΟΙ ΟΜΑΔΕΣ ΟΛΟΚΛΗΡΩΣΟΥΝ ΤΗΝ ΕΡΕΥΝΑ ΤΟΥΣ!!<br>
                </div>
            </div>
            <p style="margin-top: 30px; color: #999; font-size: 14px;">
                Έλεγχος ενημερώσεων<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
            </p>
        </div>
    </div>
    <div id="leaderboardUnlocked" style="display: none; padding-bottom: 80px;">
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Σύνολο Υποβολών</h3>
                <div class="value" id="totalTeams" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Τέλειες Λύσεις</h3>
                <div class="value" id="perfectScores" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Μέσος Όρος Βαθμών</h3>
                <div class="value" id="avgScore" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Μέσος Χρόνος</h3>
                <div class="value" id="avgTime" style="font-size: clamp(16px, 4vw, 20px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
        </div>

        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow-x: auto;">
            <h2 style="color: #1a1a2e; font-size: clamp(18px, 4vw, 24px); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #ff6b00;">
                🏆 ΚΑΤΑΤΑΞΗ ΟΜΑΔΩΝ
            </h2>
            <table id="resultsTable" style="width: 100%; border-collapse: collapse; min-width: 650px; display: none;">
                <thead>
                    <tr style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); color: white;">
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Θέση</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Ομάδα</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Βαθμολογία</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Τίτλος</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Χρόνος</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #666;">Φόρτωση...</td>
                    </tr>
                </tbody>
            </table>
            <div id="resultsCards" style="display: none;"></div>
        </div>
    </div>
</div>

</div> 

<div class="footer">
    <p><strong>ΦΕΣΤΙΒΑΛ ΑΣΤΥΝΟΜΙΚΗΣ ΛΟΓΟΤΕΧΝΙΑΣ 2025</strong></p>
    <p style="margin-top: 10px; opacity: 0.7; font-size: 12px;">
        11 ΤΕΚΜΗΡΙΑ | 5 ΥΠΟΠΤΟΙ | 1 ΑΛΗΘΕΙΑ
    </p>
</div>

</div>
</div>

<script src="suspects.js"></script>

<script>
    const teks = [
        {
            id: '1',
            name: 'Μπουκάλι Ουίσκι',
            subtitle: 'Μπουκάλι Jack Daniels',
            icon: '🍾',
            description: '<strong>Τοποθεσία:</strong> Γραφείο θύματος<br><strong>Ευρήματα:</strong> Κυάνιο στον πάτο + αποτυπώματα θύματος, Παπαδοπούλου, Αναγνώστου, Πετρόπουλος',
            page: 'TEK1_AR.html',
            critical: true
        },
            {
                id: '2',
                name: 'Κρυστάλλινα Ποτήρια',
                subtitle: 'Κρυστάλλινα Ποτήρια',
                icon: '🥃',
                description: '<strong>Ποτήρι Α:</strong> DNA θύματος + κυάνιο + αποτυπώματα θύματος<br><strong>Ποτήρι Β:</strong> Μερικό DNA (υπό ανάλυση) + ίχνη ουίσκι + αποτυπώματα μερικώς σβησμένα',
                page: 'TEK2_AR.html',
                critical: true
            },
            {
                id: '3',
                name: 'Κινητό Θύματος',
                subtitle: 'Κινητό Θύματος',
                icon: '📱',
                description: '<strong>SMS 20:45:</strong> «Θα τελειώσει απόψε»<br><strong>Προέλευση:</strong> Προπληρωμένη κάρτα, εντοπισμένη σε ακτίνα 250m από το κτίριο',
                page: 'TEK3_AR.html',
                critical: false,
                threat: true
            },
            {
                id: '4',
                name: 'Email Αυτοκτονίας',
                subtitle: 'Email «Αυτοκτονίας»',
                icon: '💻',
                description: '<strong>IP:</strong> 192.168.1.23 - 7ος όροφος<br><strong>Προέλευση:</strong> Κοινόχρηστος υπολογιστής αίθουσας συσκέψεων (δεν απαιτεί κωδικό)',
                page: 'TEK4_AR.html',
                critical: false,
                forgery: true
            },
            {
                id: '5',
                name: 'Ιατρική Γνωμάτευση',
                subtitle: 'Ιατρική Γνωμάτευση (κρυφή)',
                icon: '🥼',
                description: '<strong>Διάγνωση:</strong> Καρκίνος παγκρέατος σταδίου IV<br><strong>Ημερομηνία:</strong> Πριν 3 εβδομάδες<br><strong>Πρόγνωση:</strong> 2-3 μήνες ζωής • Διατρός: Δρ. Σταυρίδης',
                page: 'TEK5_AR.html',
                critical: false,
                secret: true
            },
            {
                id: '6',
                name: 'Γάντια Λάτεξ',
                subtitle: 'Ίχνη Γαντιών Λάτεξ',
                icon: '🧤',
                description: '<strong>Τοποθεσία:</strong> Πόμολο πόρτας<br><strong>Τύπος:</strong> Γάντια ιατρικού τύπου, μέγεθος M<br><strong>Προέλευση:</strong> Κουτί πρώτων βοηθειών (πρόσβαση: όλο το προσωπικό)',
                page: 'TEK6_AR.html',
                critical: false,
                clue: true
            },
            {
                id: '7',
                name: 'Χειρόγραφο Σημείωμα',
                subtitle: 'Χειρόγραφο Σημείωμα',
                icon: '✍️',
                description: '<strong>Κείμενο:</strong> «Συγχώρεσέ με Μ.»<br><strong>Ανάλυση:</strong> Μίμηση γραφικού χαρακτήρα (65% ταύτιση, πίεση ασυνεπής)',
                page: 'TEK7_AR.html',
                critical: false,
                forgery: true
            },
            {
                id: '8',
                name: 'Φάκελος Εμπιστευτικό',
                subtitle: 'Φάκελος «ΕΜΠΙΣΤΕΥΤΙΚΟ»',
                icon: '📂',
                description: '<strong>Περιεχόμενα:</strong><br>• Υπεξαίρεση €1,5εκ (Αναγνώστου)<br>• Ερωτικές φωτογραφίες (Μαυρίδη)<br>• Κλοπή χειρογράφων (Νικολάου)',
                page: 'TEK8_AR.html',
                critical: false,
                blackmail: true
            },
            {
                id: '9',
                name: 'Απόδειξη Χημικών',
                subtitle: 'Απόδειξη Αγοράς Χημικών',
                icon: '🧪',
                description: '<strong>Ημερομηνία:</strong> 19/09, 14:30<br><strong>Αγορά:</strong> Κυανιούχο κάλιο από «ΧημικάPlus»<br><strong>Άδεια:</strong> Απεντόμωση εταιρείας • Υπογραφή: Γ. Πετρόπουλος (υπό γραφολογική εξέταση)',
                page: 'TEK9_AR.html',
                critical: true
            },
            {
                id: '10',
                name: 'Κλειδί Χρηματοκιβωτίου',
                subtitle: 'Κλειδί Χρηματοκιβωτίου',
                icon: '🔑',
                description: '<strong>Αποτυπώματα:</strong> Δημητρίου, Αναγνώστου<br><strong>Ίχνη:</strong> Σκόνη ταλκ (από latex γάντια)',
                page: 'TEK10_AR.html',
                critical: false,
                financial: true
            },
            {
                id: '11',
                name: 'Κάμερες Ασφαλείας',
                subtitle: 'Κάμερες Ασφαλείας',
                icon: '📹',
                description: '<strong>Απενεργοποίηση:</strong> 20:55<br><strong>Τετράδιο Συμβάντων:</strong> «20:58 - Τεχνική βλάβη CCTV»<br><strong>Υπογραφή:</strong> ΠΕΤΡΟΠΟΥΛΟΣ Γ. (γνησιότητα υπό εξέταση)',
                page: 'TEK11_AR.html',
                critical: false,
                sabotage: true
            }
        ];

        const CORRECT_SUSPECTS = ['konstantinos', 'georgios', 'eleni'];
        const SUSPECT_NAMES = {
            'maria': 'Παπαδοπούλου Μαρία',
            'konstantinos': 'Αναγνώστου Κωνσταντίνος',
            'eleni': 'Μαυρίδη Ελένη',
            'georgios': 'Πετρόπουλος Γεώργιος',
            'alexandra': 'Νικολάου Αλεξάνδρα',
            'suicide': 'Αυτοκτονία'
        };

const SCORING = {
            murder_diagnosis: 25,
            cooperation: 20,
            perpetrator: 15,
            perfect_solution_bonus: 20,
            evidence_use: 5,
            prompts_1_5: 15,
            prompts_6_10: 10,
            prompts_11_15: 5,
            time_under_30: 15,
            time_30_45: 10,
            time_45_60: 5
        };
		
        const urlParams = new URLSearchParams(window.location.search);
        const teamCode = sessionStorage.getItem('teamName') || urlParams.get('team') || 'default';

        if (teamCode !== 'default') {
            const teamInfoDiv = document.getElementById('teamInfo');
            const teamNameSpan = document.getElementById('teamName');
            if (teamInfoDiv && teamNameSpan) {
                teamInfoDiv.style.display = 'block';
                teamNameSpan.textContent = `ΟΜΑΔΑ: ${teamCode.toUpperCase()}`;
            }
        }

        let timerInterval = null;

        function getStorageKey() {
            return `unlocked_teks_${teamCode}`;
        }

function openSurvey() {
    const teamCode = sessionStorage.getItem('teamCode');
    const memberName = sessionStorage.getItem('memberName');
    
    if (!teamCode || !memberName) {
        alert('❌ Σφάλμα: Δεν βρέθηκαν στοιχεία σύνδεσης. Παρακαλώ συνδεθείτε ξανά.');
        window.location.href = 'team_entry.html';
        return;
    }

    const surveyUrl = `survey.html?team=${encodeURIComponent(teamCode)}&member=${encodeURIComponent(memberName)}`;
    window.open(surveyUrl, '_blank');
}

function getUnlockedTeks() {
    const stored = localStorage.getItem(getStorageKey());
    if (!stored) return [];
    
    try {
        const data = JSON.parse(stored);
        if (data && typeof data === 'object' && !Array.isArray(data) && data.unlocked) {
            return Array.isArray(data.unlocked) ? data.unlocked : [];
        }
		
        if (Array.isArray(data)) {
            return data;
        }
        
        return [];
    } catch (e) {
        console.error('Error loading unlocked TEKs:', e);
        return [];
    }
}

function formatElapsedTime(ms) {
    const seconds = Math.floor(ms / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    
    const h = hours;
    const m = minutes % 60;
    const s = seconds % 60;
    
    if (h > 0) {
        return `${h}ω ${m}λ ${s}δ`;
    } else if (m > 0) {
        return `${m}λ ${s}δ`;
    } else {
        return `${s}δ`;
    }
}

function startLiveTimer(startTime) {
    if (timerInterval) clearInterval(timerInterval);
    
    const timerElement = document.getElementById('liveTimer');
    if (!timerElement) return;
    
    timerInterval = setInterval(() => {
        const now = new Date();
        const start = new Date(startTime);
        const elapsed = now - start;
        timerElement.textContent = formatElapsedTime(elapsed);
    }, 1000);
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

async function getTeamData() {
    if (window.firebaseDB) {
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            const docSnap = await window.firebaseGetDoc(docRef);
            
            if (docSnap.exists()) {
                return docSnap.data();
            }
        } catch (error) {
            console.error('Firebase load error:', error);
        }
    }

    const localData = localStorage.getItem(getStorageKey());
    if (localData) {
        try {
            const parsed = JSON.parse(localData);
            if (parsed && typeof parsed === 'object' && !Array.isArray(parsed)) {
                return {
                    password: parsed.password || null,
                    unlocked: parsed.unlocked || [],
                    timestamps: parsed.timestamps || {},
                    startTime: parsed.startTime || null,
                    completedAt: parsed.completedAt || null,
                    totalTimeMs: parsed.totalTimeMs || null,
                    solution: parsed.solution || null,
                    evidenceTimestamps: parsed.evidenceTimestamps || {}
                };
            }
			
            if (Array.isArray(parsed)) {
                return {
                    password: null,
                    unlocked: parsed,
                    timestamps: {},
                    startTime: null,
                    completedAt: null,
                    totalTimeMs: null,
                    solution: null,
                    evidenceTimestamps: {}
                };
            }
        } catch (e) {
            console.error('Error parsing localStorage data:', e);
        }
    }

    return {
        password: null,
        unlocked: [],
        timestamps: {},
        startTime: null,
        completedAt: null,
        totalTimeMs: null,
        solution: null,
        evidenceTimestamps: {}
    };
}

async function updateProgress(teamData) {
    const unlockedTeks = teamData.unlocked || [];
    const total = teks.length;
    const unlocked = unlockedTeks.length;
    const percentage = Math.round((unlocked / total) * 100);
    document.getElementById('progressFill').style.width = percentage + '%';
    document.getElementById('progressFill').textContent = percentage + '%';
    document.getElementById('progressText').textContent = 
        `Έχετε ξεκλειδώσει ${unlocked} από ${total} τεκμήρια`;
    
    const timerSection = document.getElementById('timerSection');
    if (teamData.startTime && unlocked > 0) {
        timerSection.style.display = 'block';
        document.getElementById('startTime').textContent = 
            new Date(teamData.startTime).toLocaleString('el-GR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        if (teamData.completedAt || teamData.solution) {
            document.getElementById('liveTimerLabel').textContent = 'Συνολικός Χρόνος:';
            document.getElementById('liveTimer').textContent = formatElapsedTime(teamData.totalTimeMs || 0);
            stopTimer();
        } else {

            document.getElementById('liveTimerLabel').textContent = 'Χρόνος σε Εξέλιξη:';

            if (!timerInterval) {
                startLiveTimer(teamData.startTime);
            }
        }
    } else {
        timerSection.style.display = 'none';
        stopTimer();
    }
}

function calculateScore(selectedSuspects, totalTimeMs, promptCount) {
    let score = 0;
    let breakdown = [];
    
    if (selectedSuspects.length === 0) {
        return {
            score: 0,
            breakdown: ['❌ Δεν επιλέξατε κανέναν ύποπτο ή αυτοκτονία'],
            maxScore: 140,
            correctCount: 0
        };
    }
	
    const hasSuicide = selectedSuspects.includes('suicide');
    const hasKiller = selectedSuspects.some(s => s !== 'suicide');
    
    if (hasSuicide && hasKiller) {
        const killerNames = selectedSuspects
            .filter(s => s !== 'suicide')
            .map(s => SUSPECT_NAMES[s])
            .join(', ');
        
        return {
            score: 0,
            breakdown: [
                '❌ ΛΟΓΙΚΗ ΑΝΤΙΦΑΣΗ - ΒΑΘΜΟΣ: 0/140',
                '',
                '⚠️ Επιλέξατε ταυτόχρονα:',
                `   • Δολοφονία από: ${killerNames}`,
                '   • Αυτοκτονία',
                '',
                'Οι δυο επιλογές αλληλοαποκλείονται!',
                'Δεν μπορεί να είναι δολοφονία ΚΑΙ αυτοκτονία.',
                '',
            ],
            maxScore: 140,
            correctCount: 0
        };
    }

    if (hasSuicide && !hasKiller) {
        return {
            score: 0,
            breakdown: [
                '✗ ΛΑΘΟΣ ΔΙΑΓΝΩΣΗ: Αυτοκτονία - ΒΑΘΜΟΣ: 0/140',
                '',
                '❌ Η απάντησή σας (αυτοκτονία) είναι λανθασμένη!',
                '',
            ],
            maxScore: 140,
            correctCount: 0
        };
    }

    let correctCount = 0;
    let wrongSuspects = [];
    
    selectedSuspects.forEach(suspect => {
        if (CORRECT_SUSPECTS.includes(suspect)) {
            correctCount++;
        } else {
            wrongSuspects.push(SUSPECT_NAMES[suspect] || suspect);
        }
    });
        
    breakdown.push('✔ ΘΕΤΙΚΑ ΣΤΟΙΧΕΙΑ:');    
    
    score += SCORING.murder_diagnosis;
    breakdown.push(`✔ Διάγνωση Δολοφονίας: +${SCORING.murder_diagnosis}`);
    
    if (correctCount > 0) {
        const points = correctCount * SCORING.perpetrator;
        score += points;
        breakdown.push(`✔ Σωστοί Δράστες (${correctCount}/3): +${points}`);
    } else {
        breakdown.push(`✗ Σωστοί Δράστες (0/3): +0`);
    }
    
    if (correctCount >= 2) {
        score += SCORING.cooperation;
        breakdown.push(`✔ Εντοπισμός Συνεργασίας: +${SCORING.cooperation}`);
    } else {
        breakdown.push(`✗ Εντοπισμός Συνεργασίας: +0 (απαιτούνται 2+ σωστοί)`);
    }
    
    const isPerfect = (correctCount === 3 && selectedSuspects.length === 3);
    
    if (isPerfect) {
        score += SCORING.perfect_solution_bonus;
        breakdown.push(`✔ Τέλεια Λύση (μόνο οι 3 σωστοί): +${SCORING.perfect_solution_bonus}`);
    } else if (correctCount >= 2) {
        score += SCORING.evidence_use;
        breakdown.push(`✔ Χρήση Τεκμηρίων: +${SCORING.evidence_use}`);
    }
    
    if (wrongSuspects.length === 0 && correctCount > 0 && correctCount < 3) {
        const precisionBonus = correctCount * 15;
        score += precisionBonus;
        breakdown.push(`✔ Bonus Ακρίβειας (0 λάθη, ${correctCount} σωστοί): +${precisionBonus}`);
    }
    
    if (totalTimeMs && correctCount >= 2) {
        const minutes = totalTimeMs / 60000;
        if (minutes < 30) {
            score += SCORING.time_under_30;
            breakdown.push(`⏱️ Bonus Χρόνου (<30λ): +${SCORING.time_under_30}`);
        } else if (minutes < 45) {
            score += SCORING.time_30_45;
            breakdown.push(`⏱️ Bonus Χρόνου (30-45λ): +${SCORING.time_30_45}`);
        } else if (minutes < 60) {
            score += SCORING.time_45_60;
            breakdown.push(`⏱️ Bonus Χρόνου (45-60λ): +${SCORING.time_45_60}`);
        }
    }
    
    if (promptCount && correctCount >= 2) {
        if (promptCount <= 5) {
            score += SCORING.prompts_1_5;
            breakdown.push(`🎯 Bonus Αποδοτικότητας (1-5 prompts): +${SCORING.prompts_1_5}`);
        } else if (promptCount <= 10) {
            score += SCORING.prompts_6_10;
            breakdown.push(`🎯 Bonus Αποδοτικότητας (6-10 prompts): +${SCORING.prompts_6_10}`);
        } else if (promptCount <= 15) {
            score += SCORING.prompts_11_15;
            breakdown.push(`🎯 Bonus Αποδοτικότητας (11-15 prompts): +${SCORING.prompts_11_15}`);
        }
    }
    
    if (wrongSuspects.length > 0 || correctCount < 3) {
        breakdown.push('');
        breakdown.push('✗ ΑΡΝΗΤΙΚΑ ΣΤΟΙΧΕΙΑ:');
    }
	
    if (wrongSuspects.length > 0) {
        let multiplier = 1.0;
        if (wrongSuspects.length === 1) {
            multiplier = 0.5;
        } else if (wrongSuspects.length === 2) {
            multiplier = 0.2;
        } else {
            multiplier = 0.05;
        }
        
        breakdown.push(`✗ Λάθος Ύποπτοι (${wrongSuspects.length}):`);
        wrongSuspects.forEach(name => {
            breakdown.push(`   → ${name}`);
        });
        
        const originalScore = score;
        score = Math.floor(score * multiplier);
        const penalty = originalScore - score;
        
        breakdown.push(`⚠️ Πολλαπλασιαστής Ακρίβειας: ×${multiplier} (${Math.round(multiplier*100)}%)`);
        breakdown.push(`💡 Βαθμολογία πριν: ${originalScore} → Μετά: ${score} (Απώλεια: -${penalty})`);
    }
    
    if (correctCount < 3) {
        const missed = 3 - correctCount;
        const missedNames = CORRECT_SUSPECTS
            .filter(s => !selectedSuspects.includes(s))
            .map(s => SUSPECT_NAMES[s])
            .join(', ');
        
        breakdown.push(`⚠️ Χάσατε ${missed} σωστό${missed > 1 ? 'ύς δράστες' : ' δράστη'}: ${missedNames}`);
    }
    
    score = Math.max(0, Math.min(score, 140));
    
    return { score, breakdown, maxScore: 140, correctCount };
}

async function submitSolution() {
    const checkboxes = document.querySelectorAll('input[name="suspect"]:checked');
    const selectedSuspects = Array.from(checkboxes).map(cb => cb.value);
    const justification = document.getElementById('justification').value.trim();
    const promptCount = parseInt(document.getElementById('promptCount').value) || 0;

    if (selectedSuspects.length === 0) {
        alert('Παρακαλώ επιλέξτε τουλάχιστον έναν ύποπτο ή αυτοκτονία!');
        return;
    }

    if (!justification || justification.length < 50) {
        alert('Παρακαλώ συμπληρώστε αναλυτική αιτιολόγηση (τουλάχιστον 50 χαρακτήρες)!');
        return;
    }

if (promptCount === null || promptCount === undefined || promptCount < 0) {
    alert('Παρακαλώ εισάγετε έγκυρο αριθμό prompts!');
    return;
}
    
    const teamData = await getTeamData();
    if (teamData.unlocked.length < 6) {
        alert(`Πρέπει να ξεκλειδώσετε τουλάχιστον 6 τεκμήρια πριν υποβάλετε λύση! (Έχετε: ${teamData.unlocked.length}/11)`);
        return;
    }

    if (teamData.solution) {
        alert('Έχετε ήδη υποβάλει λύση! Δεν μπορείτε να υποβάλετε ξανά.');
        return;
    }            
    
    let totalTimeMs = null;
    if (teamData.startTime) {
        const start = new Date(teamData.startTime);
        const now = new Date();
        totalTimeMs = now - start;
    }

    const scoreResult = calculateScore(selectedSuspects, totalTimeMs, promptCount);

    const solution = {
        suspects: selectedSuspects,
        justification: justification,
        justificationLength: justification.length,
        promptCount: promptCount,
        submittedAt: new Date().toISOString(),
        completionTimeMs: totalTimeMs,
        score: scoreResult.score,
        maxScore: scoreResult.maxScore,
        breakdown: scoreResult.breakdown,
        correctCount: scoreResult.correctCount,
researchData: {
    evidenceUnlockSequence: Object.keys(teamData.evidenceTimestamps || {}).sort((a, b) => {
        return new Date(teamData.evidenceTimestamps[a]) - new Date(teamData.evidenceTimestamps[b]);
    }),
    totalEvidenceUnlocked: (teamData.unlocked || []).length,
    firstEvidenceTime: teamData.startTime || null,
    lastEvidenceTime: (teamData.evidenceTimestamps && Object.keys(teamData.evidenceTimestamps).length > 0) ? 
        Object.values(teamData.evidenceTimestamps).sort().pop() : null,
    timeSpentMinutes: totalTimeMs ? Math.round(totalTimeMs / 60000) : null,
    strategy: selectedSuspects.includes('suicide') ? 'suicide' : 
             (selectedSuspects.length === 5 ? 'shotgun' : 
             (selectedSuspects.length === 3 ? 'selective' : 'selective'))
}
    };
    
try {
    const updatedData = {
        ...teamData,
        solution: solution,
        completedAt: solution.submittedAt,
        totalTimeMs: totalTimeMs,
        lastUpdate: new Date().toISOString()
    };
        
        localStorage.setItem(getStorageKey(), JSON.stringify(updatedData));
        
        if (window.firebaseDB) {
            await window.firebaseSetDoc(
                window.firebaseDoc(window.firebaseDB, 'teams', teamCode),
                updatedData
            );
        }
        
        localStorage.setItem(`solution_${teamCode}`, JSON.stringify(solution));
        displaySubmissionConfirmation();
        
    } catch (error) {
        console.error('Error saving solution:', error);
        alert('Σφάλμα αποθήκευσης! Δοκιμάστε ξανά.');
    }
}







function displaySubmissionConfirmation() {
    const resultDiv = document.getElementById('solutionResult');
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    if (solutionIntroBox) {
        solutionIntroBox.style.display = 'none';
    }
    
    resultDiv.innerHTML = `
        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px 30px; border-radius: 12px; margin: 20px 0; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 15px rgba(40,167,69,0.3); flex-wrap: wrap; gap: 15px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 40px;">✅</div>
                <div>
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">ΛΥΣΗ ΥΠΟΒΛΗΘΗΚΕ ΕΠΙΤΥΧΩΣ!</div>
                    <div style="font-size: 14px; opacity: 0.9;">📅 ${new Date().toLocaleString('el-GR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</div>
                </div>
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 3px solid #ff6b00; padding: 0; border-radius: 15px; margin-top: 20px; box-shadow: 0 10px 40px rgba(255, 107, 0, 0.4); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); padding: 25px; text-align: center; position: relative;">
                <div style="font-size: 56px; margin-bottom: 10px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));">🔐</div>
                <h3 style="color: #000; font-size: 24px; font-weight: bold; margin: 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 1px 1px 2px rgba(255,255,255,0.3);">
                    Η ΑΛΗΘΕΙΑ ΘΑ ΑΠΟΚΑΛΥΦΘΕΙ ΣΥΝΤΟΜΑ...
                </h3>
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 100%; background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.05) 10px, rgba(0,0,0,0.05) 20px); pointer-events: none;"></div>
            </div>
            <div style="padding: 30px;">
                <div style="background: linear-gradient(135deg, rgba(255, 107, 0, 0.2) 0%, rgba(255, 136, 0, 0.2) 100%); border: 2px solid #ff6b00; border-radius: 12px; padding: 20px; margin-bottom: 30px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -20px; right: -20px; font-size: 100px; opacity: 0.1;">⚠️</div>
                    <div style="position: relative; z-index: 1;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 28px;">💡</span>
                            <span style="color: #ff6b00; font-size: 16px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">ΠΡΟΣΟΧΗ!</span>
							</div>
							<p style="color: #fff; font-size: 14px; margin: 0; text-align: center; line-height: 1.7; font-weight: 600;">
								ΚΡΑΤΗΣΤΕ ΤΗ ΛΥΣΗ ΣΑΣ ΜΥΣΤΙΚΗ!<br>
								ΜΗΝ ΜΟΙΡΑΣΤΕΙΤΕ ΠΛΗΡΟΦΟΡΙΕΣ ΜΕ ΑΛΛΕΣ ΟΜΑΔΕΣ ΜΕΧΡΙ ΤΗΝ ΕΠΙΣΗΜΗ ΛΗΞΗ ΤΟΥ ΔΙΑΓΩΝΙΣΜΟΥ!<br>
							</p>
							</div>
						</div>

                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 25px; backdrop-filter: blur(5px);">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-flex; align-items: center; gap: 10px; background: rgba(255, 107, 0, 0.2); padding: 10px 20px; border-radius: 25px; border: 1px solid rgba(255, 107, 0, 0.4);">
                            <span style="font-size: 20px;">🔑</span>
                            <span style="color: #ff6b00; font-weight: bold; font-size: 15px; text-transform: uppercase; letter-spacing: 1px;">Έχετε τον κωδικό πρόσβασης;</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: stretch; max-width: 500px; margin: 0 auto;">
                        <input type="password" id="solutionPassword" placeholder="Εισάγετε κωδικό..." 
                               style="flex: 1; min-width: 200px; padding: 15px 20px; border: 2px solid rgba(255, 107, 0, 0.5); background: rgba(255, 255, 255, 0.9); border-radius: 10px; font-size: 16px; font-weight: 500; transition: all 0.3s ease; outline: none; color: #1a1a2e;"
                               onfocus="this.style.borderColor='#ff6b00'; this.style.background='#fff'; this.style.boxShadow='0 0 20px rgba(255, 107, 0, 0.3)'"
                               onblur="this.style.borderColor='rgba(255, 107, 0, 0.5)'; this.style.background='rgba(255, 255, 255, 0.9)'; this.style.boxShadow='none'">
                        <button onclick="revealSolution()" 
                                style="padding: 15px 35px; background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4); transition: all 0.3s ease; white-space: nowrap; text-transform: uppercase; letter-spacing: 1px;"
                                onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(255, 107, 0, 0.6)'"
                                onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 0, 0.4)'">
                            🔓 ΑΠΟΚΑΛΥΨΗ
                        </button>
                    </div>
                    
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; text-align: center; margin: 15px 0 0 0; font-style: italic;">
                        Ο κωδικός θα ανακοινωθεί από τους διοργανωτές
                    </p>
                </div>
            </div>
        </div>
    `;
    
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    
    const solutionForm = document.getElementById('solutionForm');
    if (solutionForm) {
        solutionForm.style.display = 'none';
    }
    
    stopTimer();
}

























function displaySolutionResult(solution) {
    const resultDiv = document.getElementById('solutionResult');
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    if (solutionIntroBox) {
        solutionIntroBox.style.display = 'none';
    }
    const percentage = Math.round((solution.score / solution.maxScore) * 100);
    let grade = '';
    let gradeColor = '';
    if (percentage >= 90) {
        grade = 'ΑΡΧΙ-ΝΤΕΤΕΚΤΙΒΣ 🕵️';
        gradeColor = '#00d4ff';
    } else if (percentage >= 80) {
        grade = 'ΑΝΩΤΕΡΟΙ ΑΝΑΚΡΙΤΕΣ 🎖️';
        gradeColor = '#ffd700';
    } else if (percentage >= 70) {
        grade = 'ΝΤΕΤΕΚΤΙΒΣ 🔎';
        gradeColor = '#c0c0c0';
    } else if (percentage >= 60) {
        grade = 'ΑΣΤΥΝΟΜΟΙ 👮';
        gradeColor = '#cd7f32';
    } else if (percentage >= 50) {
        grade = 'ΕΡΕΥΝΗΤΕΣ 📝';
        gradeColor = '#ffcc00';
    } else if (percentage >= 40) {
        grade = 'ΑΣΚΟΥΜΕΝΟΙ 🎓';
        gradeColor = '#28a745';
    } else {
        grade = 'ΝΕΟΣΥΛΛΕΚΤΟΙ 🎯';
        gradeColor = '#6c757d';
    }

    const isPerfect = solution.correctCount === 3 && solution.suspects.length === 3;
    const hasSuicide = solution.suspects.includes('suicide');
    const hasKiller = solution.suspects.some(s => s !== 'suicide');
    const isContradiction = hasSuicide && hasKiller;
    let headerGradient = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
    let headerShadow = 'rgba(40,167,69,0.3)';
    
    if (isContradiction || solution.score === 0) {
        headerGradient = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
        headerShadow = 'rgba(220,53,69,0.3)';
    } else if (percentage < 50) {
        headerGradient = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
        headerShadow = 'rgba(255,193,7,0.3)';
    }

    let breakdownHTML = '';
    solution.breakdown.forEach(item => {
        let bgColor = '#f8f9fa';
        let borderColor = '#dee2e6';
        let textColor = '#333';
        let fontWeight = 'normal';
        
        if (item.includes('ΛΟΓΙΚΗ ΑΝΤΙΦΑΣΗ') || item.includes('ΛΑΘΟΣ ΔΙΑΓΝΩΣΗ')) {
            bgColor = '#f8d7da';
            borderColor = '#dc3545';
            textColor = '#721c24';
            fontWeight = 'bold';
        } else if (item.includes('✔') || item.includes('+')) {
            bgColor = '#d4edda';
            borderColor = '#28a745';
            textColor = '#155724';
        } else if (item.includes('✗') || item.includes('-') || item.includes('❌')) {
            bgColor = '#fff3cd';
            borderColor = '#ffc107';
            textColor = '#856404';
        } else if (item.includes('⚠️')) {
            bgColor = '#fff3cd';
            borderColor = '#ffc107';
            textColor = '#856404';
        } else if (item.includes('💡')) {
            bgColor = '#e7f3ff';
            borderColor = '#2196f3';
            textColor = '#0d47a1';
        } else if (item.includes('ΤΕΛΙΚΗ ΒΑΘΜΟΛΟΓΙΑ')) {
            bgColor = '#e3f2fd';
            borderColor = '#2196f3';
            textColor = '#0d47a1';
            fontWeight = 'bold';
        } else if (item.includes('╔') || item.includes('─')) {
            breakdownHTML += '<div style="color: #999; margin: 5px 0;">' + item + '</div>';
            return;
        } else if (item.trim() === '') {
            breakdownHTML += '<div style="height: 5px;"></div>';
            return;
        }
		
        if (item.startsWith('   ')) {
            breakdownHTML += '<div style="padding: 4px 4px 4px 30px; margin: 2px 0; color: ' + textColor + '; font-size: 13px;">' + item + '</div>';
        } else {
            breakdownHTML += '<div style="padding: 10px 15px; margin: 5px 0; background: ' + bgColor + '; border-left: 4px solid ' + borderColor + '; border-radius: 4px; color: ' + textColor + '; font-weight: ' + fontWeight + ';">' + item + '</div>';
        }
    });
	
    let statsHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">';
    
    statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
    statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">ΠΟΣΟΣΤΟ</div>';
    statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + percentage + '%</div>';
    statsHTML += '</div>';
    
    if (solution.completionTimeMs) {
        statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
        statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">⏱️ ΧΡΟΝΟΣ</div>';
        statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + formatElapsedTime(solution.completionTimeMs) + '</div>';
        statsHTML += '</div>';
    }
    
    statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
    statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">🎯 PROMPTS</div>';
    statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + solution.promptCount + '</div>';
    statsHTML += '</div>';
    
    statsHTML += '</div>';
    resultDiv.innerHTML = 
        '<div style="background: ' + headerGradient + '; color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center; box-shadow: 0 10px 40px ' + headerShadow + ';">' +
		
        '<h2 style="font-size: 32px; margin-bottom: 15px;">' +
        (isPerfect ? '🎉 ΤΕΛΕΙΑ ΛΥΣΗ!' : isContradiction ? '❌ ΛΟΓΙΚΗ ΑΝΤΙΦΑΣΗ' : solution.score === 0 ? '❌ ΛΑΘΟΣ ΑΠΑΝΤΗΣΗ' : '✔ ΛΥΣΗ ΥΠΟΒΛΗΘΗΚΕ') +
        '</h2>' +
        '<div style="font-size: 64px; font-weight: bold; margin: 20px 0;">' + solution.score + '/' + solution.maxScore + '</div>' +
        '<div style="font-size: 28px; margin-bottom: 20px; color: ' + gradeColor + '; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">' + grade + '</div>' +
        statsHTML +
        '</div>' +
        
        '<div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #28a745;">' +
        '<h4 style="color: #1a1a2e; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #ff6b00; padding-bottom: 8px;">📊 ΑΝΑΛΥΣΗ ΒΑΘΜΟΛΟΓΙΑΣ ΣΑΣ</h4>' +
        '<div style="font-family: \'Courier New\', monospace; line-height: 1.8; font-size: 14px;">' +
        breakdownHTML +
        '</div>' +
        '</div>' +
        
        '<div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #dc3545;">' +
        '<h4 style="color: #dc3545; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #dc3545; padding-bottom: 8px;">🎯 ΛΥΣΗ: ΣΥΝΕΡΓΑΤΙΚΗ ΔΟΛΟΦΟΝΙΑ</h4>' +
        '<h5 style="color: #1a1a2e; margin: 15px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">⚠️ ΔΡΑΣΤΕΣ & ΡΟΛΟΣ</h5>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">👨‍💼 Αναγνώστου Κωνσταντίνος</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">ΜΑΣΤΡΟΣ</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Ρόλος:</strong> CFO εταιρείας • Χειριστής του σχεδίου</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Κίνητρο:</strong> Υπεξαίρεση €1.5εκ που επρόκειτο να αποκαλυφθεί</div>' +
        '<div><strong style="color: #333;">Συμβολή:</strong> Έριξε το κυάνιο στο ουίσκι • Ενέκρινε την άδεια αγοράς</div>' +
        '</div>' +
        '</div>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">👮 Πετρόπουλος Γεώργιος</strong>' +
        '<span style="background: #ff6b00; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">ΣΥΝΕΡΓΟΣ</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Ρόλος:</strong> Φρύλακας κτιρίου • Πρόσβαση παντού</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Κίνητρο:</strong> Χρέη €60k στους τοκογλύφους</div>' +
        '<div><strong style="color: #333;">Συμβολή:</strong> Προμήθευσε το κυάνιο • Απενεργοποίησε κάμερες 20:55</div>' +
        '</div>' +
        '</div>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">👩‍🦰 Μαυρίδη Ελένη</strong>' +
        '<span style="background: #ff8800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">ΣΥΓΚΑΛΥΨΗ</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Ρόλος:</strong> Πρώην ερωμένη θύματος • IT δεξιότητες</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Κίνητρο:</strong> Εκβιασμός με ερωτικές φωτογραφίες</div>' +
        '<div><strong style="color: #333;">Συμβολή:</strong> Έστειλε fake email «αυτοκτονίας» 21:25 • Πλαστό σημείωμα</div>' +
        '</div>' +
        '</div>' +
        '<h5 style="color: #1a1a2e; margin: 20px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">🔍 ΚΡΙΣΙΜΑ ΣΤΟΙΧΕΙΑ</h5>' +
        '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-bottom: 15px;">' +
        '<div style="background: #e3f2fd; padding: 10px; border-radius: 6px; border-left: 3px solid #2196f3;">' +
        '<div style="font-weight: bold; color: #0d47a1; margin-bottom: 4px;">📱 SMS Απειλής</div>' +
        '<div style="font-size: 12px; color: #555;">«Θα τελειώσει απόψε»</div>' +
        '</div>' +
        '<div style="background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 3px solid #ffc107;">' +
        '<div style="font-weight: bold; color: #856404; margin-bottom: 4px;">🥃 Ποτήρια</div>' +
        '<div style="font-size: 12px; color: #555;">Ένα με κυάνιο, ένα καθαρό</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 10px; border-radius: 6px; border-left: 3px solid #dc3545;">' +
        '<div style="font-weight: bold; color: #721c24; margin-bottom: 4px;">✍️ Πλαστό Σημείωμα</div>' +
        '<div style="font-size: 12px; color: #555;">Μίμηση γραφής 65%</div>' +
        '</div>' +
        '<div style="background: #d4edda; padding: 10px; border-radius: 6px; border-left: 3px solid #28a745;">' +
        '<div style="font-weight: bold; color: #155724; margin-bottom: 4px;">🧪 Αλπραζολάμη</div>' +
        '<div style="font-size: 12px; color: #555;">2mg στο αίμα (κατευναστικό)</div>' +
        '</div>' +
        '<div style="background: #e0e0e0; padding: 10px; border-radius: 6px; border-left: 3px solid #6c757d;">' +
        '<div style="font-weight: bold; color: #495057; margin-bottom: 4px;">📹 Κάμερες OFF</div>' +
        '<div style="font-size: 12px; color: #555;">Απενεργοποίηση 20:55</div>' +
        '</div>' +
        '<div style="background: #ffe0e0; padding: 10px; border-radius: 6px; border-left: 3px solid #ff6b6b;">' +
        '<div style="font-weight: bold; color: #c92a2a; margin-bottom: 4px;">🍽️ Παραγγελία</div>' +
        '<div style="font-size: 12px; color: #555;">Φαγητό για 2, θύμα μόνο</div>' +
        '</div>' +
        '</div>' +
        '<h5 style="color: #1a1a2e; margin: 20px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">' +
        '📝 ΑΝΑΛΥΣΗ ΑΛΛΟΘΙ' +
        '<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; margin-left: 10px;">ΩΡΑ ΔΟΛΟΦΟΝΙΑΣ: 21:30-21:50</span>' +
        '</h5>' +
        
        '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-bottom: 15px;">' +
        '<div style="background: #d4edda; padding: 12px; border-radius: 6px; border-left: 4px solid #28a745;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">👩</span>' +
        '<strong style="color: #155724; font-size: 13px;">Παπαδοπούλου Μαρία</strong>' +
        '<span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">✔ ΙΣΧΥΡΟ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #155724; line-height: 1.5;">' +
        '<div>• Γιατρός 18:30-19:30 (επιβεβαιωμένο)</div>' +
        '<div>• Δείπνο με αδελφή 19:45-22:30</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(40,167,69,0.1); border-radius: 3px;">✔ Κάλυψε όλο το κρίσιμο χρονικό παράθυρο!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">👨‍💼</span>' +
        '<strong style="color: #721c24; font-size: 13px;">Αναγνώστου Κωνσταντίνος</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">❌ ΑΣΘΕΝΕΣ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>• Δείπνο «Διόνυσος» 18:45-20:30</div>' +
        '<div>• Εστιατόριο 200m από κτίριο!</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">❌ Χρόνος 20:30-21:50: ΧΩΡΙΣ ΚΑΛΥΨΗ!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">👩‍🦰</span>' +
        '<strong style="color: #721c24; font-size: 13px;">Μαυρίδη Ελένη</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">❌ ΣΠΑΣΜΕΝΟ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>• Παρουσίαση βιβλίου 19:30-20:30</div>' +
        '<div>• "Μετά στο κτίριο" (αόριστο)</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">❌ Ομολογεί παρουσία στο κτίριο κατά τη δολοφονία!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">👮</span>' +
        '<strong style="color: #721c24; font-size: 13px;">Πετρόπουλος Γεώργιος</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">❌ ΨΕΥΔΕΣ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>• Ισχυρίζεται: Βάρδια όλο βράδυ</div>' +
        '<div>• Ισχυρίζεται: Περιπολίες κάθε 2h</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">❌ ΑΠΟΔΕΙΞΗ: Απενεργοποίησε κάμερες 20:55!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">👩‍💻</span>' +
        '<strong style="color: #856404; font-size: 13px;">Νικολάου Αλεξάνδρα</strong>' +
        '<span style="background: #ffc107; color: #000; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">⚠️ ΑΒΕΒΑΙΟ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #856404; line-height: 1.5;">' +
        '<div>• «Μικρό Καφέ» μέχρι 20:30</div>' +
        '<div>• Δεν επιβεβαιώθηκε από μάρτυρες</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(255,193,7,0.1); border-radius: 3px;">⚠️ Αδύναμο αλλά δεν βρέθηκαν άλλα τεκμήρια εναντίον της</div>' +
        '</div>' +
        '</div>' +
        
        '</div>' +
        '<div style="background: #e7f3ff; border: 2px solid #2196f3; padding: 15px; border-radius: 8px; margin-top: 10px;">' +
        '<div style="font-weight: bold; color: #0d47a1; margin-bottom: 8px; font-size: 13px;">💡 ΣΥΜΠΕΡΑΣΜΑ</div>' +
        '<div style="font-size: 12px; color: #1565c0; line-height: 1.6;">' +
        'Οι <strong>τρεις δράστες</strong> είχαν <strong>ευκαιρία</strong> (21:30-21:50), <strong>κίνητρο</strong> (χρήματα/εκβιασμός), και ' +
        '<strong>πρόσβαση</strong> στο κυάνιο. Η Παπαδοπούλου είχε σιδερένιο άλλοθι. Η Νικολάου δεν είχε κίνητρο ούτε πρόσβαση σε κυάνιο.' +
        '</div>' +
        '</div>' +
        
        '</div>';
    
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    const solutionForm = document.getElementById('solutionForm');
    if (solutionForm) {
        solutionForm.style.display = 'none';
    }
    
    stopTimer();
}

window.revealSolution = async function() {
    const password = document.getElementById('solutionPassword').value.toUpperCase();
    const correctPassword = 'MURDER';
    
    if (password !== correctPassword) {
        alert('❌ Λάθος κωδικός! Ζητήστε τον σωστό κωδικό από τον οργανωτή.');
        document.getElementById('solutionPassword').value = '';
        return;
    }
	
    const teamData = await getTeamData();
    const solution = teamData.solution;
    
    if (!solution) {
        alert('Δεν βρέθηκε υποβληθείσα λύση!');
        return;
    }

    const scoreResult = calculateScore(
        solution.suspects, 
        solution.completionTimeMs, 
        solution.promptCount
    );

    const completeSolution = {
        ...solution,
        score: scoreResult.score,
        maxScore: scoreResult.maxScore,
        breakdown: scoreResult.breakdown,
        correctCount: scoreResult.correctCount,
        wrongCount: solution.suspects.length - scoreResult.correctCount
    };
	
    const submissionHeader = document.getElementById('submissionHeader');
    const passwordSection = document.getElementById('passwordSection');
    if (submissionHeader) submissionHeader.style.display = 'none';
    if (passwordSection) passwordSection.style.display = 'none';

    displaySolutionResult(completeSolution);
};

function buildUrl(page) {
    return teamCode !== 'default' ? `${page}?team=${teamCode}` : page;
}

function renderEvidence() {
    const unlockedTeks = getUnlockedTeks();
    const grid = document.getElementById('evidenceGrid');
    
    grid.innerHTML = teks.map(tek => {
        const isUnlocked = unlockedTeks.includes(tek.id);
        const cardClass = isUnlocked ? 'unlocked' : 'locked';
        
        let criticalTag = '';
        if (tek.critical) criticalTag = '<span class="critical-tag">ΚΡΙΣΙΜΟ</span>';
        else if (tek.secret) criticalTag = '<span class="critical-tag">ΑΠΟΡΡΗΤΟ</span>';
        else if (tek.blackmail) criticalTag = '<span class="critical-tag">ΕΚΒΙΑΣΜΟΣ</span>';
        else if (tek.sabotage) criticalTag = '<span class="critical-tag">ΣΑΜΠΟΤΑΖ</span>';
        else if (tek.threat) criticalTag = '<span class="critical-tag">ΑΠΕΙΛΗ</span>';
        else if (tek.forgery) criticalTag = '<span class="critical-tag">ΠΛΑΣΤΟΓΡΑΦΙΑ</span>';
        else if (tek.clue) criticalTag = '<span class="critical-tag">ΕΝΔΕΙΞΗ</span>';
        else if (tek.financial) criticalTag = '<span class="critical-tag">ΟΙΚΟΝΟΜΙΚΟ</span>';
        
        return `
            <div class="evidence-card ${cardClass}">
                ${criticalTag}
                ${!isUnlocked ? '<div class="lock-overlay">🔒</div>' : ''}
                <div class="evidence-header">
                    <div class="evidence-icon">${tek.icon}</div>
                    <div class="evidence-info">
                        <h3>ΤΕΚ #${tek.id.padStart(3, '0')}</h3>
                        <p>${tek.subtitle}</p>
                    </div>
                </div>
                <p class="evidence-description">
                    ${isUnlocked ? tek.description : '🔒 Ξεκλειδώστε αυτό το τεκμήριο για να δείτε λεπτομέρειες'}
                </p>
                <div class="evidence-actions">
                    ${isUnlocked ? 
                        `<a href="${buildUrl(tek.page)}" class="btn btn-ar">
                            👁️ Προβολή Τεκμηρίου
                        </a>` :
                        `<button class="btn btn-ar" disabled>🔒 Κλειδωμένο</button>`
                    }
                </div>
                <span class="status-badge ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                    ${isUnlocked ? '✅ ΔΙΑΘΕΣΙΜΟ' : '🔒 ΚΛΕΙΔΩΜΕΝΟ'}
                </span>
            </div>
        `;
    }).join('');
}

async function initSolutionTab(teamData) {
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    const solutionForm = document.getElementById('solutionForm');
    const existingSolution = teamData.solution;
    
    if (existingSolution) {
        if (solutionIntroBox) {
            solutionIntroBox.style.display = 'none';
        }
        if (solutionForm) {
            solutionForm.style.display = 'none';
        }
		
        displaySubmissionConfirmation();
    }
}

window.addEventListener('storage', async (e) => {
    if (e.key === getStorageKey() || e.key === `solution_${teamCode}`) {
        console.log('🔄 Storage change detected, updating UI...');
        renderEvidence();
        const teamData = await getTeamData();
        await updateProgress(teamData);
        const solutionTab = document.getElementById('tab-solution');
        if (solutionTab && solutionTab.classList.contains('active')) {
            await initSolutionTab(teamData);
        }
    }
});

window.submitSolution = submitSolution;

function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-tab');

            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
        });
    });
}

window.submitSolution = submitSolution;
window.switchToSurveyTab = switchToSurveyTab;

let resultsUnsubscribe = null;

function switchToSurveyTab() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabButtons.forEach(btn => btn.classList.remove('active'));
    tabPanes.forEach(pane => pane.classList.remove('active'));
    
    document.querySelector('[data-tab="survey"]').classList.add('active');
    document.getElementById('tab-survey').classList.add('active');
}

async function checkSurveyCompletion() {
    if (!window.firebaseDB) {
        console.warn('Firebase not ready for survey check');
        return { 
            pre: false, 
            post: false, 
            preCount: 0, 
            postCount: 0, 
            bothCount: 0,
            teamSize: 0,
            members: [] 
        };
    }

    try {
        const teamDocRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
        const teamDoc = await window.firebaseGetDoc(teamDocRef);
        const teamSize = teamDoc.exists() ? (teamDoc.data().teamSize || 0) : 0;
        
        if (teamSize === 0) {
            console.warn(`Team ${teamCode} has no teamSize configured. Please set teamSize in Firebase.`);
        }
		
        const surveysRef = window.firebaseCollection(window.firebaseDB, 'surveys');
        const querySnapshot = await window.firebaseGetDocs(surveysRef);
        
        const preMembers = new Set();
        const postMembers = new Set();
        const membersWithBoth = new Set();
        querySnapshot.forEach((doc) => {
            const docId = doc.id;
            if (docId.startsWith(`${teamCode}_pre_`)) {
                const memberName = docId.replace(`${teamCode}_pre_`, '');
                preMembers.add(memberName);
            }
			
            if (docId.startsWith(`${teamCode}_post_`)) {
                const memberName = docId.replace(`${teamCode}_post_`, '');
                postMembers.add(memberName);
            }
        });

        preMembers.forEach(member => {
            if (postMembers.has(member)) {
                membersWithBoth.add(member);
            }
        });
        
        const bothCount = membersWithBoth.size;
        const meetsRequirement = teamSize > 0 && bothCount >= teamSize;
        
        console.log(`Survey check for ${teamCode}:`);
        console.log(`  Team size: ${teamSize}`);
        console.log(`  Members completed both: ${bothCount}/${teamSize}`);
        console.log(`  Pre-survey: ${preMembers.size}, Post-survey: ${postMembers.size}`);
        console.log(`  Requirement met: ${meetsRequirement}`);
        
        return {
            pre: meetsRequirement,
            post: meetsRequirement,
            preCount: preMembers.size,
            postCount: postMembers.size,
            bothCount: bothCount,
            teamSize: teamSize,
            members: Array.from(membersWithBoth)
        };
    } catch (error) {
        console.error('Error checking surveys:', error);
        return { 
            pre: false, 
            post: false, 
            preCount: 0, 
            postCount: 0, 
            bothCount: 0,
            teamSize: 0,
            members: [] 
        };
    }
}

async function checkLeaderboardUnlocked() {
    if (!window.firebaseDB) return false;
    
    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'config', 'leaderboard');
        const docSnap = await window.firebaseGetDoc(docRef);
        
        return docSnap.exists() ? (docSnap.data().unlocked || false) : false;
    } catch (error) {
        console.error('Error checking leaderboard status:', error);
        return false;
    }
}

async function updateResultsTabState() {
    const memberName = sessionStorage.getItem('memberName');
    const teamCode = sessionStorage.getItem('teamCode') || new URLSearchParams(window.location.search).get('team');
    
    if (!memberName || !teamCode) {
        console.error('Member or team info missing!');
        return;
    }

    const postSurveyDoc = `${teamCode}_post_${memberName}`;
    const postSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', postSurveyDoc);
    const postSurveySnap = await window.firebaseGetDoc(postSurveyRef);
    const memberCompletedPost = postSurveySnap.exists();
    const surveys = await checkSurveyCompletion();
    const leaderboardUnlocked = await checkLeaderboardUnlocked();
    
    const surveysIncomplete = document.getElementById('surveysIncomplete');
    const leaderboardLocked = document.getElementById('leaderboardLocked');
    const leaderboardUnlockedDiv = document.getElementById('leaderboardUnlocked');

    if (!memberCompletedPost) {
        surveysIncomplete.innerHTML = `
            <div class="intro-box" style="text-align: center; padding: 60px 30px;">
                <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px;">📝</div>
                <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                    Ολοκληρώστε Πρώτα την Τελική Έρευνα
                </h2>
                <a href="survey.html?team=${teamCode}&member=${encodeURIComponent(memberName)}" 
                   class="btn btn-primary" 
                   style="display: inline-block; text-decoration: none; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
                    📊 ΜΕΤΑΒΑΣΗ ΣΤΗΝ ΤΕΛΙΚΗ ΕΡΕΥΝΑ
                </a>
            </div>
        `;
        surveysIncomplete.style.display = 'block';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'none';
        return;
    }
    const preSurveyStatus = document.getElementById('preSurveyStatus');
    const postSurveyStatus = document.getElementById('postSurveyStatus');
    
    if (preSurveyStatus) {
        if (surveys.teamSize === 0) {
            preSurveyStatus.innerHTML = '⚠️ <strong>ΠΡΟΚΑΤΑΡΚΤΙΚΗ ΕΡΕΥΝΑ:</strong> ΜΕΓΕΘΟΣ ΟΜΑΔΑΣ ΔΕΝ ΕΧΕΙ ΟΡΙΣΤΕΙ';
        } else if (surveys.bothCount >= surveys.teamSize) {
            preSurveyStatus.innerHTML = `✅ <strong>ΠΡΟΚΑΤΑΡΚΤΙΚΗ ΕΡΕΥΝΑ:</strong> ΟΛΑ ΤΑ ΜΕΛΗ (${surveys.preCount}/${surveys.teamSize}) ΤΗΝ ΟΛΟΚΛΗΡΩΣΑΝ`;
        } else {
            preSurveyStatus.innerHTML = `⏳ <strong>ΠΡΟΚΑΤΑΡΚΤΙΚΗ ΕΡΕΥΝΑ:</strong> ${surveys.preCount}/${surveys.teamSize} ΜΕΛΗ ΤΗΝ ΟΛΟΚΛΗΡΩΣΑΝ`;
        }
    }
    
    if (postSurveyStatus) {
        if (surveys.teamSize === 0) {
            postSurveyStatus.innerHTML = '⚠️ <strong>ΤΕΛΙΚΗ ΕΡΕΥΝΑ:</strong> ΜΕΓΕΘΟΣ ΟΜΑΔΑΣ ΔΕΝ ΕΧΕΙ ΟΡΙΣΤΕΙ';
        } else if (surveys.bothCount >= surveys.teamSize) {
            postSurveyStatus.innerHTML = `✅ <strong>ΤΕΛΙΚΗ ΕΡΕΥΝΑ:</strong> ΟΛΑ ΤΑ ΜΕΛΗ (${surveys.postCount}/${surveys.teamSize}) ΤΗΝ ΟΛΟΚΛΗΡΩΣΑΝ`;
        } else {
            postSurveyStatus.innerHTML = `⏳ <strong>ΤΕΛΙΚΗ ΕΡΕΥΝΑ:</strong> ${surveys.postCount}/${surveys.teamSize} ΜΕΛΗ ΤΗΝ ΟΛΟΚΛΗΡΩΣΑΝ`;
        }
    }
    
    if (!surveys.pre || !surveys.post) {
        surveysIncomplete.style.display = 'block';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'none';
    } else if (!leaderboardUnlocked) {
        surveysIncomplete.style.display = 'none';
        leaderboardLocked.style.display = 'block';
        leaderboardUnlockedDiv.style.display = 'none';
    } else {
        surveysIncomplete.style.display = 'none';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'block';
        await loadLeaderboardData();
    }
}

function getResultsGrade(percentage) {
    if (percentage >= 90) return { name: 'ΑΡΧΙ-ΝΤΕΤΕΚΤΙΒΣ 🕵️', color: '#00d4ff' };
    if (percentage >= 80) return { name: 'ΑΝΩΤΕΡΟΙ ΑΝΑΚΡΙΤΕΣ 🎖️', color: '#ffd700' };
    if (percentage >= 70) return { name: 'ΝΤΕΤΕΚΤΙΒΣ 🔎', color: '#c0c0c0' };
    if (percentage >= 60) return { name: 'ΑΣΤΥΝΟΜΟΙ 👮', color: '#cd7f32' };
    if (percentage >= 50) return { name: 'ΕΡΕΥΝΗΤΕΣ 📋', color: '#ffcc00' };
    if (percentage >= 40) return { name: 'ΑΣΚΟΥΜΕΝΟΙ 🎓', color: '#28a745' };
    return { name: 'ΝΕΟΣΥΛΛΕΚΤΟΙ 🎯', color: '#6c757d' };
}

async function loadLeaderboardData() {
    try {
        console.log('📊 Loading leaderboard data...');
        
        if (!window.firebaseDB) {
            console.error('Firebase not ready!');
            displayLeaderboardError('Σύνδεση με τη βάση δεδομένων απέτυχε');
            return;
        }
        
        const querySnapshot = await window.firebaseGetDocs(
            window.firebaseCollection(window.firebaseDB, 'teams')
        );
        
        console.log(`Found ${querySnapshot.size} teams in database`);
        
        const teams = [];
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            console.log(`Team ${doc.id}:`, {
                hasSolution: !!data.solution,
                score: data.solution?.score,
                unlocked: data.unlocked?.length
            });
            
            if (data.solution) {
                teams.push({
                    name: doc.id,
                    ...data
                });
            }
        });

        console.log(`${teams.length} teams have submitted solutions`);

if (teams.length === 0) {
            displayLeaderboardError('Δεν υπάρχουν ομάδες που έχουν υποβάλει λύση ακόμα!');
            return;
        }

        teams.sort((a, b) => b.solution.score - a.solution.score);

        displayResultsStats(teams);
        displayResultsLeaderboard(teams);

    } catch (error) {
        console.error('Error loading leaderboard:', error);
        displayLeaderboardError(`Σφάλμα φόρτωσης: ${error.message}`);
    }
}
function displayLeaderboardError(message) {
    const tableBody = document.getElementById('resultsTableBody');
    const cardsContainer = document.getElementById('resultsCards');
    
    const errorHTML = `
        <div style="text-align: center; padding: 40px; color: #666;">
            <div style="font-size: 60px; margin-bottom: 20px;">⚠️</div>
            <div style="color: #dc3545; font-weight: bold; margin-bottom: 15px; white-space: pre-line;">
                ${message}
            </div>
            <button onclick="loadLeaderboardData()" style="margin-top: 20px; padding: 12px 24px; background: #ff6b00; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                🔄 Δοκιμάστε Ξανά
            </button>
        </div>
    `;
    
    if (tableBody) {
        tableBody.innerHTML = `<tr><td colspan="5">${errorHTML}</td></tr>`;
    }
    
    if (cardsContainer) {
        cardsContainer.innerHTML = errorHTML;
    }
}

function formatTime(ms) {
    if (!ms) return 'N/A';
    const seconds = Math.floor(ms / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    
    const h = hours;
    const m = minutes % 60;
    const s = seconds % 60;
    
    if (h > 0) return `${h}ω ${m}λ ${s}δ`;
    else if (m > 0) return `${m}λ ${s}δ`;
    else return `${s}δ`;
}

function displayResultsStats(teams) {
    const totalTeams = teams.length;
    const perfectScores = teams.filter(t => {
        const suspects = t.solution.suspects || [];
        return suspects.length === 3 && 
               suspects.includes('konstantinos') && 
               suspects.includes('georgios') && 
               suspects.includes('eleni');
    }).length;
    
    const avgScore = totalTeams > 0 
        ? Math.round(teams.reduce((sum, t) => sum + t.solution.score, 0) / totalTeams)
        : 0;
    
    const avgTime = totalTeams > 0
        ? formatTime(teams.reduce((sum, t) => sum + (t.solution.completionTimeMs || 0), 0) / totalTeams)
        : 'N/A';

    document.getElementById('totalTeams').textContent = totalTeams;
    document.getElementById('perfectScores').textContent = perfectScores;
    document.getElementById('avgScore').textContent = avgScore;
    document.getElementById('avgTime').textContent = avgTime;
}

function displayResultsLeaderboard(teams) {
    const tableBody = document.getElementById('resultsTableBody');
    const cardsContainer = document.getElementById('resultsCards');
    const table = document.getElementById('resultsTable');
    const cards = document.getElementById('resultsCards');
    
    if (!tableBody || !cardsContainer || !table || !cards) {
        console.error('Leaderboard elements not found in DOM!');
        return;
    }
    
    if (teams.length === 0) {
        displayLeaderboardError('Δεν υπάρχουν υποβολές ακόμα');
        return;
    }

    if (window.innerWidth > 768) {
        table.style.display = 'table';
        cards.style.display = 'none';
    } else {
        table.style.display = 'none';
        cards.style.display = 'block';
    }

    tableBody.innerHTML = teams.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? `rank-${rank}` : '';
        const solution = team.solution;
        
        const maxScore = solution.maxScore || 140;
        const percentage = Math.round((solution.score / maxScore) * 100);
        const grade = getResultsGrade(percentage);
        const rankEmoji = rank === 1 ? '🥇' : rank === 2 ? '🥈' : rank === 3 ? '🥉' : rank;

        const isCurrentTeam = team.name === teamCode;
        const rowStyle = isCurrentTeam ? 'background: #fff3cd; font-weight: bold;' : '';

        return `
            <tr style="${rowStyle}">
                <td class="rank ${rankClass}" style="padding: 12px 10px; font-size: clamp(18px, 4vw, 24px); font-weight: bold; text-align: center;">
                    ${rankEmoji}
                </td>
                <td style="padding: 12px 10px; font-weight: bold; color: #1a1a2e; text-transform: uppercase;">
                    ${team.name.toUpperCase()}
                </td>
                <td style="padding: 12px 10px; font-weight: bold; color: #28a745;">
                    ${solution.score}/${maxScore}
                </td>
                <td style="padding: 12px 10px;">
                    <span style="display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: clamp(10px, 2vw, 12px); font-weight: bold; background: ${grade.color}; color: ${percentage >= 50 ? '#000' : '#fff'};">
                        ${grade.name}
                    </span>
                </td>
                <td style="padding: 12px 10px;">
                    ${formatTime(solution.completionTimeMs)}
                </td>
            </tr>
        `;
    }).join('');

    cardsContainer.innerHTML = teams.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? `rank-${rank}` : '';
        const solution = team.solution;
        
        const maxScore = solution.maxScore || 140;
        const percentage = Math.round((solution.score / maxScore) * 100);
        const grade = getResultsGrade(percentage);
        const rankEmoji = rank === 1 ? '🥇' : rank === 2 ? '🥈' : rank === 3 ? '🥉' : `#${rank}`;

        const isCurrentTeam = team.name === teamCode;
        const cardStyle = isCurrentTeam ? 'border: 3px solid #ffc107; box-shadow: 0 5px 25px rgba(255,193,7,0.4);' : '';

        return `
            <div style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 15px; ${cardStyle}">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
                    <div class="${rankClass}" style="font-size: 36px; font-weight: bold;">${rankEmoji}</div>
                    <div style="font-size: 18px; font-weight: bold; color: #1a1a2e; text-transform: uppercase; flex: 1; margin: 0 15px;">
                        ${team.name.toUpperCase()}
                    </div>
                    <div style="font-size: 24px; font-weight: bold; color: #28a745;">
                        ${solution.score}/${maxScore}
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f5f5f5;">
                    <div style="font-weight: bold; color: #666; font-size: 13px;">ΤΙΤΛΟΣ</div>
                    <div>
                        <span style="display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: 10px; font-weight: bold; background: ${grade.color}; color: ${percentage >= 50 ? '#000' : '#fff'};">
                            ${grade.name}
                        </span>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                    <div style="font-weight: bold; color: #666; font-size: 13px;">ΧΡΟΝΟΣ</div>
                    <div style="color: #333;">${formatTime(solution.completionTimeMs)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    console.log('✅ Leaderboard displayed successfully');
}

function setupResultsListener() {
    if (!window.firebaseDB) {
        console.warn('Firebase not ready for results listener');
        setTimeout(setupResultsListener, 500);
        return;
    }

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'config', 'leaderboard');
        
        if (resultsUnsubscribe) {
            resultsUnsubscribe();
        }

        resultsUnsubscribe = window.firebaseOnSnapshot(docRef, 
            () => {
                console.log('Leaderboard status changed, updating results tab...');
                const resultsTab = document.getElementById('tab-results');
                if (resultsTab && resultsTab.classList.contains('active')) {
                    updateResultsTabState();
                }
            },
            (error) => {
                console.error('Error listening to leaderboard status:', error);
            }
        );

        console.log('✅ Results tab real-time listener active');
    } catch (error) {
        console.error('Error setting up results listener:', error);
    }
}

function initTabsWithResults() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', async () => {
            const targetTab = button.getAttribute('data-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
            if (targetTab === 'results') {
                await updateResultsTabState();
            }
        });
    });
}

window.addEventListener('DOMContentLoaded', async () => {
    console.log('🔄 Initializing tabs...');
    initTabsWithResults();
    console.log('✅ Tabs initialized');

    const isMemberAuth = sessionStorage.getItem('memberAuth');
    const storedTeam = sessionStorage.getItem('teamCode');
    const memberName = sessionStorage.getItem('memberName');

    if (teamCode === 'default' && !isMemberAuth) {
        console.warn('⚠️ Not authenticated, redirecting to member entry...');
        window.location.href = 'team_member_entry.html';
        return;
    }
    
    if (teamCode === 'default' && storedTeam) {
        console.log('Using stored team:', storedTeam);
        window.location.href = `index.html?team=${storedTeam}`;
        return;
    }
	
    try {
        const teamData = await getTeamData();
        if (!teamData.unlocked) {
            console.warn(`⚠️ Team ${teamCode} has no unlock data, initializing empty array`);
            teamData.unlocked = [];
        }
        
        console.log(`✅ Team ${teamCode} loaded successfully`);
    } catch (error) {
        console.error('Error checking/creating team:', error);
    }
    
    try {
        if (typeof SuspectsModule !== 'undefined') {
            SuspectsModule.renderSuspects('suspectsContainer');
        } else {
            console.error('SuspectsModule not loaded! Make sure suspects.js is included before this script.');
        }
		
        renderEvidence();
        const teamData = await getTeamData();
        await updateProgress(teamData);
        await initSolutionTab(teamData);
        
    } catch (error) {
        console.error('Error during initialization:', error);
        alert('Σφάλμα φόρτωσης! Παρακαλώ ανανεώστε τη σελίδα.');
    }

    setInterval(async () => {
        const solutionTab = document.getElementById('tab-solution');
        if (solutionTab && solutionTab.classList.contains('active')) {
            const teamData = await getTeamData();
            const solutionForm = document.getElementById('solutionForm');
            if (teamData.solution && solutionForm && solutionForm.style.display !== 'none') {
                console.log('Solution detected from another source, refreshing display...');
                await initSolutionTab(teamData);
            }
        }
    }, 5000);

    let firestoreUnsubscribe = null;

    function setupRealtimeListener() {
        if (!window.firebaseDB || !window.firebaseOnSnapshot) {
            console.warn('Firebase not ready, falling back to polling');
            setInterval(checkForUpdates, 3000);
            return;
        }
        
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            
            firestoreUnsubscribe = window.firebaseOnSnapshot(docRef, 
                (doc) => {
                    if (doc.exists()) {
                        const firebaseData = doc.data();
                        console.log('⚡ Real-time update received for team:', teamCode);
                        
                        localStorage.setItem(getStorageKey(), JSON.stringify(firebaseData));
                        renderEvidence();
                        updateProgress(firebaseData);
                        
                        const solutionTab = document.getElementById('tab-solution');
                        if (solutionTab && solutionTab.classList.contains('active')) {
                            initSolutionTab(firebaseData);
                        }
                    }
                }, 
                (error) => {
                    console.error('Real-time listener error:', error);
                    setInterval(checkForUpdates, 3000);
                }
            );
            
            console.log('✅ Real-time listener active for team:', teamCode);
        } catch (error) {
            console.error('Error setting up real-time listener:', error);
            setInterval(checkForUpdates, 3000);
        }
    }

    async function checkForUpdates() {
        if (!window.firebaseDB) return;
        
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            const docSnap = await window.firebaseGetDoc(docRef);
            
            if (docSnap.exists()) {
                const firebaseData = docSnap.data();
                const localData = await getTeamData();
                
                if (firebaseData.lastUpdate && 
                    (!localData.lastUpdate || firebaseData.lastUpdate > localData.lastUpdate)) {
                    
                    localStorage.setItem(getStorageKey(), JSON.stringify(firebaseData));
                    renderEvidence();
                    await updateProgress(firebaseData);
                }
            }
        } catch (error) {
            console.error('Error checking for updates:', error);
        }
    }

    setTimeout(() => {
        setupRealtimeListener();
    }, 500);
    
    setTimeout(() => {
        setupResultsListener();
    }, 1000);
});

window.addEventListener('resize', () => {
    const table = document.getElementById('resultsTable');
    const cards = document.getElementById('resultsCards');
    
    if (table && cards) {
        if (window.innerWidth > 768) {
            table.style.display = 'table';
            cards.style.display = 'none';
        } else {
            table.style.display = 'none';
            cards.style.display = 'block';
        }
    }
});

window.addEventListener('beforeunload', () => {
    stopTimer();
    if (firestoreUnsubscribe) {
        firestoreUnsubscribe();
    }
    if (resultsUnsubscribe) {
        resultsUnsubscribe();
    }
});


</script>

</body>
</html>
