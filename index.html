<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¦Î¬ÎºÎµÎ»Î¿Ï‚ Î¥Ï€ÏŒÎ¸ÎµÏƒÎ·Ï‚ - Î¦ÎµÏƒÏ„Î¹Î²Î¬Î» Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÎ®Ï‚ Î›Î¿Î³Î¿Ï„ÎµÏ‡Î½Î¯Î±Ï‚ 2025</title>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA_9_40aa_wO_19g-1bIrSB6742aMOPwjo",
            authDomain: "crime-festival-2025.firebaseapp.com",
            projectId: "crime-festival-2025",
            storageBucket: "crime-festival-2025.firebasestorage.app",
            messagingSenderId: "663770004335",
            appId: "1:663770004335:web:e42dbd983ab9b5277bc69a"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

window.firebaseDB = db;
window.firebaseDoc = doc;
window.firebaseSetDoc = setDoc;
window.firebaseGetDoc = getDoc;
window.firebaseOnSnapshot = onSnapshot;
window.firebaseCollection = collection;
window.firebaseGetDocs = getDocs;
        
        console.log("âœ… Firebase connected in index.html!");
    </script>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    min-height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    position: relative;
    overflow-x: hidden;
}

.animated-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.1;
    background-image: repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,107,0,0.5) 35px, rgba(255,107,0,0.5) 70px);
    animation: slide 20s linear infinite;
}

@keyframes slide {
    0% { transform: translateX(0); }
    100% { transform: translateX(70px); }
}

.header {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    padding: clamp(20px, 4vw, 30px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    position: relative;
    z-index: 10;
    text-align: center;
}

.header h1 {
    color: #000;
    font-size: clamp(18px, 5vw, 32px);
    font-weight: bold;
    letter-spacing: clamp(1px, 0.3vw, 2px);
    text-shadow: 2px 2px 4px rgba(255,255,255,0.3);
    margin-bottom: 10px;
    word-wrap: break-word;
}

.header p {
    color: #1a1a1a;
    font-size: clamp(13px, 3vw, 16px);
    font-weight: bold;
}

.team-info {
    background: rgba(0,0,0,0.2);
    padding: clamp(8px, 2vw, 10px) clamp(15px, 3vw, 20px);
    border-radius: 8px;
    margin-top: 15px;
    display: block;
    max-width: 96%;
    margin-left: auto;
    margin-right: auto;
}

.team-info strong {
    color: #fff;
    font-size: clamp(12px, 2.5vw, 14px);
    text-transform: uppercase;
}

.logout-btn {
    position: absolute;
    top: clamp(15px, 3vw, 20px);
    right: clamp(10px, 2vw, 20px);
    padding: clamp(10px, 2vw, 12px) clamp(12px, 2.5vw, 20px);
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: clamp(11px, 2vw, 14px);
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(220,53,69,0.3);
    transition: all 0.2s ease;
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220,53,69,0.5);
}

.container {
    padding: clamp(20px, 4vw, 40px) clamp(15px, 3vw, 20px);
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

.timer-section {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #17a2b8;
    border-radius: 12px;
    padding: clamp(15px, 3vw, 20px);
    margin-bottom: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    display: none;
}

.timer-section h2 {
    color: #1a1a2e;
    font-size: clamp(14px, 3vw, 16px);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.timer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.timer-box {
    background: #f8f9fa;
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 8px;
    border-left: 4px solid #17a2b8;
    min-height: 70px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.timer-box strong {
    display: block;
    color: #0f3460;
    font-size: clamp(10px, 2vw, 11px);
    margin-bottom: 6px;
    text-transform: uppercase;
}

.timer-box .value {
    font-size: clamp(18px, 4vw, 20px);
    font-weight: bold;
    color: #17a2b8;
    font-family: monospace;
}

.tabs-container {
    margin-bottom: clamp(25px, 5vw, 40px);
}

.tabs-nav {
    display: flex;
    gap: 8px;
    margin-bottom: 25px;
    flex-wrap: wrap;
    background: rgba(0, 0, 0, 0.2);
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 12px;
}

.tab-button {
    flex: 1 1 auto;
    min-width: clamp(120px, 30%, 150px);
    padding: clamp(12px, 2.5vw, 15px) clamp(15px, 3vw, 20px);
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 107, 0, 0.3);
    border-radius: 10px;
    color: #fff;
    font-size: clamp(11px, 2.5vw, 14px);
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.tab-button:hover,
.tab-button:focus {
    background: rgba(255, 107, 0, 0.2);
    border-color: rgba(255, 107, 0, 0.6);
    transform: translateY(-2px);
    outline: none;
}

.tab-button.active {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    border-color: #ff6b00;
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4);
    color: #000;
}

.intro-box,
.forensic-box,
.timeline-box,
.story-box {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(20px, 4vw, 30px);
    margin-bottom: clamp(25px, 5vw, 40px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.forensic-box {
    border-color: #28a745;
}

.timeline-box,
.story-box {
    border-color: #6c757d;
}

.intro-box h2,
.forensic-box h2,
.timeline-box h2,
.story-box h2 {
    color: #1a1a2e;
    font-size: clamp(16px, 3.5vw, 18px);
    text-transform: uppercase;
    border-bottom: 2px solid #000;
    padding-bottom: 8px;
    margin-bottom: clamp(15px, 3vw, 20px);
    letter-spacing: 1px;
}

.intro-box p,
.forensic-box p,
.timeline-box p,
.story-box p {
    color: #333;
    line-height: 1.7;
    font-size: clamp(13px, 2.8vw, 14px);
    margin: 12px 0;
    text-align: justify;
    word-wrap: break-word;
}

.intro-box p strong,
.forensic-box p strong {
    color: #000;
}

.red-highlight {
    color: #dc3545;
    font-weight: bold;
    background: rgba(220,53,69,0.1);
    padding: 2px 6px;
    border-radius: 3px;
}

.timeline-item {
    margin: 8px 0;
    padding-left: clamp(18px, 4vw, 20px);
    position: relative;
    color: #333;
    font-size: clamp(12px, 2.8vw, 13px);
    line-height: 1.6;
    text-align: justify;
    word-wrap: break-word;
}

.timeline-item::before {
    content: "â—‰";
    position: absolute;
    left: 0;
    font-size: 11px;
    color: #000;
}

.timeline-item strong {
    color: #1a1a2e;
    font-weight: 600;
}

.timeline-critical {
    color: #dc3545;
    font-weight: bold;
    background: rgba(220,53,69,0.1);
    padding: 2px 6px;
    border-radius: 3px;
}

.progress-bar-container {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(20px, 4vw, 25px);
    margin-bottom: clamp(25px, 5vw, 40px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
}

.progress-title {
    color: #1a1a2e;
    font-size: clamp(16px, 4vw, 20px);
    margin-bottom: 15px;
    font-weight: bold;
}

.progress-bar {
    background: #e0e0e0;
    height: clamp(25px, 5vw, 30px);
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    margin-bottom: 10px;
}

.progress-fill {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    height: 100%;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: clamp(12px, 3vw, 14px);
}

.progress-text {
    color: #666;
    font-size: clamp(13px, 3vw, 16px);
    text-align: center;
}

.section-title {
    color: #fff;
    margin-bottom: 25px;
    font-size: clamp(18px, 4vw, 24px);
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255, 107, 0, 0.5);
    flex-wrap: wrap;
}

.evidence-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 300px), 1fr));
    gap: clamp(15px, 3vw, 25px);
    margin-bottom: clamp(25px, 5vw, 40px);
}

.evidence-card {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #ff6b00;
    border-radius: 12px;
    padding: clamp(18px, 4vw, 25px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    min-height: 200px;
    display: flex;
    flex-direction: column;
}

.evidence-card.unlocked:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px rgba(255, 107, 0, 0.4);
}

.evidence-card.locked {
    opacity: 0.6;
    border-color: #999;
    background: rgba(200, 200, 200, 0.95);
}

.evidence-header {
    display: flex;
    align-items: center;
    gap: clamp(10px, 2vw, 15px);
    margin-bottom: 15px;
}

.evidence-icon {
    width: clamp(50px, 10vw, 60px);
    height: clamp(50px, 10vw, 60px);
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(24px, 5vw, 30px);
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
    flex-shrink: 0;
}

.evidence-card.locked .evidence-icon {
    background: linear-gradient(135deg, #999 0%, #666 100%);
    filter: grayscale(100%);
}

.evidence-info h3 {
    color: #1a1a2e;
    font-size: clamp(16px, 3.5vw, 20px);
    margin-bottom: 5px;
    font-family: monospace;
    letter-spacing: 1px;
    word-wrap: break-word;
}

.evidence-card.locked .evidence-info h3 {
    color: #666;
}

.evidence-info p {
    color: #666;
    font-size: clamp(12px, 2.5vw, 14px);
    line-height: 1.4;
}

.evidence-description {
    color: #333;
    line-height: 1.6;
    margin-bottom: 20px;
    font-size: clamp(12px, 2.8vw, 14px);
    flex-grow: 1;
}

.evidence-card.locked .evidence-description {
    color: #999;
}

.evidence-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: auto;
}

.btn {
    padding: clamp(12px, 2.5vw, 14px) clamp(20px, 4vw, 24px);
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    font-size: clamp(12px, 2.8vw, 14px);
    border: 2px solid transparent;
    cursor: pointer;
    min-height: 48px;
    min-width: 48px;
    text-align: center;
}

.btn:hover:not(:disabled),
.btn:focus:not(:disabled) {
    transform: translateY(-2px);
    outline: none;
}

.btn-ar {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(255, 107, 0, 0.3);
}

.btn-ar:hover:not(:disabled) {
    box-shadow: 0 6px 20px rgba(255, 107, 0, 0.5);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #ccc;
    color: #666;
}

.btn-primary {
    background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%);
    color: #000;
    font-weight: bold;
}

.status-badge {
    display: inline-block;
    padding: clamp(5px, 1.5vw, 6px) clamp(10px, 2vw, 12px);
    border-radius: 6px;
    font-size: clamp(11px, 2.2vw, 12px);
    font-weight: bold;
    margin-top: 10px;
}

.status-unlocked {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-locked {
    background: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
}

.critical-tag {
    position: absolute;
    top: clamp(12px, 2.5vw, 15px);
    right: clamp(12px, 2.5vw, 15px);
    background: #dc3545;
    color: white;
    padding: clamp(3px, 1vw, 4px) clamp(6px, 1.5vw, 8px);
    border-radius: 4px;
    font-size: clamp(9px, 2vw, 11px);
    font-weight: bold;
}

.lock-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(36px, 8vw, 48px);
    opacity: 0.3;
}


.suspects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 320px), 1fr));
    gap: clamp(18px, 4vw, 25px);
    margin-top: 20px;
}

.suspect-card {
    background: rgba(255, 255, 255, 0.95);
    border: 3px solid #dc3545;
    border-radius: 12px;
    padding: clamp(15px, 3vw, 20px);
    box-shadow: 0 10px 40px rgba(220, 53, 69, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.suspect-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px rgba(220, 53, 69, 0.5);
}

.suspect-photo-container {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
}

.suspect-canvas {
    border: 3px solid #333;
    box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
    transform: rotate(-1deg);
    background: #f5f5f5;
    max-width: 100%;
    height: auto;
}

.suspect-number {
    position: absolute;
    top: -10px;
    right: 10px;
    background: #dc3545;
    color: white;
    padding: clamp(4px, 1vw, 5px) clamp(10px, 2vw, 12px);
    border-radius: 6px;
    font-size: clamp(10px, 2vw, 11px);
    font-weight: bold;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}

.suspect-details {
    font-size: clamp(12px, 2.8vw, 13px);
    line-height: 1.6;
}

.suspect-details h3 {
    color: #1a1a2e;
    font-size: clamp(14px, 3vw, 16px);
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #dc3545;
    font-family: monospace;
    letter-spacing: 0.5px;
}

.suspect-field {
    margin-bottom: 10px;
    padding: clamp(6px, 1.5vw, 8px);
    background: rgba(0,0,0,0.02);
    border-radius: 4px;
    text-align: justify;
    word-wrap: break-word;
}

.suspect-field strong {
    color: #dc3545;
    display: block;
    margin-bottom: 3px;
    font-size: clamp(10px, 2.2vw, 11px);
    letter-spacing: 0.5px;
}

.solution-form {
    background: white;
    padding: clamp(20px, 4vw, 25px);
    border-radius: 10px;
    margin: 20px 0;
}

.solution-form h3 {
    color: #1a1a2e;
    margin-bottom: 20px;
    font-size: clamp(16px, 3.5vw, 20px);
}

.suspect-options {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(100%, 250px), 1fr));
    gap: clamp(12px, 2.5vw, 15px);
    margin: 20px 0;
}

.suspect-option {
    background: #f8f9fa;
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: clamp(12px, 2.5vw, 15px);
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: 56px;
    display: flex;
    align-items: center;
}

.suspect-option:hover {
    border-color: #ff6b00;
    background: #fff5f0;
    transform: translateY(-2px);
}

.suspect-option input[type="checkbox"] {
    width: clamp(20px, 4vw, 24px);
    height: clamp(20px, 4vw, 24px);
    margin-right: clamp(10px, 2vw, 12px);
    cursor: pointer;
    flex-shrink: 0;
}

.suspect-option label {
    cursor: pointer;
    display: flex;
    align-items: center;
    font-weight: bold;
    color: #1a1a2e;
    font-size: clamp(13px, 2.8vw, 14px);
    flex-grow: 1;
}

.suspect-option input[type="checkbox"]:checked + label {
    color: #ff6b00;
}

.form-group {
    margin: clamp(18px, 4vw, 20px) 0;
}

.form-group label {
    display: block;
    font-weight: bold;
    color: #1a1a2e;
    margin-bottom: 10px;
    font-size: clamp(13px, 2.8vw, 14px);
}

.form-group textarea {
    width: 100%;
    min-height: clamp(120px, 25vw, 150px);
    padding: clamp(12px, 2.5vw, 15px);
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: clamp(13px, 2.8vw, 14px);
    font-family: inherit;
    resize: vertical;
}

.form-group input[type="number"] {
    width: 100%;
    max-width: 200px;
    padding: clamp(10px, 2vw, 12px);
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: clamp(14px, 3vw, 16px);
    min-height: 48px;
}

.form-group textarea:focus,
.form-group input:focus {
    outline: none;
    border-color: #ff6b00;
}

.submit-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: clamp(14px, 3vw, 16px) clamp(30px, 6vw, 40px);
    border: none;
    border-radius: 10px;
    font-size: clamp(15px, 3.5vw, 18px);
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(40,167,69,0.3);
    transition: all 0.2s ease;
    width: 100%;
    min-height: 56px;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40,167,69,0.5);
}

.info-box {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
    padding: clamp(12px, 2.5vw, 15px);
    border-radius: 8px;
    margin: 15px 0;
    font-size: clamp(12px, 2.5vw, 13px);
    color: #0d47a1;
    line-height: 1.6;
}

.footer {
    background: rgba(255, 255, 255, 0.1);
    padding: clamp(15px, 3vw, 20px);
    text-align: center;
    color: #fff;
    border-top: 2px solid rgba(255, 107, 0, 0.3);
    margin-top: clamp(30px, 6vw, 40px);
}

.footer p {
    margin: 5px 0;
    font-size: clamp(12px, 2.5vw, 14px);
    opacity: 0.9;
}

.tabs-content {
    position: relative;
}

.tab-pane {
    display: none;
    animation: fadeIn 0.3s ease;
}

.tab-pane.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (min-width: 576px) {
    .header {
        padding: 25px 20px;
    }
    
    .header h1 {
        font-size: clamp(24px, 5vw, 28px);
    }
    
    .tabs-nav {
        gap: 10px;
    }
    
    .tab-button {
        min-width: 140px;
    }
    
    .evidence-grid,
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
    
    .suspect-options {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    }
    
    .submit-btn {
        width: auto;
        min-width: 200px;
    }
}

@media (min-width: 768px) {
    .header {
        padding: 30px 20px;
    }
    
    .header h1 {
        font-size: 32px;
    }
    
    .header p {
        font-size: 16px;
    }
    
    .container {
        padding: 40px 20px;
    }
    
    .tabs-nav {
        flex-wrap: nowrap;
    }
    
    .tab-button {
        flex: 1;
        min-width: 150px;
    }
    
    .evidence-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
    
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
    
    .suspect-options {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    }
    
    .timer-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .evidence-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
    
    .suspects-grid {
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
    
    .evidence-actions {
        flex-direction: row;
    }
    
    .btn {
        width: auto;
    }
}

@media (min-width: 1440px) {
    .container {
        max-width: 1400px;
    }
}


@media (max-width: 768px) and (orientation: landscape) {
    .header {
        padding: 15px 20px;
    }
    
    .container {
        padding: 20px 15px;
    }
    
    .timer-section h2 {
        font-size: 14px;
    }
    
    .tab-button {
        padding: 10px 15px;
        min-height: 42px;
    }
}


*:focus-visible {
    outline: 3px solid #ff6b00;
    outline-offset: 2px;
}

button:focus-visible,
.btn:focus-visible,
.tab-button:focus-visible {
    outline: 3px solid #ff6b00;
    outline-offset: 2px;
}

.survey-tab-content {
    text-align: center;
    padding: clamp(30px, 8vw, 60px) clamp(20px, 5vw, 40px);
}

.survey-icon {
    font-size: clamp(50px, 15vw, 80px);
    margin-bottom: clamp(20px, 5vw, 30px);
}

.survey-title {
    font-size: clamp(18px, 4vw, 28px) !important;
    margin-bottom: clamp(15px, 4vw, 20px) !important;
}

.intro-box .survey-btn.btn.btn-primary {
    font-size: clamp(16px, 3.5vw, 20px);
    padding: clamp(15px, 3vw, 20px) clamp(30px, 6vw, 50px);
}

@media print {
    .animated-background,
    .header button,
    .tabs-nav,
    .evidence-actions {
        display: none !important;
    }
    
    .container {
        max-width: 100%;
        padding: 20px;
    }
    
    .tab-pane {
        display: block !important;
    }
}
@keyframes swing {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-10deg); }
    75% { transform: rotate(10deg); }
}

.loading-dots {
    display: inline-block;
    margin-left: 5px;
}

.loading-dots span {
    animation: blink 1.4s infinite;
    animation-fill-mode: both;
}

.loading-dots span:nth-child(2) {
    animation-delay: 0.2s;
}

.loading-dots span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes blink {
    0%, 80%, 100% { opacity: 0; }
    40% { opacity: 1; }
}

.stat-card {
    background: white;
    padding: 20px 15px;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    text-align: center;
}

.stat-card h3 {
    color: #666;
    font-size: clamp(11px, 2.5vw, 14px);
    margin-bottom: 10px;
    text-transform: uppercase;
}

.stat-card .value {
    font-size: clamp(24px, 6vw, 32px);
    font-weight: bold;
    color: #ff6b00;
}

</style>

</head>

<body>
    <div class="animated-background"></div>

<div class="header">
        <h1>âš ï¸ Î¦Î‘ÎšÎ•Î›ÎŸÎ£ Î¥Î ÎŸÎ˜Î•Î£Î—Î£ âš ï¸</h1>
        <div class="team-info" id="teamInfo" style="display: none;">
            <strong id="teamName"></strong>
        </div>
    </div>

    <div class="container">
        <div class="timer-section" id="timerSection">
            <h2>â±ï¸Î§Î¡ÎŸÎÎŸÎœÎ•Î¤Î¡Î—Î£Î— ÎŸÎœÎ‘Î”Î‘Î£</h2>
            <div class="timer-grid">
                <div class="timer-box">
                    <strong>ÎˆÎ½Î±ÏÎ¾Î·</strong>
                    <div class="value" id="startTime">--:--</div>
                </div>
                <div class="timer-box">
                    <strong id="liveTimerLabel">Î§ÏÏŒÎ½Î¿Ï‚</strong>
                    <div class="value" id="liveTimer">0Î» 0Î´</div>
                </div>
            </div>
        </div>

<div class="tabs-container">
    <div class="tabs-nav">
        <button class="tab-button active" data-tab="intro">ğŸ“‹ Î Î•Î¡Î™Î£Î¤Î‘Î¤Î™ÎšÎŸ</button>
        <button class="tab-button" data-tab="forensics">ğŸ¥¼ Î™Î‘Î¤Î¡ÎŸÎ”Î™ÎšÎ‘Î£Î¤Î™ÎšÎ— & Î§Î¡ÎŸÎÎŸÎ›ÎŸÎ“Î™ÎŸ</button>
        <button class="tab-button" data-tab="suspects">ğŸ‘¥ ÎšÎ‘Î¤Î‘Î›ÎŸÎ“ÎŸÎ£ Î¥Î ÎŸÎ Î¤Î©Î</button>
        <button class="tab-button" data-tab="evidence">ğŸ“¦ Î¤Î•ÎšÎœÎ—Î¡Î™Î‘</button>
        <button class="tab-button" data-tab="solution">âœ… Î›Î¥Î£Î—</button>
        <button class="tab-button" data-tab="survey">ğŸ“Š Î•Î¡Î•Î¥ÎÎ‘</button>
        <button class="tab-button" data-tab="results">ğŸ† ÎšÎ‘Î¤Î‘Î¤Î‘ÎÎ—</button>
    </div>

            <div class="tabs-content">
                <div class="tab-pane active" id="tab-intro">
                    <div class="intro-box">
                        <h2>ğŸ“‹ Î Î•Î¡Î™Î£Î¤Î‘Î¤Î™ÎšÎŸ</h2>
                        <p><strong>Î˜Î¥ÎœÎ‘:</strong> Î”Î—ÎœÎ—Î¤Î¡Î™ÎŸÎ¥ Î Î•Î¤Î¡ÎŸÎ£ Ï„Î¿Ï… Î™Î©Î‘ÎÎÎ—, Î‘Î¦Îœ: 074XXXXXX</p>
                        <p><strong>Î—Î›Î™ÎšÎ™Î‘:</strong> 55 ÎµÏ„ÏÎ½ | <strong>ÎŸÎ™Îš. ÎšÎ‘Î¤Î‘Î£Î¤Î‘Î£Î—:</strong> Î”Î¹Î±Î¶ÎµÏ…Î³Î¼Î­Î½Î¿Ï‚, 2 Ï„Î­ÎºÎ½Î±</p>
                        <p><strong>Î•Î Î‘Î“Î“Î•Î›ÎœÎ‘:</strong> Î•ÎºÎ´ÏŒÏ„Î·Ï‚, Î™Î´ÏÏ…Ï„Î®Ï‚/CEO Â«Î›ÎŸÎ“ÎŸÎ£ Î•ÎšÎ”ÎŸÎ£Î•Î™Î£ Î‘.Î•.Â»</p>
                        <p><strong>Î¤ÎŸÎ ÎŸÎ£ Î•Î¥Î¡Î•Î£Î—Î£:</strong> Î™Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î³ÏÎ±Ï†ÎµÎ¯Î¿, Î£Ï„Î±Î´Î¯Î¿Ï… 47, 7Î¿Ï‚ ÏŒÏÎ¿Ï†Î¿Ï‚</p>
                        <p><strong>Î—ÎœÎ•Î¡Î‘ Î•Î¥Î¡Î•Î£Î—Î£:</strong> Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® 31/10, 07:00 Ï€.Î¼. | <strong>ÎšÎ›Î—Î£Î— Î‘Î£Î¤Î¥ÎÎŸÎœÎ™Î‘Î£:</strong> 07:03</p>
                        <p style="font-style: italic; color: #00008b; margin-top: 15px;">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î± Î¶Ï‰Î®Ï‚ â‚¬1ÎµÎº. - Î±ÎºÏ…ÏÏÎ½ÎµÏ„Î±Î¹ ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚</p>
                    </div>

                    <div class="story-box">
                        <h2>ğŸ“– Î— Î¥Î ÎŸÎ˜Î•Î£Î—</h2>
                        <p>ÎŸ Î Î­Ï„ÏÎ¿Ï‚ Î”Î·Î¼Î·Ï„ÏÎ¯Î¿Ï… Î®Ï„Î±Î½ Î³Î½Ï‰ÏƒÏ„ÏŒÏ‚ ÎµÎºÎ´Î¿Ï„Î¹ÎºÏŒÏ‚ Î¼ÎµÎ³Î¹ÏƒÏ„Î¬Î½Î±Ï‚ Î¼Îµ ÎµÏ€Î¹Ï„Ï…Ï‡Î·Î¼Î­Î½Î· ÎºÎ±ÏÎ¹Î­ÏÎ± Ï„ÏÎ¹ÏÎ½ Î´ÎµÎºÎ±ÎµÏ„Î¹ÏÎ½. Î ÏÎ¹Î½ Î±Ï€ÏŒ Ï„ÏÎµÎ¹Ï‚ ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚ Î­Î»Î±Î²Îµ Î¼Î¹Î± Î´Î¹Î¬Î³Î½Ï‰ÏƒÎ· Ï€Î¿Ï… Î¬Î»Î»Î±Î¾Îµ Ï„Î± Ï€Î¬Î½Ï„Î±: ÎºÎ±ÏÎºÎ¯Î½Î¿Ï‚ Ï€Î±Î³ÎºÏÎ­Î±Ï„Î¿Ï‚ Ï„ÎµÎ»Î¹ÎºÎ¿Ï ÏƒÏ„Î±Î´Î¯Î¿Ï…, Î¼Îµ Ï€ÏÎ¿ÏƒÎ´ÏŒÎºÎ¹Î¼Î¿ Î¶Ï‰Î®Ï‚ 2-3 Î¼Î®Î½ÎµÏ‚. Î— ÎµÎ¯Î´Î·ÏƒÎ· Î®Ï„Î±Î½ Î³Î½Ï‰ÏƒÏ„Î® Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿Î½ Î¹Î±Ï„ÏÏŒ Ï„Î¿Ï…, Ï„Î· Î³ÏÎ±Î¼Î¼Î±Ï„Î­Î± Ï„Î¿Ï… ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÏÎ·Î½ ÏƒÏÎ¶Ï…Î³ÏŒ Ï„Î¿Ï….</p>
                        <p>Î¤Î¿ Ï€ÏÏ‰Î¯ Ï„Î·Ï‚ Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®Ï‚ 31 ÎŸÎºÏ„Ï‰Î²ÏÎ¯Î¿Ï…, Î· ÎºÎ±Î¸Î±ÏÎ¯ÏƒÏ„ÏÎ¹Î± ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï… Ï†Ï„Î¬Î½ÎµÎ¹ Î³Î¹Î± Ï„Î¿Î½ ÏƒÏ…Î½Î·Î¸Î¹ÏƒÎ¼Î­Î½Î¿ ÎºÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒ Ï„Î¿Ï… Î³ÏÎ±Ï†ÎµÎ¯Î¿Ï… Ï„Î¿Ï… ÏƒÏ„Î¿Î½ 7Î¿ ÏŒÏÎ¿Ï†Î¿ ÎºÎ±Î¹ Î±Î½Î±ÎºÎ±Î»ÏÏ€Ï„ÎµÎ¹ Ï„Î¿ Î¬ÏˆÏ…Ï‡Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï… ÏƒÏ„Î¹Ï‚ Ï„Î¿Ï…Î±Î»Î­Ï„ÎµÏ‚ Ï„Î¿Ï… Î¿ÏÏŒÏ†Î¿Ï…. Î£Ï„Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î® Ï„Î¿Ï… Î³ÏÎ±Ï†ÎµÎ¯Î¿Ï… Î²ÏÎ­Î¸Î·ÎºÎµ Î­Î½Î± email Â«Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚Â» Î±Ï€Î¿ÏƒÏ„Î±Î»Î¼Î­Î½Î¿ ÏƒÏ„Î¹Ï‚ 21:25 Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î²ÏÎ¬Î´Ï…. ÎŸÎ¹ Ï€ÏÏÏ„ÎµÏ‚ ÎµÎ½Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚ Î­Î´ÎµÎ¹Ï‡Î½Î±Î½ Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î± Î±Ï€ÏŒ Î´Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· Î¼Îµ ÎºÏ…Î¬Î½Î¹Î¿.</p>
                        <p>Î©ÏƒÏ„ÏŒÏƒÎ¿, Î· ÎµÎ¾Î­Ï„Î±ÏƒÎ· Ï„Î·Ï‚ ÏƒÎºÎ·Î½Î®Ï‚ ÎºÎ±Î¹ Î· Î±Î½Î¬ÎºÏÎ¹ÏƒÎ· Ï„Î¿Ï… Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¿Ï Î±Ï€Î¿ÎºÎ¬Î»Ï…ÏˆÎ±Î½ Î±Î½Ï‰Î¼Î±Î»Î¯ÎµÏ‚ Ï€Î¿Ï… Ï€ÏÎ¿ÎºÎ±Î»Î¿ÏÎ½ Ï…Ï€Î¿ÏˆÎ¯ÎµÏ‚...</p>
                    </div>
                </div>
                <div class="tab-pane" id="tab-forensics">
                    <div class="forensic-box">
                        <h2>ğŸ¥¼ Î™Î‘Î¤Î¡ÎŸÎ”Î™ÎšÎ‘Î£Î¤Î™ÎšÎ— Î•ÎšÎ˜Î•Î£Î—</h2>
                        <p><strong>Î¤ÎŸÎ ÎŸÎ£ Î•Î¥Î¡Î•Î£Î—Î£:</strong> Î¤Î¿Ï…Î±Î»Î­Ï„ÎµÏ‚, 7Î¿Ï‚ ÏŒÏÎ¿Ï†Î¿Ï‚</p>
                        <p><strong>Î©Î¡Î‘ Î˜Î‘ÎÎ‘Î¤ÎŸÎ¥:</strong> 21:30 - 21:50 (Î±ÎºÏÎ¯Î²ÎµÎ¹Î± Â±10 Î»ÎµÏ€Ï„Î¬)</p>
                        <p><strong>Î‘Î™Î¤Î™Î‘:</strong> ÎŸÎ¾ÎµÎ¯Î± Î´Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· Î±Ï€ÏŒ ÎºÏ…Î±Î½Î¹Î¿ÏÏ‡Î¿ ÎºÎ¬Î»Î¹Î¿ (75mg ÎµÎ½Ï„ÎµÏÎ¿Î´Î¹Î±Î»Ï…Ï„Î® ÎºÎ¬ÏˆÎ¿Ï…Î»Î±)</p>
                        <p><strong>Î¤ÎŸÎÎ™ÎšÎŸÎ›ÎŸÎ“Î™ÎšÎ—:</strong> Î‘Î»ÎºÎ¿ÏŒÎ» 0.12%, Î±Î»Ï€ÏÎ±Î¶Î¿Î»Î¬Î¼Î· 2mg (ÎµÎ½Î¹ÏƒÏ‡ÏÎµÎ¹ Î´ÏÎ¬ÏƒÎ· ÎºÏ…Î±Î½Î¯Î¿Ï…)</p>
                        <p><strong>Î¤Î¡Î‘Î¥ÎœÎ‘Î¤Î‘:</strong> ÎšÎ±Î½Î­Î½Î± Î±Î¼Ï…Î½Ï„Î¹ÎºÏŒ Ï„ÏÎ±ÏÎ¼Î± - Ï„Î¿ Î¸ÏÎ¼Î± Î´ÎµÎ½ Î±Î½Ï„Î¹ÏƒÏ„Î¬Î¸Î·ÎºÎµ</p>
                        <p><strong>Î Î‘Î˜ÎŸÎ›ÎŸÎ“Î™ÎšÎ—:</strong> <span class="red-highlight">ÎšÎ±ÏÎºÎ¯Î½Î¿Ï‚ Ï€Î±Î³ÎºÏÎ­Î±Ï„Î¿Ï‚ Ï„ÎµÎ»Î¹ÎºÎ¿Ï ÏƒÏ„Î±Î´Î¯Î¿Ï… - Ï€ÏÎ¿ÏƒÎ´ÏŒÎºÎ¹Î¼Î¿ Î¶Ï‰Î®Ï‚ 2-3 Î¼Î®Î½ÎµÏ‚</span></p>
                    </div>
                    <div class="timeline-box">
                        <h2>ğŸ• Î§Î¡ÎŸÎÎŸÎ›ÎŸÎ“Î™ÎŸ Î£Î¥ÎœÎ’Î‘ÎÎ¤Î©Î</h2>
                        <div class="timeline-item"><strong>17:30-18:30</strong> - ÎŸÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿Î¹ Ï…Ï€Î¬Î»Î»Î·Î»Î¿Î¹ Î±Ï€Î¿Ï‡Ï‰ÏÎ¿ÏÎ½ Î±Ï€ÏŒ Ï„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿</div>
                        <div class="timeline-item"><strong>19:00</strong> - Î Î±ÏÎ¬Î´Î¿ÏƒÎ· Ï†Î±Î³Î·Ï„Î¿Ï ÏƒÏ„Î¿ Î³ÏÎ±Ï†ÎµÎ¯Î¿ Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚ (Î³Î¹Î± 2 Î¬Ï„Î¿Î¼Î±)</div>
                        <div class="timeline-item"><strong>20:00-21:00</strong> - ÎšÏÎ¯ÏƒÎ¹Î¼Î¿ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿ - Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿</div>
                        <div class="timeline-item"><strong>20:45</strong> - SMS ÏƒÏ„Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚: Â«Î˜Î± Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ Î±Ï€ÏŒÏˆÎµÂ»</div>
                        <div class="timeline-item"><strong>21:25</strong> - Email Â«Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚Â» Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹</div>
                        <div class="timeline-item"><strong>21:30-21:50</strong> - <span class="timeline-critical">Î˜Î‘ÎÎ‘Î¤ÎŸÎ£ Î˜Î¥ÎœÎ‘Î¤ÎŸÎ£</span></div>
                        <div class="timeline-item"><strong>07:00 (ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î¼Î­ÏÎ±)</strong> - Î‘Î½Î±ÎºÎ¬Î»Ï…ÏˆÎ· Ï€Ï„ÏÎ¼Î±Ï„Î¿Ï‚ Î±Ï€ÏŒ ÎºÎ±Î¸Î±ÏÎ¯ÏƒÏ„ÏÎ¹Î±</div>
                    </div>
                </div>

                <div class="tab-pane" id="tab-suspects">
                    <div id="suspectsContainer"></div>
                </div>

                <div class="tab-pane" id="tab-evidence">
                    <div class="progress-bar-container">
                        <div class="progress-title">ğŸ“Š Î Î¡ÎŸÎŸÎ”ÎŸÎ£ Î•Î¡Î•Î¥ÎÎ‘Î£</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                        <div class="progress-text" id="progressText">Î•Î§Î•Î¤Î• ÎÎ•ÎšÎ›Î•Î™Î”Î©Î£Î•Î™ 0 Î‘Î ÎŸ 11 Î¤Î•ÎšÎœÎ—Î¡Î™Î‘</div>
                    </div>
					
					</div>

    <div style="text-align: center; margin: 25px 0;">
        <button onclick="window.location.href='qr_scanner.html'" 
                style="background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); 
                       color: white; 
                       padding: 18px 40px; 
                       border: none; 
                       border-radius: 12px; 
                       font-size: 18px; 
                       font-weight: bold; 
                       cursor: pointer; 
                       box-shadow: 0 4px 15px rgba(255,107,0,0.4);
                       transition: all 0.3s ease;
                       min-height: 56px;
                       display: inline-flex;
                       align-items: center;
                       gap: 10px;"
                onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(255,107,0,0.6)'"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,107,0,0.4)'">
            ğŸ“· Î£Î‘Î¡Î©Î£Î— QR CODE
        </button>
    </div>

    <h2 class="section-title">ğŸ“¦ Î¤Î•ÎšÎœÎ—Î¡Î™Î‘ Î‘Î ÎŸ Î¤Î— Î£ÎšÎ—ÎÎ— Î¤ÎŸÎ¥ Î•Î“ÎšÎ›Î—ÎœÎ‘Î¤ÎŸÎ£</h2>

                    <h2 class="section-title">ğŸ“¦ Î¤Î•ÎšÎœÎ—Î¡Î™Î‘ Î‘Î ÎŸ Î¤Î— Î£ÎšÎ—ÎÎ— Î¤ÎŸÎ¥ Î•Î“ÎšÎ›Î—ÎœÎ‘Î¤ÎŸÎ£</h2>

                    <div class="evidence-grid" id="evidenceGrid">
                    </div>
                </div>

                <div class="tab-pane" id="tab-solution">
                    <div class="intro-box" id="solutionIntroBox">
                        <h2>âœ… Î¥Î ÎŸÎ’ÎŸÎ›Î— Î›Î¥Î£Î—Î£</h2>
                        <p>ÎˆÏ‡ÎµÏ„Îµ Î¼ÎµÎ»ÎµÏ„Î®ÏƒÎµÎ¹ ÏŒÎ»Î± Ï„Î± Ï„ÎµÎºÎ¼Î®ÏÎ¹Î± ÎºÎ±Î¹ ÎµÎ¯ÏƒÏ„Îµ Î­Ï„Î¿Î¹Î¼Î¿Î¹ Î½Î± Ï…Ï€Î¿Î²Î¬Î»ÎµÏ„Îµ Ï„Î· Î»ÏÏƒÎ· ÏƒÎ±Ï‚;</p>
                    </div>

                    <div class="solution-form" id="solutionForm">
                        <h3 style="color: #1a1a2e; margin-bottom: 20px;">Î•Î Î™Î›ÎŸÎ“Î—</h3>
                        
                        <div class="suspect-options">
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_maria" name="suspect" value="maria">
                                <label for="suspect_maria">ğŸ‘© Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï… ÎœÎ±ÏÎ¯Î±</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_konstantinos" name="suspect" value="konstantinos">
                                <label for="suspect_konstantinos">ğŸ‘¨â€ğŸ’¼ Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï… ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_eleni" name="suspect" value="eleni">
                                <label for="suspect_eleni">ğŸ‘©â€ğŸ¦° ÎœÎ±Ï…ÏÎ¯Î´Î· Î•Î»Î­Î½Î·</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_georgios" name="suspect" value="georgios">
                                <label for="suspect_georgios">ğŸ‘® Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_alexandra" name="suspect" value="alexandra">
                                <label for="suspect_alexandra">ğŸ‘©â€ğŸ’» ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï… Î‘Î»ÎµÎ¾Î¬Î½Î´ÏÎ±</label>
                            </div>
                            
                            <div class="suspect-option">
                                <input type="checkbox" id="suspect_suicide" name="suspect" value="suicide">
                                <label for="suspect_suicide">ğŸ’€ Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="justification">Î‘Î™Î¤Î™ÎŸÎ›ÎŸÎ“Î—Î£Î— Î›Î¥Î£Î—Î£: *</label>
                            <textarea 
                                id="justification" 
                                placeholder="Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ· / Î±Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ® ÏƒÎ±Ï‚..."
                                required
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="promptCount">Î‘Î¡Î™Î˜ÎœÎŸÎ£ PROMPTS Î ÎŸÎ¥ Î§Î¡Î—Î£Î™ÎœÎŸÎ ÎŸÎ™Î—Î£Î‘Î¤Î•: *</label>
                            <input 
                                type="number" 
                                id="promptCount" 
                                min="0" 
                                step="1" 
                                placeholder="Ï€.Ï‡. 5"
                                required
                            >
                            <p style="font-size: 12px; color: #666; margin-top: 5px;">
                                ÎÎ± Î³Î¯Î½ÎµÎ¹ Ï…Ï€ÏŒ Ï„Î·Î½ ÎµÏ€Î¯Î²Î»ÎµÏˆÎ· ÎµÎ½ÏŒÏ‚ Game Master.
                            </p>
                        </div>

                        <button type="button" class="submit-btn" onclick="submitSolution()">
                            âœ… Î¥Î ÎŸÎ’ÎŸÎ›Î— Î›Î¥Î£Î—Î£
                        </button>
                    </div>

                    <div id="solutionResult" style="display: none;"></div>
                </div>
<div class="tab-pane" id="tab-survey">
    <div class="intro-box survey-tab-content">
        <div class="survey-icon">ğŸ“Š</div>
        <h2 class="survey-title">Î•Î¡Î•Î¥ÎÎ‘ Î‘ÎÎ™ÎŸÎ›ÎŸÎ“Î—Î£Î—Î£ Î‘Î ÎŸÎ¨Î•Î©Î & Î•ÎœÎ Î•Î™Î¡Î™Î©Î</h2>                     
        <a href="#" 
           onclick="openSurvey(); return false;" 
           class="btn btn-primary" 
           style="margin-top: 20px; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
            ğŸ“Š ÎœÎ•Î¤Î‘Î’Î‘Î£Î— Î£Î¤ÎŸ Î•Î¡Î©Î¤Î—ÎœÎ‘Î¤ÎŸÎ›ÎŸÎ“Î™ÎŸ
        </a>
    </div>
</div>

<div class="tab-pane" id="tab-results">
    <div id="surveysIncomplete" style="display: none; padding-bottom: 80px;">
        <div class="intro-box" style="text-align: center; padding: 60px 30px;">
            <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px;">ğŸ”’</div>
            <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÏƒÏ„Îµ Î ÏÏÏ„Î± Ï„Î¹Ï‚ ÎˆÏÎµÏ…Î½ÎµÏ‚
            </h2>
            <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 12px; padding: 20px; margin: 20px auto; max-width: 500px;">
                <div style="font-size: 24px; margin-bottom: 10px;">ğŸ“</div>
                <div style="color: #856404; font-weight: bold; margin-bottom: 10px;">ÎšÎ‘Î¤Î‘Î£Î¤Î‘Î£Î— Î•Î¡Î•Î¥ÎÎ©Î:</div>
                <div id="surveyStatus" style="color: #666; font-size: 14px; line-height: 1.8;">
                    <div id="preSurveyStatus">â³ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚...</div>
                    <div id="postSurveyStatus">â³ ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚...</div>
                </div>
            </div>
            <a href="#" 
               onclick="window.location.href='survey.html?team=' + encodeURIComponent(sessionStorage.getItem('teamCode')) + '&member=' + encodeURIComponent(sessionStorage.getItem('memberName')); return false;"
               class="btn btn-primary" 
               style="margin-top: 20px; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
                ğŸ“Š ÎœÎ•Î¤Î‘Î’Î‘Î£Î— Î£Î¤ÎŸ Î•Î¡Î©Î¤Î—ÎœÎ‘Î¤ÎŸÎ›ÎŸÎ“Î™ÎŸ
            </a>
        </div>
    </div>

    <div id="leaderboardLocked" style="display: none; padding-bottom: 80px;">
        <div class="intro-box" style="text-align: center; padding: 60px 30px;">
            <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px; animation: swing 3s ease-in-out infinite;">
                ğŸ”’
            </div>
            <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                Î¤Î‘ Î‘Î ÎŸÎ¤Î•Î›Î•Î£ÎœÎ‘Î¤Î‘ Î”Î•Î Î•Î™ÎÎ‘Î™ Î‘ÎšÎŸÎœÎ‘ Î”Î™Î‘Î˜Î•Î£Î™ÎœÎ‘
            </h2>
            <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 12px; padding: 20px; margin: 30px auto; max-width: 500px;">
                <div style="font-size: 24px; margin-bottom: 10px;"></div>
                <div style="color: #155724; font-weight: bold;">
                    Î— Î£Î•Î›Î™Î”Î‘ Î˜Î‘ Î‘ÎÎ‘ÎÎ•Î©Î˜Î•Î™ ÎŸÎ¤Î‘Î ÎŸÎ›Î•Î£ ÎŸÎ™ ÎŸÎœÎ‘Î”Î•Î£ ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î£ÎŸÎ¥Î Î¤Î—Î Î•Î¡Î•Î¥ÎÎ‘ Î¤ÎŸÎ¥Î£!!<br>
                </div>
            </div>
            <p style="margin-top: 30px; color: #999; font-size: 14px;">
                ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÏ‰Î½<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span>
            </p>
        </div>
    </div>
    <div id="leaderboardUnlocked" style="display: none; padding-bottom: 80px;">
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Î£ÏÎ½Î¿Î»Î¿ Î¥Ï€Î¿Î²Î¿Î»ÏÎ½</h3>
                <div class="value" id="totalTeams" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">Î¤Î­Î»ÎµÎ¹ÎµÏ‚ Î›ÏÏƒÎµÎ¹Ï‚</h3>
                <div class="value" id="perfectScores" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ Î’Î±Î¸Î¼ÏÎ½</h3>
                <div class="value" id="avgScore" style="font-size: clamp(24px, 6vw, 32px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
            <div class="stat-card" style="background: white; padding: 20px 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center;">
                <h3 style="color: #666; font-size: clamp(11px, 2.5vw, 14px); margin-bottom: 10px; text-transform: uppercase;">ÎœÎ­ÏƒÎ¿Ï‚ Î§ÏÏŒÎ½Î¿Ï‚</h3>
                <div class="value" id="avgTime" style="font-size: clamp(16px, 4vw, 20px); font-weight: bold; color: #ff6b00;">-</div>
            </div>
        </div>

        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow-x: auto;">
            <h2 style="color: #1a1a2e; font-size: clamp(18px, 4vw, 24px); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #ff6b00;">
                ğŸ† ÎšÎ‘Î¤Î‘Î¤Î‘ÎÎ— ÎŸÎœÎ‘Î”Î©Î
            </h2>
            <table id="resultsTable" style="width: 100%; border-collapse: collapse; min-width: 650px; display: none;">
                <thead>
                    <tr style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); color: white;">
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Î˜Î­ÏƒÎ·</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">ÎŸÎ¼Î¬Î´Î±</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Î¤Î¯Ï„Î»Î¿Ï‚</th>
                        <th style="padding: 12px 10px; text-align: left; font-size: clamp(11px, 2vw, 13px); text-transform: uppercase;">Î§ÏÏŒÎ½Î¿Ï‚</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #666;">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</td>
                    </tr>
                </tbody>
            </table>
            <div id="resultsCards" style="display: none;"></div>
        </div>
    </div>
</div>

</div> 

<div class="footer">
    <p><strong>Î¦Î•Î£Î¤Î™Î’Î‘Î› Î‘Î£Î¤Î¥ÎÎŸÎœÎ™ÎšÎ—Î£ Î›ÎŸÎ“ÎŸÎ¤Î•Î§ÎÎ™Î‘Î£ 2025</strong></p>
    <p style="margin-top: 10px; opacity: 0.7; font-size: 12px;">
        11 Î¤Î•ÎšÎœÎ—Î¡Î™Î‘ | 5 Î¥Î ÎŸÎ Î¤ÎŸÎ™ | 1 Î‘Î›Î—Î˜Î•Î™Î‘
    </p>
</div>

</div>
</div>

<script src="suspects.js"></script>

<script>
    const teks = [
        {
            id: '1',
            name: 'ÎœÏ€Î¿Ï…ÎºÎ¬Î»Î¹ ÎŸÏ…Î¯ÏƒÎºÎ¹',
            subtitle: 'ÎœÏ€Î¿Ï…ÎºÎ¬Î»Î¹ Jack Daniels',
            icon: 'ğŸ¾',
            description: '<strong>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±:</strong> Î“ÏÎ±Ï†ÎµÎ¯Î¿ Î¸ÏÎ¼Î±Ï„Î¿Ï‚<br><strong>Î•Ï…ÏÎ®Î¼Î±Ï„Î±:</strong> ÎšÏ…Î¬Î½Î¹Î¿ ÏƒÏ„Î¿Î½ Ï€Î¬Ï„Î¿ + Î±Ï€Î¿Ï„Ï…Ï€ÏÎ¼Î±Ï„Î± Î¸ÏÎ¼Î±Ï„Î¿Ï‚, Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…, Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï…, Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚',
            page: 'TEK1_AR.html',
            critical: true
        },
            {
                id: '2',
                name: 'ÎšÏÏ…ÏƒÏ„Î¬Î»Î»Î¹Î½Î± Î Î¿Ï„Î®ÏÎ¹Î±',
                subtitle: 'ÎšÏÏ…ÏƒÏ„Î¬Î»Î»Î¹Î½Î± Î Î¿Ï„Î®ÏÎ¹Î±',
                icon: 'ğŸ¥ƒ',
                description: '<strong>Î Î¿Ï„Î®ÏÎ¹ Î‘:</strong> DNA Î¸ÏÎ¼Î±Ï„Î¿Ï‚ + ÎºÏ…Î¬Î½Î¹Î¿ + Î±Ï€Î¿Ï„Ï…Ï€ÏÎ¼Î±Ï„Î± Î¸ÏÎ¼Î±Ï„Î¿Ï‚<br><strong>Î Î¿Ï„Î®ÏÎ¹ Î’:</strong> ÎœÎµÏÎ¹ÎºÏŒ DNA (Ï…Ï€ÏŒ Î±Î½Î¬Î»Ï…ÏƒÎ·) + Î¯Ï‡Î½Î· Î¿Ï…Î¯ÏƒÎºÎ¹ + Î±Ï€Î¿Ï„Ï…Ï€ÏÎ¼Î±Ï„Î± Î¼ÎµÏÎ¹ÎºÏÏ‚ ÏƒÎ²Î·ÏƒÎ¼Î­Î½Î±',
                page: 'TEK2_AR.html',
                critical: true
            },
            {
                id: '3',
                name: 'ÎšÎ¹Î½Î·Ï„ÏŒ Î˜ÏÎ¼Î±Ï„Î¿Ï‚',
                subtitle: 'ÎšÎ¹Î½Î·Ï„ÏŒ Î˜ÏÎ¼Î±Ï„Î¿Ï‚',
                icon: 'ğŸ“±',
                description: '<strong>SMS 20:45:</strong> Â«Î˜Î± Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ Î±Ï€ÏŒÏˆÎµÂ»<br><strong>Î ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·:</strong> Î ÏÎ¿Ï€Î»Î·ÏÏ‰Î¼Î­Î½Î· ÎºÎ¬ÏÏ„Î±, ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼Î­Î½Î· ÏƒÎµ Î±ÎºÏ„Î¯Î½Î± 250m Î±Ï€ÏŒ Ï„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿',
                page: 'TEK3_AR.html',
                critical: false,
                threat: true
            },
            {
                id: '4',
                name: 'Email Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚',
                subtitle: 'Email Â«Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚Â»',
                icon: 'ğŸ’»',
                description: '<strong>IP:</strong> 192.168.1.23 - 7Î¿Ï‚ ÏŒÏÎ¿Ï†Î¿Ï‚<br><strong>Î ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·:</strong> ÎšÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®Ï‚ Î±Î¯Î¸Î¿Ï…ÏƒÎ±Ï‚ ÏƒÏ…ÏƒÎºÎ­ÏˆÎµÏ‰Î½ (Î´ÎµÎ½ Î±Ï€Î±Î¹Ï„ÎµÎ¯ ÎºÏ‰Î´Î¹ÎºÏŒ)',
                page: 'TEK4_AR.html',
                critical: false,
                forgery: true
            },
            {
                id: '5',
                name: 'Î™Î±Ï„ÏÎ¹ÎºÎ® Î“Î½Ï‰Î¼Î¬Ï„ÎµÏ…ÏƒÎ·',
                subtitle: 'Î™Î±Ï„ÏÎ¹ÎºÎ® Î“Î½Ï‰Î¼Î¬Ï„ÎµÏ…ÏƒÎ· (ÎºÏÏ…Ï†Î®)',
                icon: 'ğŸ¥¼',
                description: '<strong>Î”Î¹Î¬Î³Î½Ï‰ÏƒÎ·:</strong> ÎšÎ±ÏÎºÎ¯Î½Î¿Ï‚ Ï€Î±Î³ÎºÏÎ­Î±Ï„Î¿Ï‚ ÏƒÏ„Î±Î´Î¯Î¿Ï… IV<br><strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±:</strong> Î ÏÎ¹Î½ 3 ÎµÎ²Î´Î¿Î¼Î¬Î´ÎµÏ‚<br><strong>Î ÏÏŒÎ³Î½Ï‰ÏƒÎ·:</strong> 2-3 Î¼Î®Î½ÎµÏ‚ Î¶Ï‰Î®Ï‚ â€¢ Î”Î¹Î±Ï„ÏÏŒÏ‚: Î”Ï. Î£Ï„Î±Ï…ÏÎ¯Î´Î·Ï‚',
                page: 'TEK5_AR.html',
                critical: false,
                secret: true
            },
            {
                id: '6',
                name: 'Î“Î¬Î½Ï„Î¹Î± Î›Î¬Ï„ÎµÎ¾',
                subtitle: 'ÎŠÏ‡Î½Î· Î“Î±Î½Ï„Î¹ÏÎ½ Î›Î¬Ï„ÎµÎ¾',
                icon: 'ğŸ§¤',
                description: '<strong>Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±:</strong> Î ÏŒÎ¼Î¿Î»Î¿ Ï€ÏŒÏÏ„Î±Ï‚<br><strong>Î¤ÏÏ€Î¿Ï‚:</strong> Î“Î¬Î½Ï„Î¹Î± Î¹Î±Ï„ÏÎ¹ÎºÎ¿Ï Ï„ÏÏ€Î¿Ï…, Î¼Î­Î³ÎµÎ¸Î¿Ï‚ M<br><strong>Î ÏÎ¿Î­Î»ÎµÏ…ÏƒÎ·:</strong> ÎšÎ¿Ï…Ï„Î¯ Ï€ÏÏÏ„Ï‰Î½ Î²Î¿Î·Î¸ÎµÎ¹ÏÎ½ (Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·: ÏŒÎ»Î¿ Ï„Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ)',
                page: 'TEK6_AR.html',
                critical: false,
                clue: true
            },
            {
                id: '7',
                name: 'Î§ÎµÎ¹ÏÏŒÎ³ÏÎ±Ï†Î¿ Î£Î·Î¼ÎµÎ¯Ï‰Î¼Î±',
                subtitle: 'Î§ÎµÎ¹ÏÏŒÎ³ÏÎ±Ï†Î¿ Î£Î·Î¼ÎµÎ¯Ï‰Î¼Î±',
                icon: 'âœï¸',
                description: '<strong>ÎšÎµÎ¯Î¼ÎµÎ½Î¿:</strong> Â«Î£Ï…Î³Ï‡ÏÏÎµÏƒÎ­ Î¼Îµ Îœ.Â»<br><strong>Î‘Î½Î¬Î»Ï…ÏƒÎ·:</strong> ÎœÎ¯Î¼Î·ÏƒÎ· Î³ÏÎ±Ï†Î¹ÎºÎ¿Ï Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ± (65% Ï„Î±ÏÏ„Î¹ÏƒÎ·, Ï€Î¯ÎµÏƒÎ· Î±ÏƒÏ…Î½ÎµÏ€Î®Ï‚)',
                page: 'TEK7_AR.html',
                critical: false,
                forgery: true
            },
            {
                id: '8',
                name: 'Î¦Î¬ÎºÎµÎ»Î¿Ï‚ Î•Î¼Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î¹ÎºÏŒ',
                subtitle: 'Î¦Î¬ÎºÎµÎ»Î¿Ï‚ Â«Î•ÎœÎ Î™Î£Î¤Î•Î¥Î¤Î™ÎšÎŸÂ»',
                icon: 'ğŸ“‚',
                description: '<strong>Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î±:</strong><br>â€¢ Î¥Ï€ÎµÎ¾Î±Î¯ÏÎµÏƒÎ· â‚¬1,5ÎµÎº (Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï…)<br>â€¢ Î•ÏÏ‰Ï„Î¹ÎºÎ­Ï‚ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯ÎµÏ‚ (ÎœÎ±Ï…ÏÎ¯Î´Î·)<br>â€¢ ÎšÎ»Î¿Ï€Î® Ï‡ÎµÎ¹ÏÎ¿Î³ÏÎ¬Ï†Ï‰Î½ (ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï…)',
                page: 'TEK8_AR.html',
                critical: false,
                blackmail: true
            },
            {
                id: '9',
                name: 'Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î§Î·Î¼Î¹ÎºÏÎ½',
                subtitle: 'Î‘Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î‘Î³Î¿ÏÎ¬Ï‚ Î§Î·Î¼Î¹ÎºÏÎ½',
                icon: 'ğŸ§ª',
                description: '<strong>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±:</strong> 19/09, 14:30<br><strong>Î‘Î³Î¿ÏÎ¬:</strong> ÎšÏ…Î±Î½Î¹Î¿ÏÏ‡Î¿ ÎºÎ¬Î»Î¹Î¿ Î±Ï€ÏŒ Â«Î§Î·Î¼Î¹ÎºÎ¬PlusÂ»<br><strong>Î†Î´ÎµÎ¹Î±:</strong> Î‘Ï€ÎµÎ½Ï„ÏŒÎ¼Ï‰ÏƒÎ· ÎµÏ„Î±Î¹ÏÎµÎ¯Î±Ï‚ â€¢ Î¥Ï€Î¿Î³ÏÎ±Ï†Î®: Î“. Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚ (Ï…Ï€ÏŒ Î³ÏÎ±Ï†Î¿Î»Î¿Î³Î¹ÎºÎ® ÎµÎ¾Î­Ï„Î±ÏƒÎ·)',
                page: 'TEK9_AR.html',
                critical: true
            },
            {
                id: '10',
                name: 'ÎšÎ»ÎµÎ¹Î´Î¯ Î§ÏÎ·Î¼Î±Ï„Î¿ÎºÎ¹Î²Ï‰Ï„Î¯Î¿Ï…',
                subtitle: 'ÎšÎ»ÎµÎ¹Î´Î¯ Î§ÏÎ·Î¼Î±Ï„Î¿ÎºÎ¹Î²Ï‰Ï„Î¯Î¿Ï…',
                icon: 'ğŸ”‘',
                description: '<strong>Î‘Ï€Î¿Ï„Ï…Ï€ÏÎ¼Î±Ï„Î±:</strong> Î”Î·Î¼Î·Ï„ÏÎ¯Î¿Ï…, Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï…<br><strong>ÎŠÏ‡Î½Î·:</strong> Î£ÎºÏŒÎ½Î· Ï„Î±Î»Îº (Î±Ï€ÏŒ latex Î³Î¬Î½Ï„Î¹Î±)',
                page: 'TEK10_AR.html',
                critical: false,
                financial: true
            },
            {
                id: '11',
                name: 'ÎšÎ¬Î¼ÎµÏÎµÏ‚ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚',
                subtitle: 'ÎšÎ¬Î¼ÎµÏÎµÏ‚ Î‘ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚',
                icon: 'ğŸ“¹',
                description: '<strong>Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·:</strong> 20:55<br><strong>Î¤ÎµÏ„ÏÎ¬Î´Î¹Î¿ Î£Ï…Î¼Î²Î¬Î½Ï„Ï‰Î½:</strong> Â«20:58 - Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î²Î»Î¬Î²Î· CCTVÂ»<br><strong>Î¥Ï€Î¿Î³ÏÎ±Ï†Î®:</strong> Î Î•Î¤Î¡ÎŸÎ ÎŸÎ¥Î›ÎŸÎ£ Î“. (Î³Î½Î·ÏƒÎ¹ÏŒÏ„Î·Ï„Î± Ï…Ï€ÏŒ ÎµÎ¾Î­Ï„Î±ÏƒÎ·)',
                page: 'TEK11_AR.html',
                critical: false,
                sabotage: true
            }
        ];

        const CORRECT_SUSPECTS = ['konstantinos', 'georgios', 'eleni'];
        const SUSPECT_NAMES = {
            'maria': 'Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï… ÎœÎ±ÏÎ¯Î±',
            'konstantinos': 'Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï… ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚',
            'eleni': 'ÎœÎ±Ï…ÏÎ¯Î´Î· Î•Î»Î­Î½Î·',
            'georgios': 'Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚',
            'alexandra': 'ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï… Î‘Î»ÎµÎ¾Î¬Î½Î´ÏÎ±',
            'suicide': 'Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±'
        };

const SCORING = {
            murder_diagnosis: 25,
            cooperation: 20,
            perpetrator: 15,
            perfect_solution_bonus: 20,
            evidence_use: 5,
            prompts_1_5: 15,
            prompts_6_10: 10,
            prompts_11_15: 5,
            time_under_30: 15,
            time_30_45: 10,
            time_45_60: 5
        };
		
        const urlParams = new URLSearchParams(window.location.search);
        const teamCode = sessionStorage.getItem('teamName') || urlParams.get('team') || 'default';

        if (teamCode !== 'default') {
            const teamInfoDiv = document.getElementById('teamInfo');
            const teamNameSpan = document.getElementById('teamName');
            if (teamInfoDiv && teamNameSpan) {
                teamInfoDiv.style.display = 'block';
                teamNameSpan.textContent = `ÎŸÎœÎ‘Î”Î‘: ${teamCode.toUpperCase()}`;
            }
        }

        let timerInterval = null;

        function getStorageKey() {
            return `unlocked_teks_${teamCode}`;
        }

function openSurvey() {
    const teamCode = sessionStorage.getItem('teamCode');
    const memberName = sessionStorage.getItem('memberName');
    
    if (!teamCode || !memberName) {
        alert('âŒ Î£Ï†Î¬Î»Î¼Î±: Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î¾Î±Î½Î¬.');
        window.location.href = 'team_entry.html';
        return;
    }

    const surveyUrl = `survey.html?team=${encodeURIComponent(teamCode)}&member=${encodeURIComponent(memberName)}`;
    window.open(surveyUrl, '_blank');
}

function getUnlockedTeks() {
    const stored = localStorage.getItem(getStorageKey());
    if (!stored) return [];
    
    try {
        const data = JSON.parse(stored);
        if (data && typeof data === 'object' && !Array.isArray(data) && data.unlocked) {
            return Array.isArray(data.unlocked) ? data.unlocked : [];
        }
		
        if (Array.isArray(data)) {
            return data;
        }
        
        return [];
    } catch (e) {
        console.error('Error loading unlocked TEKs:', e);
        return [];
    }
}

function formatElapsedTime(ms) {
    const seconds = Math.floor(ms / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    
    const h = hours;
    const m = minutes % 60;
    const s = seconds % 60;
    
    if (h > 0) {
        return `${h}Ï‰ ${m}Î» ${s}Î´`;
    } else if (m > 0) {
        return `${m}Î» ${s}Î´`;
    } else {
        return `${s}Î´`;
    }
}

function startLiveTimer(startTime) {
    if (timerInterval) clearInterval(timerInterval);
    
    const timerElement = document.getElementById('liveTimer');
    if (!timerElement) return;
    
    timerInterval = setInterval(() => {
        const now = new Date();
        const start = new Date(startTime);
        const elapsed = now - start;
        timerElement.textContent = formatElapsedTime(elapsed);
    }, 1000);
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

async function getTeamData() {
    if (window.firebaseDB) {
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            const docSnap = await window.firebaseGetDoc(docRef);
            
            if (docSnap.exists()) {
                return docSnap.data();
            }
        } catch (error) {
            console.error('Firebase load error:', error);
        }
    }

    const localData = localStorage.getItem(getStorageKey());
    if (localData) {
        try {
            const parsed = JSON.parse(localData);
            if (parsed && typeof parsed === 'object' && !Array.isArray(parsed)) {
                return {
                    password: parsed.password || null,
                    unlocked: parsed.unlocked || [],
                    timestamps: parsed.timestamps || {},
                    startTime: parsed.startTime || null,
                    completedAt: parsed.completedAt || null,
                    totalTimeMs: parsed.totalTimeMs || null,
                    solution: parsed.solution || null,
                    evidenceTimestamps: parsed.evidenceTimestamps || {}
                };
            }
			
            if (Array.isArray(parsed)) {
                return {
                    password: null,
                    unlocked: parsed,
                    timestamps: {},
                    startTime: null,
                    completedAt: null,
                    totalTimeMs: null,
                    solution: null,
                    evidenceTimestamps: {}
                };
            }
        } catch (e) {
            console.error('Error parsing localStorage data:', e);
        }
    }

    return {
        password: null,
        unlocked: [],
        timestamps: {},
        startTime: null,
        completedAt: null,
        totalTimeMs: null,
        solution: null,
        evidenceTimestamps: {}
    };
}

async function updateProgress(teamData) {
    const unlockedTeks = teamData.unlocked || [];
    const total = teks.length;
    const unlocked = unlockedTeks.length;
    const percentage = Math.round((unlocked / total) * 100);
    document.getElementById('progressFill').style.width = percentage + '%';
    document.getElementById('progressFill').textContent = percentage + '%';
    document.getElementById('progressText').textContent = 
        `ÎˆÏ‡ÎµÏ„Îµ Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÎµÎ¹ ${unlocked} Î±Ï€ÏŒ ${total} Ï„ÎµÎºÎ¼Î®ÏÎ¹Î±`;
    
    const timerSection = document.getElementById('timerSection');
    if (teamData.startTime && unlocked > 0) {
        timerSection.style.display = 'block';
        document.getElementById('startTime').textContent = 
            new Date(teamData.startTime).toLocaleString('el-GR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        if (teamData.completedAt || teamData.solution) {
            document.getElementById('liveTimerLabel').textContent = 'Î£Ï…Î½Î¿Î»Î¹ÎºÏŒÏ‚ Î§ÏÏŒÎ½Î¿Ï‚:';
            document.getElementById('liveTimer').textContent = formatElapsedTime(teamData.totalTimeMs || 0);
            stopTimer();
        } else {

            document.getElementById('liveTimerLabel').textContent = 'Î§ÏÏŒÎ½Î¿Ï‚ ÏƒÎµ Î•Î¾Î­Î»Î¹Î¾Î·:';

            if (!timerInterval) {
                startLiveTimer(teamData.startTime);
            }
        }
    } else {
        timerSection.style.display = 'none';
        stopTimer();
    }
}

function calculateScore(selectedSuspects, totalTimeMs, promptCount) {
    let score = 0;
    let breakdown = [];
    
    if (selectedSuspects.length === 0) {
        return {
            score: 0,
            breakdown: ['âŒ Î”ÎµÎ½ ÎµÏ€Î¹Î»Î­Î¾Î±Ï„Îµ ÎºÎ±Î½Î­Î½Î±Î½ ÏÏ€Î¿Ï€Ï„Î¿ Î® Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±'],
            maxScore: 140,
            correctCount: 0
        };
    }
	
    const hasSuicide = selectedSuspects.includes('suicide');
    const hasKiller = selectedSuspects.some(s => s !== 'suicide');
    
    if (hasSuicide && hasKiller) {
        const killerNames = selectedSuspects
            .filter(s => s !== 'suicide')
            .map(s => SUSPECT_NAMES[s])
            .join(', ');
        
        return {
            score: 0,
            breakdown: [
                'âŒ Î›ÎŸÎ“Î™ÎšÎ— Î‘ÎÎ¤Î™Î¦Î‘Î£Î— - Î’Î‘Î˜ÎœÎŸÎ£: 0/140',
                '',
                'âš ï¸ Î•Ï€Î¹Î»Î­Î¾Î±Ï„Îµ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±:',
                `   â€¢ Î”Î¿Î»Î¿Ï†Î¿Î½Î¯Î± Î±Ï€ÏŒ: ${killerNames}`,
                '   â€¢ Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±',
                '',
                'ÎŸÎ¹ Î´Ï…Î¿ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î±Î»Î»Î·Î»Î¿Î±Ï€Î¿ÎºÎ»ÎµÎ¯Î¿Î½Ï„Î±Î¹!',
                'Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Î¿Î»Î¿Ï†Î¿Î½Î¯Î± ÎšÎ‘Î™ Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±.',
                '',
            ],
            maxScore: 140,
            correctCount: 0
        };
    }

    if (hasSuicide && !hasKiller) {
        return {
            score: 0,
            breakdown: [
                'âœ— Î›Î‘Î˜ÎŸÎ£ Î”Î™Î‘Î“ÎÎ©Î£Î—: Î‘Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î± - Î’Î‘Î˜ÎœÎŸÎ£: 0/140',
                '',
                'âŒ Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ® ÏƒÎ±Ï‚ (Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±) ÎµÎ¯Î½Î±Î¹ Î»Î±Î½Î¸Î±ÏƒÎ¼Î­Î½Î·!',
                '',
            ],
            maxScore: 140,
            correctCount: 0
        };
    }

    let correctCount = 0;
    let wrongSuspects = [];
    
    selectedSuspects.forEach(suspect => {
        if (CORRECT_SUSPECTS.includes(suspect)) {
            correctCount++;
        } else {
            wrongSuspects.push(SUSPECT_NAMES[suspect] || suspect);
        }
    });
        
    breakdown.push('âœ” Î˜Î•Î¤Î™ÎšÎ‘ Î£Î¤ÎŸÎ™Î§Î•Î™Î‘:');    
    
    score += SCORING.murder_diagnosis;
    breakdown.push(`âœ” Î”Î¹Î¬Î³Î½Ï‰ÏƒÎ· Î”Î¿Î»Î¿Ï†Î¿Î½Î¯Î±Ï‚: +${SCORING.murder_diagnosis}`);
    
    if (correctCount > 0) {
        const points = correctCount * SCORING.perpetrator;
        score += points;
        breakdown.push(`âœ” Î£Ï‰ÏƒÏ„Î¿Î¯ Î”ÏÎ¬ÏƒÏ„ÎµÏ‚ (${correctCount}/3): +${points}`);
    } else {
        breakdown.push(`âœ— Î£Ï‰ÏƒÏ„Î¿Î¯ Î”ÏÎ¬ÏƒÏ„ÎµÏ‚ (0/3): +0`);
    }
    
    if (correctCount >= 2) {
        score += SCORING.cooperation;
        breakdown.push(`âœ” Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î£Ï…Î½ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚: +${SCORING.cooperation}`);
    } else {
        breakdown.push(`âœ— Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚ Î£Ï…Î½ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚: +0 (Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ 2+ ÏƒÏ‰ÏƒÏ„Î¿Î¯)`);
    }
    
    const isPerfect = (correctCount === 3 && selectedSuspects.length === 3);
    
    if (isPerfect) {
        score += SCORING.perfect_solution_bonus;
        breakdown.push(`âœ” Î¤Î­Î»ÎµÎ¹Î± Î›ÏÏƒÎ· (Î¼ÏŒÎ½Î¿ Î¿Î¹ 3 ÏƒÏ‰ÏƒÏ„Î¿Î¯): +${SCORING.perfect_solution_bonus}`);
    } else if (correctCount >= 2) {
        score += SCORING.evidence_use;
        breakdown.push(`âœ” Î§ÏÎ®ÏƒÎ· Î¤ÎµÎºÎ¼Î·ÏÎ¯Ï‰Î½: +${SCORING.evidence_use}`);
    }
    
    if (wrongSuspects.length === 0 && correctCount > 0 && correctCount < 3) {
        const precisionBonus = correctCount * 15;
        score += precisionBonus;
        breakdown.push(`âœ” Bonus Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚ (0 Î»Î¬Î¸Î·, ${correctCount} ÏƒÏ‰ÏƒÏ„Î¿Î¯): +${precisionBonus}`);
    }
    
    if (totalTimeMs && correctCount >= 2) {
        const minutes = totalTimeMs / 60000;
        if (minutes < 30) {
            score += SCORING.time_under_30;
            breakdown.push(`â±ï¸ Bonus Î§ÏÏŒÎ½Î¿Ï… (<30Î»): +${SCORING.time_under_30}`);
        } else if (minutes < 45) {
            score += SCORING.time_30_45;
            breakdown.push(`â±ï¸ Bonus Î§ÏÏŒÎ½Î¿Ï… (30-45Î»): +${SCORING.time_30_45}`);
        } else if (minutes < 60) {
            score += SCORING.time_45_60;
            breakdown.push(`â±ï¸ Bonus Î§ÏÏŒÎ½Î¿Ï… (45-60Î»): +${SCORING.time_45_60}`);
        }
    }
    
    if (promptCount && correctCount >= 2) {
        if (promptCount <= 5) {
            score += SCORING.prompts_1_5;
            breakdown.push(`ğŸ¯ Bonus Î‘Ï€Î¿Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ (1-5 prompts): +${SCORING.prompts_1_5}`);
        } else if (promptCount <= 10) {
            score += SCORING.prompts_6_10;
            breakdown.push(`ğŸ¯ Bonus Î‘Ï€Î¿Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ (6-10 prompts): +${SCORING.prompts_6_10}`);
        } else if (promptCount <= 15) {
            score += SCORING.prompts_11_15;
            breakdown.push(`ğŸ¯ Bonus Î‘Ï€Î¿Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ (11-15 prompts): +${SCORING.prompts_11_15}`);
        }
    }
    
    if (wrongSuspects.length > 0 || correctCount < 3) {
        breakdown.push('');
        breakdown.push('âœ— Î‘Î¡ÎÎ—Î¤Î™ÎšÎ‘ Î£Î¤ÎŸÎ™Î§Î•Î™Î‘:');
    }
	
    if (wrongSuspects.length > 0) {
        let multiplier = 1.0;
        if (wrongSuspects.length === 1) {
            multiplier = 0.5;
        } else if (wrongSuspects.length === 2) {
            multiplier = 0.2;
        } else {
            multiplier = 0.05;
        }
        
        breakdown.push(`âœ— Î›Î¬Î¸Î¿Ï‚ ÎÏ€Î¿Ï€Ï„Î¿Î¹ (${wrongSuspects.length}):`);
        wrongSuspects.forEach(name => {
            breakdown.push(`   â†’ ${name}`);
        });
        
        const originalScore = score;
        score = Math.floor(score * multiplier);
        const penalty = originalScore - score;
        
        breakdown.push(`âš ï¸ Î Î¿Î»Î»Î±Ï€Î»Î±ÏƒÎ¹Î±ÏƒÏ„Î®Ï‚ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚: Ã—${multiplier} (${Math.round(multiplier*100)}%)`);
        breakdown.push(`ğŸ’¡ Î’Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î± Ï€ÏÎ¹Î½: ${originalScore} â†’ ÎœÎµÏ„Î¬: ${score} (Î‘Ï€ÏÎ»ÎµÎ¹Î±: -${penalty})`);
    }
    
    if (correctCount < 3) {
        const missed = 3 - correctCount;
        const missedNames = CORRECT_SUSPECTS
            .filter(s => !selectedSuspects.includes(s))
            .map(s => SUSPECT_NAMES[s])
            .join(', ');
        
        breakdown.push(`âš ï¸ Î§Î¬ÏƒÎ±Ï„Îµ ${missed} ÏƒÏ‰ÏƒÏ„ÏŒ${missed > 1 ? 'ÏÏ‚ Î´ÏÎ¬ÏƒÏ„ÎµÏ‚' : ' Î´ÏÎ¬ÏƒÏ„Î·'}: ${missedNames}`);
    }
    
    score = Math.max(0, Math.min(score, 140));
    
    return { score, breakdown, maxScore: 140, correctCount };
}

async function submitSolution() {
    const checkboxes = document.querySelectorAll('input[name="suspect"]:checked');
    const selectedSuspects = Array.from(checkboxes).map(cb => cb.value);
    const justification = document.getElementById('justification').value.trim();
    const promptCount = parseInt(document.getElementById('promptCount').value) || 0;

    if (selectedSuspects.length === 0) {
        alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î±Î½ ÏÏ€Î¿Ï€Ï„Î¿ Î® Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±!');
        return;
    }

    if (!justification || justification.length < 50) {
        alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ® Î±Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ· (Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 50 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚)!');
        return;
    }

if (promptCount === null || promptCount === undefined || promptCount < 0) {
    alert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î­Î³ÎºÏ…ÏÎ¿ Î±ÏÎ¹Î¸Î¼ÏŒ prompts!');
    return;
}
    
    const teamData = await getTeamData();
    if (teamData.unlocked.length < 6) {
        alert(`Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¾ÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÎµÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 6 Ï„ÎµÎºÎ¼Î®ÏÎ¹Î± Ï€ÏÎ¹Î½ Ï…Ï€Î¿Î²Î¬Î»ÎµÏ„Îµ Î»ÏÏƒÎ·! (ÎˆÏ‡ÎµÏ„Îµ: ${teamData.unlocked.length}/11)`);
        return;
    }

    if (teamData.solution) {
        alert('ÎˆÏ‡ÎµÏ„Îµ Î®Î´Î· Ï…Ï€Î¿Î²Î¬Î»ÎµÎ¹ Î»ÏÏƒÎ·! Î”ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï…Ï€Î¿Î²Î¬Î»ÎµÏ„Îµ Î¾Î±Î½Î¬.');
        return;
    }            
    
    let totalTimeMs = null;
    if (teamData.startTime) {
        const start = new Date(teamData.startTime);
        const now = new Date();
        totalTimeMs = now - start;
    }

    const scoreResult = calculateScore(selectedSuspects, totalTimeMs, promptCount);

    const solution = {
        suspects: selectedSuspects,
        justification: justification,
        justificationLength: justification.length,
        promptCount: promptCount,
        submittedAt: new Date().toISOString(),
        completionTimeMs: totalTimeMs,
        score: scoreResult.score,
        maxScore: scoreResult.maxScore,
        breakdown: scoreResult.breakdown,
        correctCount: scoreResult.correctCount,
researchData: {
    evidenceUnlockSequence: Object.keys(teamData.evidenceTimestamps || {}).sort((a, b) => {
        return new Date(teamData.evidenceTimestamps[a]) - new Date(teamData.evidenceTimestamps[b]);
    }),
    totalEvidenceUnlocked: (teamData.unlocked || []).length,
    firstEvidenceTime: teamData.startTime || null,
    lastEvidenceTime: (teamData.evidenceTimestamps && Object.keys(teamData.evidenceTimestamps).length > 0) ? 
        Object.values(teamData.evidenceTimestamps).sort().pop() : null,
    timeSpentMinutes: totalTimeMs ? Math.round(totalTimeMs / 60000) : null,
    strategy: selectedSuspects.includes('suicide') ? 'suicide' : 
             (selectedSuspects.length === 5 ? 'shotgun' : 
             (selectedSuspects.length === 3 ? 'selective' : 'selective'))
}
    };
    
try {
    const updatedData = {
        ...teamData,
        solution: solution,
        completedAt: solution.submittedAt,
        totalTimeMs: totalTimeMs,
        lastUpdate: new Date().toISOString()
    };
        
        localStorage.setItem(getStorageKey(), JSON.stringify(updatedData));
        
        if (window.firebaseDB) {
            await window.firebaseSetDoc(
                window.firebaseDoc(window.firebaseDB, 'teams', teamCode),
                updatedData
            );
        }
        
        localStorage.setItem(`solution_${teamCode}`, JSON.stringify(solution));
        displaySubmissionConfirmation();
        
    } catch (error) {
        console.error('Error saving solution:', error);
        alert('Î£Ï†Î¬Î»Î¼Î± Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚! Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}







function displaySubmissionConfirmation() {
    const resultDiv = document.getElementById('solutionResult');
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    if (solutionIntroBox) {
        solutionIntroBox.style.display = 'none';
    }
    
    resultDiv.innerHTML = `
        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px 30px; border-radius: 12px; margin: 20px 0; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 15px rgba(40,167,69,0.3); flex-wrap: wrap; gap: 15px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 40px;">âœ…</div>
                <div>
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 5px;">Î›Î¥Î£Î— Î¥Î ÎŸÎ’Î›Î—Î˜Î—ÎšÎ• Î•Î Î™Î¤Î¥Î§Î©Î£!</div>
                    <div style="font-size: 14px; opacity: 0.9;">ğŸ“… ${new Date().toLocaleString('el-GR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</div>
                </div>
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 3px solid #ff6b00; padding: 0; border-radius: 15px; margin-top: 20px; box-shadow: 0 10px 40px rgba(255, 107, 0, 0.4); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); padding: 25px; text-align: center; position: relative;">
                <div style="font-size: 56px; margin-bottom: 10px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));">ğŸ”</div>
                <h3 style="color: #000; font-size: 24px; font-weight: bold; margin: 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 1px 1px 2px rgba(255,255,255,0.3);">
                    Î— Î‘Î›Î—Î˜Î•Î™Î‘ Î˜Î‘ Î‘Î ÎŸÎšÎ‘Î›Î¥Î¦Î˜Î•Î™ Î£Î¥ÎÎ¤ÎŸÎœÎ‘...
                </h3>
                <div style="position: absolute; top: 0; left: 0; right: 0; height: 100%; background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.05) 10px, rgba(0,0,0,0.05) 20px); pointer-events: none;"></div>
            </div>
            <div style="padding: 30px;">
                <div style="background: linear-gradient(135deg, rgba(255, 107, 0, 0.2) 0%, rgba(255, 136, 0, 0.2) 100%); border: 2px solid #ff6b00; border-radius: 12px; padding: 20px; margin-bottom: 30px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -20px; right: -20px; font-size: 100px; opacity: 0.1;">âš ï¸</div>
                    <div style="position: relative; z-index: 1;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 28px;">ğŸ’¡</span>
                            <span style="color: #ff6b00; font-size: 16px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">Î Î¡ÎŸÎ£ÎŸÎ§Î—!</span>
							</div>
							<p style="color: #fff; font-size: 14px; margin: 0; text-align: center; line-height: 1.7; font-weight: 600;">
								ÎšÎ¡Î‘Î¤Î—Î£Î¤Î• Î¤Î— Î›Î¥Î£Î— Î£Î‘Î£ ÎœÎ¥Î£Î¤Î™ÎšÎ—!<br>
								ÎœÎ—Î ÎœÎŸÎ™Î¡Î‘Î£Î¤Î•Î™Î¤Î• Î Î›Î—Î¡ÎŸÎ¦ÎŸÎ¡Î™Î•Î£ ÎœÎ• Î‘Î›Î›Î•Î£ ÎŸÎœÎ‘Î”Î•Î£ ÎœÎ•Î§Î¡Î™ Î¤Î—Î Î•Î Î™Î£Î—ÎœÎ— Î›Î—ÎÎ— Î¤ÎŸÎ¥ Î”Î™Î‘Î“Î©ÎÎ™Î£ÎœÎŸÎ¥!<br>
							</p>
							</div>
						</div>

                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 25px; backdrop-filter: blur(5px);">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="display: inline-flex; align-items: center; gap: 10px; background: rgba(255, 107, 0, 0.2); padding: 10px 20px; border-radius: 25px; border: 1px solid rgba(255, 107, 0, 0.4);">
                            <span style="font-size: 20px;">ğŸ”‘</span>
                            <span style="color: #ff6b00; font-weight: bold; font-size: 15px; text-transform: uppercase; letter-spacing: 1px;">ÎˆÏ‡ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚;</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: stretch; max-width: 500px; margin: 0 auto;">
                        <input type="password" id="solutionPassword" placeholder="Î•Î¹ÏƒÎ¬Î³ÎµÏ„Îµ ÎºÏ‰Î´Î¹ÎºÏŒ..." 
                               style="flex: 1; min-width: 200px; padding: 15px 20px; border: 2px solid rgba(255, 107, 0, 0.5); background: rgba(255, 255, 255, 0.9); border-radius: 10px; font-size: 16px; font-weight: 500; transition: all 0.3s ease; outline: none; color: #1a1a2e;"
                               onfocus="this.style.borderColor='#ff6b00'; this.style.background='#fff'; this.style.boxShadow='0 0 20px rgba(255, 107, 0, 0.3)'"
                               onblur="this.style.borderColor='rgba(255, 107, 0, 0.5)'; this.style.background='rgba(255, 255, 255, 0.9)'; this.style.boxShadow='none'">
                        <button onclick="revealSolution()" 
                                style="padding: 15px 35px; background: linear-gradient(135deg, #ff6b00 0%, #ff8800 100%); color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(255, 107, 0, 0.4); transition: all 0.3s ease; white-space: nowrap; text-transform: uppercase; letter-spacing: 1px;"
                                onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; this.style.boxShadow='0 6px 25px rgba(255, 107, 0, 0.6)'"
                                onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 0, 0.4)'">
                            ğŸ”“ Î‘Î ÎŸÎšÎ‘Î›Î¥Î¨Î—
                        </button>
                    </div>
                    
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 12px; text-align: center; margin: 15px 0 0 0; font-style: italic;">
                        ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î¸Î± Î±Î½Î±ÎºÎ¿Î¹Î½Ï‰Î¸ÎµÎ¯ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î­Ï‚
                    </p>
                </div>
            </div>
        </div>
    `;
    
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    
    const solutionForm = document.getElementById('solutionForm');
    if (solutionForm) {
        solutionForm.style.display = 'none';
    }
    
    stopTimer();
}

























function displaySolutionResult(solution) {
    const resultDiv = document.getElementById('solutionResult');
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    if (solutionIntroBox) {
        solutionIntroBox.style.display = 'none';
    }
    const percentage = Math.round((solution.score / solution.maxScore) * 100);
    let grade = '';
    let gradeColor = '';
    if (percentage >= 90) {
        grade = 'Î‘Î¡Î§Î™-ÎÎ¤Î•Î¤Î•ÎšÎ¤Î™Î’Î£ ğŸ•µï¸';
        gradeColor = '#00d4ff';
    } else if (percentage >= 80) {
        grade = 'Î‘ÎÎ©Î¤Î•Î¡ÎŸÎ™ Î‘ÎÎ‘ÎšÎ¡Î™Î¤Î•Î£ ğŸ–ï¸';
        gradeColor = '#ffd700';
    } else if (percentage >= 70) {
        grade = 'ÎÎ¤Î•Î¤Î•ÎšÎ¤Î™Î’Î£ ğŸ”';
        gradeColor = '#c0c0c0';
    } else if (percentage >= 60) {
        grade = 'Î‘Î£Î¤Î¥ÎÎŸÎœÎŸÎ™ ğŸ‘®';
        gradeColor = '#cd7f32';
    } else if (percentage >= 50) {
        grade = 'Î•Î¡Î•Î¥ÎÎ—Î¤Î•Î£ ğŸ“';
        gradeColor = '#ffcc00';
    } else if (percentage >= 40) {
        grade = 'Î‘Î£ÎšÎŸÎ¥ÎœÎ•ÎÎŸÎ™ ğŸ“';
        gradeColor = '#28a745';
    } else {
        grade = 'ÎÎ•ÎŸÎ£Î¥Î›Î›Î•ÎšÎ¤ÎŸÎ™ ğŸ¯';
        gradeColor = '#6c757d';
    }

    const isPerfect = solution.correctCount === 3 && solution.suspects.length === 3;
    const hasSuicide = solution.suspects.includes('suicide');
    const hasKiller = solution.suspects.some(s => s !== 'suicide');
    const isContradiction = hasSuicide && hasKiller;
    let headerGradient = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
    let headerShadow = 'rgba(40,167,69,0.3)';
    
    if (isContradiction || solution.score === 0) {
        headerGradient = 'linear-gradient(135deg, #dc3545 0%, #c82333 100%)';
        headerShadow = 'rgba(220,53,69,0.3)';
    } else if (percentage < 50) {
        headerGradient = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
        headerShadow = 'rgba(255,193,7,0.3)';
    }

    let breakdownHTML = '';
    solution.breakdown.forEach(item => {
        let bgColor = '#f8f9fa';
        let borderColor = '#dee2e6';
        let textColor = '#333';
        let fontWeight = 'normal';
        
        if (item.includes('Î›ÎŸÎ“Î™ÎšÎ— Î‘ÎÎ¤Î™Î¦Î‘Î£Î—') || item.includes('Î›Î‘Î˜ÎŸÎ£ Î”Î™Î‘Î“ÎÎ©Î£Î—')) {
            bgColor = '#f8d7da';
            borderColor = '#dc3545';
            textColor = '#721c24';
            fontWeight = 'bold';
        } else if (item.includes('âœ”') || item.includes('+')) {
            bgColor = '#d4edda';
            borderColor = '#28a745';
            textColor = '#155724';
        } else if (item.includes('âœ—') || item.includes('-') || item.includes('âŒ')) {
            bgColor = '#fff3cd';
            borderColor = '#ffc107';
            textColor = '#856404';
        } else if (item.includes('âš ï¸')) {
            bgColor = '#fff3cd';
            borderColor = '#ffc107';
            textColor = '#856404';
        } else if (item.includes('ğŸ’¡')) {
            bgColor = '#e7f3ff';
            borderColor = '#2196f3';
            textColor = '#0d47a1';
        } else if (item.includes('Î¤Î•Î›Î™ÎšÎ— Î’Î‘Î˜ÎœÎŸÎ›ÎŸÎ“Î™Î‘')) {
            bgColor = '#e3f2fd';
            borderColor = '#2196f3';
            textColor = '#0d47a1';
            fontWeight = 'bold';
        } else if (item.includes('â•”') || item.includes('â”€')) {
            breakdownHTML += '<div style="color: #999; margin: 5px 0;">' + item + '</div>';
            return;
        } else if (item.trim() === '') {
            breakdownHTML += '<div style="height: 5px;"></div>';
            return;
        }
		
        if (item.startsWith('   ')) {
            breakdownHTML += '<div style="padding: 4px 4px 4px 30px; margin: 2px 0; color: ' + textColor + '; font-size: 13px;">' + item + '</div>';
        } else {
            breakdownHTML += '<div style="padding: 10px 15px; margin: 5px 0; background: ' + bgColor + '; border-left: 4px solid ' + borderColor + '; border-radius: 4px; color: ' + textColor + '; font-weight: ' + fontWeight + ';">' + item + '</div>';
        }
    });
	
    let statsHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">';
    
    statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
    statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">Î ÎŸÎ£ÎŸÎ£Î¤ÎŸ</div>';
    statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + percentage + '%</div>';
    statsHTML += '</div>';
    
    if (solution.completionTimeMs) {
        statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
        statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">â±ï¸ Î§Î¡ÎŸÎÎŸÎ£</div>';
        statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + formatElapsedTime(solution.completionTimeMs) + '</div>';
        statsHTML += '</div>';
    }
    
    statsHTML += '<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.3);">';
    statsHTML += '<div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">ğŸ¯ PROMPTS</div>';
    statsHTML += '<div style="font-size: 24px; font-weight: bold;">' + solution.promptCount + '</div>';
    statsHTML += '</div>';
    
    statsHTML += '</div>';
    resultDiv.innerHTML = 
        '<div style="background: ' + headerGradient + '; color: white; padding: 30px; border-radius: 15px; margin: 20px 0; text-align: center; box-shadow: 0 10px 40px ' + headerShadow + ';">' +
		
        '<h2 style="font-size: 32px; margin-bottom: 15px;">' +
        (isPerfect ? 'ğŸ‰ Î¤Î•Î›Î•Î™Î‘ Î›Î¥Î£Î—!' : isContradiction ? 'âŒ Î›ÎŸÎ“Î™ÎšÎ— Î‘ÎÎ¤Î™Î¦Î‘Î£Î—' : solution.score === 0 ? 'âŒ Î›Î‘Î˜ÎŸÎ£ Î‘Î Î‘ÎÎ¤Î—Î£Î—' : 'âœ” Î›Î¥Î£Î— Î¥Î ÎŸÎ’Î›Î—Î˜Î—ÎšÎ•') +
        '</h2>' +
        '<div style="font-size: 64px; font-weight: bold; margin: 20px 0;">' + solution.score + '/' + solution.maxScore + '</div>' +
        '<div style="font-size: 28px; margin-bottom: 20px; color: ' + gradeColor + '; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">' + grade + '</div>' +
        statsHTML +
        '</div>' +
        
        '<div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #28a745;">' +
        '<h4 style="color: #1a1a2e; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #ff6b00; padding-bottom: 8px;">ğŸ“Š Î‘ÎÎ‘Î›Î¥Î£Î— Î’Î‘Î˜ÎœÎŸÎ›ÎŸÎ“Î™Î‘Î£ Î£Î‘Î£</h4>' +
        '<div style="font-family: \'Courier New\', monospace; line-height: 1.8; font-size: 14px;">' +
        breakdownHTML +
        '</div>' +
        '</div>' +
        
        '<div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #dc3545;">' +
        '<h4 style="color: #dc3545; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #dc3545; padding-bottom: 8px;">ğŸ¯ Î›Î¥Î£Î—: Î£Î¥ÎÎ•Î¡Î“Î‘Î¤Î™ÎšÎ— Î”ÎŸÎ›ÎŸÎ¦ÎŸÎÎ™Î‘</h4>' +
        '<h5 style="color: #1a1a2e; margin: 15px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">âš ï¸ Î”Î¡Î‘Î£Î¤Î•Î£ & Î¡ÎŸÎ›ÎŸÎ£</h5>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">ğŸ‘¨â€ğŸ’¼ Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï… ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">ÎœÎ‘Î£Î¤Î¡ÎŸÎ£</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Î¡ÏŒÎ»Î¿Ï‚:</strong> CFO ÎµÏ„Î±Î¹ÏÎµÎ¯Î±Ï‚ â€¢ Î§ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Ï„Î¿Ï… ÏƒÏ‡ÎµÎ´Î¯Î¿Ï…</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">ÎšÎ¯Î½Î·Ï„ÏÎ¿:</strong> Î¥Ï€ÎµÎ¾Î±Î¯ÏÎµÏƒÎ· â‚¬1.5ÎµÎº Ï€Î¿Ï… ÎµÏ€ÏÏŒÎºÎµÎ¹Ï„Î¿ Î½Î± Î±Ï€Î¿ÎºÎ±Î»Ï…Ï†Î¸ÎµÎ¯</div>' +
        '<div><strong style="color: #333;">Î£Ï…Î¼Î²Î¿Î»Î®:</strong> ÎˆÏÎ¹Î¾Îµ Ï„Î¿ ÎºÏ…Î¬Î½Î¹Î¿ ÏƒÏ„Î¿ Î¿Ï…Î¯ÏƒÎºÎ¹ â€¢ Î•Î½Î­ÎºÏÎ¹Î½Îµ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± Î±Î³Î¿ÏÎ¬Ï‚</div>' +
        '</div>' +
        '</div>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">ğŸ‘® Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚</strong>' +
        '<span style="background: #ff6b00; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">Î£Î¥ÎÎ•Î¡Î“ÎŸÎ£</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Î¡ÏŒÎ»Î¿Ï‚:</strong> Î¦ÏÏÎ»Î±ÎºÎ±Ï‚ ÎºÏ„Î¹ÏÎ¯Î¿Ï… â€¢ Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï€Î±Î½Ï„Î¿Ï</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">ÎšÎ¯Î½Î·Ï„ÏÎ¿:</strong> Î§ÏÎ­Î· â‚¬60k ÏƒÏ„Î¿Ï…Ï‚ Ï„Î¿ÎºÎ¿Î³Î»ÏÏ†Î¿Ï…Ï‚</div>' +
        '<div><strong style="color: #333;">Î£Ï…Î¼Î²Î¿Î»Î®:</strong> Î ÏÎ¿Î¼Î®Î¸ÎµÏ…ÏƒÎµ Ï„Î¿ ÎºÏ…Î¬Î½Î¹Î¿ â€¢ Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ ÎºÎ¬Î¼ÎµÏÎµÏ‚ 20:55</div>' +
        '</div>' +
        '</div>' +
        
        '<div style="background: #fff5f5; border-left: 4px solid #dc3545; padding: 15px; margin-bottom: 15px; border-radius: 6px; box-shadow: 0 2px 4px rgba(220,53,69,0.1);">' +
        '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">' +
        '<strong style="color: #dc3545; font-size: 15px;">ğŸ‘©â€ğŸ¦° ÎœÎ±Ï…ÏÎ¯Î´Î· Î•Î»Î­Î½Î·</strong>' +
        '<span style="background: #ff8800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold;">Î£Î¥Î“ÎšÎ‘Î›Î¥Î¨Î—</span>' +
        '</div>' +
        '<div style="color: #666; font-size: 13px; line-height: 1.5;">' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">Î¡ÏŒÎ»Î¿Ï‚:</strong> Î ÏÏÎ·Î½ ÎµÏÏ‰Î¼Î­Î½Î· Î¸ÏÎ¼Î±Ï„Î¿Ï‚ â€¢ IT Î´ÎµÎ¾Î¹ÏŒÏ„Î·Ï„ÎµÏ‚</div>' +
        '<div style="margin-bottom: 4px;"><strong style="color: #333;">ÎšÎ¯Î½Î·Ï„ÏÎ¿:</strong> Î•ÎºÎ²Î¹Î±ÏƒÎ¼ÏŒÏ‚ Î¼Îµ ÎµÏÏ‰Ï„Î¹ÎºÎ­Ï‚ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯ÎµÏ‚</div>' +
        '<div><strong style="color: #333;">Î£Ï…Î¼Î²Î¿Î»Î®:</strong> ÎˆÏƒÏ„ÎµÎ¹Î»Îµ fake email Â«Î±Ï…Ï„Î¿ÎºÏ„Î¿Î½Î¯Î±Ï‚Â» 21:25 â€¢ Î Î»Î±ÏƒÏ„ÏŒ ÏƒÎ·Î¼ÎµÎ¯Ï‰Î¼Î±</div>' +
        '</div>' +
        '</div>' +
        '<h5 style="color: #1a1a2e; margin: 20px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">ğŸ” ÎšÎ¡Î™Î£Î™ÎœÎ‘ Î£Î¤ÎŸÎ™Î§Î•Î™Î‘</h5>' +
        '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-bottom: 15px;">' +
        '<div style="background: #e3f2fd; padding: 10px; border-radius: 6px; border-left: 3px solid #2196f3;">' +
        '<div style="font-weight: bold; color: #0d47a1; margin-bottom: 4px;">ğŸ“± SMS Î‘Ï€ÎµÎ¹Î»Î®Ï‚</div>' +
        '<div style="font-size: 12px; color: #555;">Â«Î˜Î± Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ Î±Ï€ÏŒÏˆÎµÂ»</div>' +
        '</div>' +
        '<div style="background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 3px solid #ffc107;">' +
        '<div style="font-weight: bold; color: #856404; margin-bottom: 4px;">ğŸ¥ƒ Î Î¿Ï„Î®ÏÎ¹Î±</div>' +
        '<div style="font-size: 12px; color: #555;">ÎˆÎ½Î± Î¼Îµ ÎºÏ…Î¬Î½Î¹Î¿, Î­Î½Î± ÎºÎ±Î¸Î±ÏÏŒ</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 10px; border-radius: 6px; border-left: 3px solid #dc3545;">' +
        '<div style="font-weight: bold; color: #721c24; margin-bottom: 4px;">âœï¸ Î Î»Î±ÏƒÏ„ÏŒ Î£Î·Î¼ÎµÎ¯Ï‰Î¼Î±</div>' +
        '<div style="font-size: 12px; color: #555;">ÎœÎ¯Î¼Î·ÏƒÎ· Î³ÏÎ±Ï†Î®Ï‚ 65%</div>' +
        '</div>' +
        '<div style="background: #d4edda; padding: 10px; border-radius: 6px; border-left: 3px solid #28a745;">' +
        '<div style="font-weight: bold; color: #155724; margin-bottom: 4px;">ğŸ§ª Î‘Î»Ï€ÏÎ±Î¶Î¿Î»Î¬Î¼Î·</div>' +
        '<div style="font-size: 12px; color: #555;">2mg ÏƒÏ„Î¿ Î±Î¯Î¼Î± (ÎºÎ±Ï„ÎµÏ…Î½Î±ÏƒÏ„Î¹ÎºÏŒ)</div>' +
        '</div>' +
        '<div style="background: #e0e0e0; padding: 10px; border-radius: 6px; border-left: 3px solid #6c757d;">' +
        '<div style="font-weight: bold; color: #495057; margin-bottom: 4px;">ğŸ“¹ ÎšÎ¬Î¼ÎµÏÎµÏ‚ OFF</div>' +
        '<div style="font-size: 12px; color: #555;">Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· 20:55</div>' +
        '</div>' +
        '<div style="background: #ffe0e0; padding: 10px; border-radius: 6px; border-left: 3px solid #ff6b6b;">' +
        '<div style="font-weight: bold; color: #c92a2a; margin-bottom: 4px;">ğŸ½ï¸ Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±</div>' +
        '<div style="font-size: 12px; color: #555;">Î¦Î±Î³Î·Ï„ÏŒ Î³Î¹Î± 2, Î¸ÏÎ¼Î± Î¼ÏŒÎ½Î¿</div>' +
        '</div>' +
        '</div>' +
        '<h5 style="color: #1a1a2e; margin: 20px 0 10px 0; font-size: 15px; display: flex; align-items: center; gap: 8px;">' +
        'ğŸ“ Î‘ÎÎ‘Î›Î¥Î£Î— Î‘Î›Î›ÎŸÎ˜Î™' +
        '<span style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; margin-left: 10px;">Î©Î¡Î‘ Î”ÎŸÎ›ÎŸÎ¦ÎŸÎÎ™Î‘Î£: 21:30-21:50</span>' +
        '</h5>' +
        
        '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; margin-bottom: 15px;">' +
        '<div style="background: #d4edda; padding: 12px; border-radius: 6px; border-left: 4px solid #28a745;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">ğŸ‘©</span>' +
        '<strong style="color: #155724; font-size: 13px;">Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï… ÎœÎ±ÏÎ¯Î±</strong>' +
        '<span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">âœ” Î™Î£Î§Î¥Î¡ÎŸ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #155724; line-height: 1.5;">' +
        '<div>â€¢ Î“Î¹Î±Ï„ÏÏŒÏ‚ 18:30-19:30 (ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹Ï‰Î¼Î­Î½Î¿)</div>' +
        '<div>â€¢ Î”ÎµÎ¯Ï€Î½Î¿ Î¼Îµ Î±Î´ÎµÎ»Ï†Î® 19:45-22:30</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(40,167,69,0.1); border-radius: 3px;">âœ” ÎšÎ¬Î»Ï…ÏˆÎµ ÏŒÎ»Î¿ Ï„Î¿ ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">ğŸ‘¨â€ğŸ’¼</span>' +
        '<strong style="color: #721c24; font-size: 13px;">Î‘Î½Î±Î³Î½ÏÏƒÏ„Î¿Ï… ÎšÏ‰Î½ÏƒÏ„Î±Î½Ï„Î¯Î½Î¿Ï‚</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">âŒ Î‘Î£Î˜Î•ÎÎ•Î£</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>â€¢ Î”ÎµÎ¯Ï€Î½Î¿ Â«Î”Î¹ÏŒÎ½Ï…ÏƒÎ¿Ï‚Â» 18:45-20:30</div>' +
        '<div>â€¢ Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿ 200m Î±Ï€ÏŒ ÎºÏ„Î¯ÏÎ¹Î¿!</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">âŒ Î§ÏÏŒÎ½Î¿Ï‚ 20:30-21:50: Î§Î©Î¡Î™Î£ ÎšÎ‘Î›Î¥Î¨Î—!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">ğŸ‘©â€ğŸ¦°</span>' +
        '<strong style="color: #721c24; font-size: 13px;">ÎœÎ±Ï…ÏÎ¯Î´Î· Î•Î»Î­Î½Î·</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">âŒ Î£Î Î‘Î£ÎœÎ•ÎÎŸ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>â€¢ Î Î±ÏÎ¿Ï…ÏƒÎ¯Î±ÏƒÎ· Î²Î¹Î²Î»Î¯Î¿Ï… 19:30-20:30</div>' +
        '<div>â€¢ "ÎœÎµÏ„Î¬ ÏƒÏ„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿" (Î±ÏŒÏÎ¹ÏƒÏ„Î¿)</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">âŒ ÎŸÎ¼Î¿Î»Î¿Î³ÎµÎ¯ Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î± ÏƒÏ„Î¿ ÎºÏ„Î¯ÏÎ¹Î¿ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¿Î»Î¿Ï†Î¿Î½Î¯Î±!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">ğŸ‘®</span>' +
        '<strong style="color: #721c24; font-size: 13px;">Î ÎµÏ„ÏÏŒÏ€Î¿Ï…Î»Î¿Ï‚ Î“ÎµÏÏÎ³Î¹Î¿Ï‚</strong>' +
        '<span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">âŒ Î¨Î•Î¥Î”Î•Î£</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #721c24; line-height: 1.5;">' +
        '<div>â€¢ Î™ÏƒÏ‡Ï…ÏÎ¯Î¶ÎµÏ„Î±Î¹: Î’Î¬ÏÎ´Î¹Î± ÏŒÎ»Î¿ Î²ÏÎ¬Î´Ï…</div>' +
        '<div>â€¢ Î™ÏƒÏ‡Ï…ÏÎ¯Î¶ÎµÏ„Î±Î¹: Î ÎµÏÎ¹Ï€Î¿Î»Î¯ÎµÏ‚ ÎºÎ¬Î¸Îµ 2h</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(220,53,69,0.1); border-radius: 3px;">âŒ Î‘Î ÎŸÎ”Î•Î™ÎÎ—: Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ ÎºÎ¬Î¼ÎµÏÎµÏ‚ 20:55!</div>' +
        '</div>' +
        '</div>' +
        '<div style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">' +
        '<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">' +
        '<span style="font-size: 18px;">ğŸ‘©â€ğŸ’»</span>' +
        '<strong style="color: #856404; font-size: 13px;">ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï… Î‘Î»ÎµÎ¾Î¬Î½Î´ÏÎ±</strong>' +
        '<span style="background: #ffc107; color: #000; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; margin-left: auto;">âš ï¸ Î‘Î’Î•Î’Î‘Î™ÎŸ</span>' +
        '</div>' +
        '<div style="font-size: 11px; color: #856404; line-height: 1.5;">' +
        '<div>â€¢ Â«ÎœÎ¹ÎºÏÏŒ ÎšÎ±Ï†Î­Â» Î¼Î­Ï‡ÏÎ¹ 20:30</div>' +
        '<div>â€¢ Î”ÎµÎ½ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¹ÏÎ¸Î·ÎºÎµ Î±Ï€ÏŒ Î¼Î¬ÏÏ„Ï…ÏÎµÏ‚</div>' +
        '<div style="margin-top: 4px; padding: 4px 6px; background: rgba(255,193,7,0.1); border-radius: 3px;">âš ï¸ Î‘Î´ÏÎ½Î±Î¼Î¿ Î±Î»Î»Î¬ Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Î¬Î»Î»Î± Ï„ÎµÎºÎ¼Î®ÏÎ¹Î± ÎµÎ½Î±Î½Ï„Î¯Î¿Î½ Ï„Î·Ï‚</div>' +
        '</div>' +
        '</div>' +
        
        '</div>' +
        '<div style="background: #e7f3ff; border: 2px solid #2196f3; padding: 15px; border-radius: 8px; margin-top: 10px;">' +
        '<div style="font-weight: bold; color: #0d47a1; margin-bottom: 8px; font-size: 13px;">ğŸ’¡ Î£Î¥ÎœÎ Î•Î¡Î‘Î£ÎœÎ‘</div>' +
        '<div style="font-size: 12px; color: #1565c0; line-height: 1.6;">' +
        'ÎŸÎ¹ <strong>Ï„ÏÎµÎ¹Ï‚ Î´ÏÎ¬ÏƒÏ„ÎµÏ‚</strong> ÎµÎ¯Ï‡Î±Î½ <strong>ÎµÏ…ÎºÎ±Î¹ÏÎ¯Î±</strong> (21:30-21:50), <strong>ÎºÎ¯Î½Î·Ï„ÏÎ¿</strong> (Ï‡ÏÎ®Î¼Î±Ï„Î±/ÎµÎºÎ²Î¹Î±ÏƒÎ¼ÏŒÏ‚), ÎºÎ±Î¹ ' +
        '<strong>Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·</strong> ÏƒÏ„Î¿ ÎºÏ…Î¬Î½Î¹Î¿. Î— Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï… ÎµÎ¯Ï‡Îµ ÏƒÎ¹Î´ÎµÏÎ­Î½Î¹Î¿ Î¬Î»Î»Î¿Î¸Î¹. Î— ÎÎ¹ÎºÎ¿Î»Î¬Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Ï‡Îµ ÎºÎ¯Î½Î·Ï„ÏÎ¿ Î¿ÏÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎºÏ…Î¬Î½Î¹Î¿.' +
        '</div>' +
        '</div>' +
        
        '</div>';
    
    resultDiv.style.display = 'block';
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    const solutionForm = document.getElementById('solutionForm');
    if (solutionForm) {
        solutionForm.style.display = 'none';
    }
    
    stopTimer();
}

window.revealSolution = async function() {
    const password = document.getElementById('solutionPassword').value.toUpperCase();
    const correctPassword = 'MURDER';
    
    if (password !== correctPassword) {
        alert('âŒ Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î–Î·Ï„Î®ÏƒÏ„Îµ Ï„Î¿Î½ ÏƒÏ‰ÏƒÏ„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î±Ï€ÏŒ Ï„Î¿Î½ Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.');
        document.getElementById('solutionPassword').value = '';
        return;
    }
	
    const teamData = await getTeamData();
    const solution = teamData.solution;
    
    if (!solution) {
        alert('Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï…Ï€Î¿Î²Î»Î·Î¸ÎµÎ¯ÏƒÎ± Î»ÏÏƒÎ·!');
        return;
    }

    const scoreResult = calculateScore(
        solution.suspects, 
        solution.completionTimeMs, 
        solution.promptCount
    );

    const completeSolution = {
        ...solution,
        score: scoreResult.score,
        maxScore: scoreResult.maxScore,
        breakdown: scoreResult.breakdown,
        correctCount: scoreResult.correctCount,
        wrongCount: solution.suspects.length - scoreResult.correctCount
    };
	
    const submissionHeader = document.getElementById('submissionHeader');
    const passwordSection = document.getElementById('passwordSection');
    if (submissionHeader) submissionHeader.style.display = 'none';
    if (passwordSection) passwordSection.style.display = 'none';

    displaySolutionResult(completeSolution);
};

function buildUrl(page) {
    return teamCode !== 'default' ? `${page}?team=${teamCode}` : page;
}

function renderEvidence() {
    const unlockedTeks = getUnlockedTeks();
    const grid = document.getElementById('evidenceGrid');
    
    grid.innerHTML = teks.map(tek => {
        const isUnlocked = unlockedTeks.includes(tek.id);
        const cardClass = isUnlocked ? 'unlocked' : 'locked';
        
        let criticalTag = '';
        if (tek.critical) criticalTag = '<span class="critical-tag">ÎšÎ¡Î™Î£Î™ÎœÎŸ</span>';
        else if (tek.secret) criticalTag = '<span class="critical-tag">Î‘Î ÎŸÎ¡Î¡Î—Î¤ÎŸ</span>';
        else if (tek.blackmail) criticalTag = '<span class="critical-tag">Î•ÎšÎ’Î™Î‘Î£ÎœÎŸÎ£</span>';
        else if (tek.sabotage) criticalTag = '<span class="critical-tag">Î£Î‘ÎœÎ ÎŸÎ¤Î‘Î–</span>';
        else if (tek.threat) criticalTag = '<span class="critical-tag">Î‘Î Î•Î™Î›Î—</span>';
        else if (tek.forgery) criticalTag = '<span class="critical-tag">Î Î›Î‘Î£Î¤ÎŸÎ“Î¡Î‘Î¦Î™Î‘</span>';
        else if (tek.clue) criticalTag = '<span class="critical-tag">Î•ÎÎ”Î•Î™ÎÎ—</span>';
        else if (tek.financial) criticalTag = '<span class="critical-tag">ÎŸÎ™ÎšÎŸÎÎŸÎœÎ™ÎšÎŸ</span>';
        
        return `
            <div class="evidence-card ${cardClass}">
                ${criticalTag}
                ${!isUnlocked ? '<div class="lock-overlay">ğŸ”’</div>' : ''}
                <div class="evidence-header">
                    <div class="evidence-icon">${tek.icon}</div>
                    <div class="evidence-info">
                        <h3>Î¤Î•Îš #${tek.id.padStart(3, '0')}</h3>
                        <p>${tek.subtitle}</p>
                    </div>
                </div>
                <p class="evidence-description">
                    ${isUnlocked ? tek.description : 'ğŸ”’ ÎÎµÎºÎ»ÎµÎ¹Î´ÏÏƒÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï„ÎµÎºÎ¼Î®ÏÎ¹Î¿ Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚'}
                </p>
                <div class="evidence-actions">
                    ${isUnlocked ? 
                        `<a href="${buildUrl(tek.page)}" class="btn btn-ar">
                            ğŸ‘ï¸ Î ÏÎ¿Î²Î¿Î»Î® Î¤ÎµÎºÎ¼Î·ÏÎ¯Î¿Ï…
                        </a>` :
                        `<button class="btn btn-ar" disabled>ğŸ”’ ÎšÎ»ÎµÎ¹Î´Ï‰Î¼Î­Î½Î¿</button>`
                    }
                </div>
                <span class="status-badge ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                    ${isUnlocked ? 'âœ… Î”Î™Î‘Î˜Î•Î£Î™ÎœÎŸ' : 'ğŸ”’ ÎšÎ›Î•Î™Î”Î©ÎœÎ•ÎÎŸ'}
                </span>
            </div>
        `;
    }).join('');
}

async function initSolutionTab(teamData) {
    const solutionIntroBox = document.getElementById('solutionIntroBox');
    const solutionForm = document.getElementById('solutionForm');
    const existingSolution = teamData.solution;
    
    if (existingSolution) {
        if (solutionIntroBox) {
            solutionIntroBox.style.display = 'none';
        }
        if (solutionForm) {
            solutionForm.style.display = 'none';
        }
		
        displaySubmissionConfirmation();
    }
}

window.addEventListener('storage', async (e) => {
    if (e.key === getStorageKey() || e.key === `solution_${teamCode}`) {
        console.log('ğŸ”„ Storage change detected, updating UI...');
        renderEvidence();
        const teamData = await getTeamData();
        await updateProgress(teamData);
        const solutionTab = document.getElementById('tab-solution');
        if (solutionTab && solutionTab.classList.contains('active')) {
            await initSolutionTab(teamData);
        }
    }
});

window.submitSolution = submitSolution;

function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-tab');

            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
        });
    });
}

window.submitSolution = submitSolution;
window.switchToSurveyTab = switchToSurveyTab;

let resultsUnsubscribe = null;

function switchToSurveyTab() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabButtons.forEach(btn => btn.classList.remove('active'));
    tabPanes.forEach(pane => pane.classList.remove('active'));
    
    document.querySelector('[data-tab="survey"]').classList.add('active');
    document.getElementById('tab-survey').classList.add('active');
}

async function checkSurveyCompletion() {
    if (!window.firebaseDB) {
        console.warn('Firebase not ready for survey check');
        return { 
            pre: false, 
            post: false, 
            preCount: 0, 
            postCount: 0, 
            bothCount: 0,
            teamSize: 0,
            members: [] 
        };
    }

    try {
        const teamDocRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
        const teamDoc = await window.firebaseGetDoc(teamDocRef);
        const teamSize = teamDoc.exists() ? (teamDoc.data().teamSize || 0) : 0;
        
        if (teamSize === 0) {
            console.warn(`Team ${teamCode} has no teamSize configured. Please set teamSize in Firebase.`);
        }
		
        const surveysRef = window.firebaseCollection(window.firebaseDB, 'surveys');
        const querySnapshot = await window.firebaseGetDocs(surveysRef);
        
        const preMembers = new Set();
        const postMembers = new Set();
        const membersWithBoth = new Set();
        querySnapshot.forEach((doc) => {
            const docId = doc.id;
            if (docId.startsWith(`${teamCode}_pre_`)) {
                const memberName = docId.replace(`${teamCode}_pre_`, '');
                preMembers.add(memberName);
            }
			
            if (docId.startsWith(`${teamCode}_post_`)) {
                const memberName = docId.replace(`${teamCode}_post_`, '');
                postMembers.add(memberName);
            }
        });

        preMembers.forEach(member => {
            if (postMembers.has(member)) {
                membersWithBoth.add(member);
            }
        });
        
        const bothCount = membersWithBoth.size;
        const meetsRequirement = teamSize > 0 && bothCount >= teamSize;
        
        console.log(`Survey check for ${teamCode}:`);
        console.log(`  Team size: ${teamSize}`);
        console.log(`  Members completed both: ${bothCount}/${teamSize}`);
        console.log(`  Pre-survey: ${preMembers.size}, Post-survey: ${postMembers.size}`);
        console.log(`  Requirement met: ${meetsRequirement}`);
        
        return {
            pre: meetsRequirement,
            post: meetsRequirement,
            preCount: preMembers.size,
            postCount: postMembers.size,
            bothCount: bothCount,
            teamSize: teamSize,
            members: Array.from(membersWithBoth)
        };
    } catch (error) {
        console.error('Error checking surveys:', error);
        return { 
            pre: false, 
            post: false, 
            preCount: 0, 
            postCount: 0, 
            bothCount: 0,
            teamSize: 0,
            members: [] 
        };
    }
}

async function checkLeaderboardUnlocked() {
    if (!window.firebaseDB) return false;
    
    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'config', 'leaderboard');
        const docSnap = await window.firebaseGetDoc(docRef);
        
        return docSnap.exists() ? (docSnap.data().unlocked || false) : false;
    } catch (error) {
        console.error('Error checking leaderboard status:', error);
        return false;
    }
}

async function updateResultsTabState() {
    const memberName = sessionStorage.getItem('memberName');
    const teamCode = sessionStorage.getItem('teamCode') || new URLSearchParams(window.location.search).get('team');
    
    if (!memberName || !teamCode) {
        console.error('Member or team info missing!');
        return;
    }

    const postSurveyDoc = `${teamCode}_post_${memberName}`;
    const postSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', postSurveyDoc);
    const postSurveySnap = await window.firebaseGetDoc(postSurveyRef);
    const memberCompletedPost = postSurveySnap.exists();
    const surveys = await checkSurveyCompletion();
    const leaderboardUnlocked = await checkLeaderboardUnlocked();
    
    const surveysIncomplete = document.getElementById('surveysIncomplete');
    const leaderboardLocked = document.getElementById('leaderboardLocked');
    const leaderboardUnlockedDiv = document.getElementById('leaderboardUnlocked');

    if (!memberCompletedPost) {
        surveysIncomplete.innerHTML = `
            <div class="intro-box" style="text-align: center; padding: 60px 30px;">
                <div style="font-size: clamp(80px, 20vw, 120px); margin-bottom: 30px;">ğŸ“</div>
                <h2 style="color: #1a1a2e; font-size: clamp(20px, 5vw, 28px); margin-bottom: 20px;">
                    ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÏƒÏ„Îµ Î ÏÏÏ„Î± Ï„Î·Î½ Î¤ÎµÎ»Î¹ÎºÎ® ÎˆÏÎµÏ…Î½Î±
                </h2>
                <a href="survey.html?team=${teamCode}&member=${encodeURIComponent(memberName)}" 
                   class="btn btn-primary" 
                   style="display: inline-block; text-decoration: none; font-size: clamp(16px, 3.5vw, 18px); padding: clamp(15px, 3vw, 18px) clamp(30px, 6vw, 40px);">
                    ğŸ“Š ÎœÎ•Î¤Î‘Î’Î‘Î£Î— Î£Î¤Î—Î Î¤Î•Î›Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘
                </a>
            </div>
        `;
        surveysIncomplete.style.display = 'block';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'none';
        return;
    }
    const preSurveyStatus = document.getElementById('preSurveyStatus');
    const postSurveyStatus = document.getElementById('postSurveyStatus');
    
    if (preSurveyStatus) {
        if (surveys.teamSize === 0) {
            preSurveyStatus.innerHTML = 'âš ï¸ <strong>Î Î¡ÎŸÎšÎ‘Î¤Î‘Î¡ÎšÎ¤Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ÎœÎ•Î“Î•Î˜ÎŸÎ£ ÎŸÎœÎ‘Î”Î‘Î£ Î”Î•Î Î•Î§Î•Î™ ÎŸÎ¡Î™Î£Î¤Î•Î™';
        } else if (surveys.bothCount >= surveys.teamSize) {
            preSurveyStatus.innerHTML = `âœ… <strong>Î Î¡ÎŸÎšÎ‘Î¤Î‘Î¡ÎšÎ¤Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ÎŸÎ›Î‘ Î¤Î‘ ÎœÎ•Î›Î— (${surveys.preCount}/${surveys.teamSize}) Î¤Î—Î ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î£Î‘Î`;
        } else {
            preSurveyStatus.innerHTML = `â³ <strong>Î Î¡ÎŸÎšÎ‘Î¤Î‘Î¡ÎšÎ¤Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ${surveys.preCount}/${surveys.teamSize} ÎœÎ•Î›Î— Î¤Î—Î ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î£Î‘Î`;
        }
    }
    
    if (postSurveyStatus) {
        if (surveys.teamSize === 0) {
            postSurveyStatus.innerHTML = 'âš ï¸ <strong>Î¤Î•Î›Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ÎœÎ•Î“Î•Î˜ÎŸÎ£ ÎŸÎœÎ‘Î”Î‘Î£ Î”Î•Î Î•Î§Î•Î™ ÎŸÎ¡Î™Î£Î¤Î•Î™';
        } else if (surveys.bothCount >= surveys.teamSize) {
            postSurveyStatus.innerHTML = `âœ… <strong>Î¤Î•Î›Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ÎŸÎ›Î‘ Î¤Î‘ ÎœÎ•Î›Î— (${surveys.postCount}/${surveys.teamSize}) Î¤Î—Î ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î£Î‘Î`;
        } else {
            postSurveyStatus.innerHTML = `â³ <strong>Î¤Î•Î›Î™ÎšÎ— Î•Î¡Î•Î¥ÎÎ‘:</strong> ${surveys.postCount}/${surveys.teamSize} ÎœÎ•Î›Î— Î¤Î—Î ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î£Î‘Î`;
        }
    }
    
    if (!surveys.pre || !surveys.post) {
        surveysIncomplete.style.display = 'block';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'none';
    } else if (!leaderboardUnlocked) {
        surveysIncomplete.style.display = 'none';
        leaderboardLocked.style.display = 'block';
        leaderboardUnlockedDiv.style.display = 'none';
    } else {
        surveysIncomplete.style.display = 'none';
        leaderboardLocked.style.display = 'none';
        leaderboardUnlockedDiv.style.display = 'block';
        await loadLeaderboardData();
    }
}

function getResultsGrade(percentage) {
    if (percentage >= 90) return { name: 'Î‘Î¡Î§Î™-ÎÎ¤Î•Î¤Î•ÎšÎ¤Î™Î’Î£ ğŸ•µï¸', color: '#00d4ff' };
    if (percentage >= 80) return { name: 'Î‘ÎÎ©Î¤Î•Î¡ÎŸÎ™ Î‘ÎÎ‘ÎšÎ¡Î™Î¤Î•Î£ ğŸ–ï¸', color: '#ffd700' };
    if (percentage >= 70) return { name: 'ÎÎ¤Î•Î¤Î•ÎšÎ¤Î™Î’Î£ ğŸ”', color: '#c0c0c0' };
    if (percentage >= 60) return { name: 'Î‘Î£Î¤Î¥ÎÎŸÎœÎŸÎ™ ğŸ‘®', color: '#cd7f32' };
    if (percentage >= 50) return { name: 'Î•Î¡Î•Î¥ÎÎ—Î¤Î•Î£ ğŸ“‹', color: '#ffcc00' };
    if (percentage >= 40) return { name: 'Î‘Î£ÎšÎŸÎ¥ÎœÎ•ÎÎŸÎ™ ğŸ“', color: '#28a745' };
    return { name: 'ÎÎ•ÎŸÎ£Î¥Î›Î›Î•ÎšÎ¤ÎŸÎ™ ğŸ¯', color: '#6c757d' };
}

async function loadLeaderboardData() {
    try {
        console.log('ğŸ“Š Loading leaderboard data...');
        
        if (!window.firebaseDB) {
            console.error('Firebase not ready!');
            displayLeaderboardError('Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€Î­Ï„Ï…Ï‡Îµ');
            return;
        }
        
        const querySnapshot = await window.firebaseGetDocs(
            window.firebaseCollection(window.firebaseDB, 'teams')
        );
        
        console.log(`Found ${querySnapshot.size} teams in database`);
        
        const teams = [];
        querySnapshot.forEach((doc) => {
            const data = doc.data();
            console.log(`Team ${doc.id}:`, {
                hasSolution: !!data.solution,
                score: data.solution?.score,
                unlocked: data.unlocked?.length
            });
            
            if (data.solution) {
                teams.push({
                    name: doc.id,
                    ...data
                });
            }
        });

        console.log(`${teams.length} teams have submitted solutions`);

if (teams.length === 0) {
            displayLeaderboardError('Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¿Î¼Î¬Î´ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Ï…Ï€Î¿Î²Î¬Î»ÎµÎ¹ Î»ÏÏƒÎ· Î±ÎºÏŒÎ¼Î±!');
            return;
        }

        teams.sort((a, b) => b.solution.score - a.solution.score);

        displayResultsStats(teams);
        displayResultsLeaderboard(teams);

    } catch (error) {
        console.error('Error loading leaderboard:', error);
        displayLeaderboardError(`Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚: ${error.message}`);
    }
}
function displayLeaderboardError(message) {
    const tableBody = document.getElementById('resultsTableBody');
    const cardsContainer = document.getElementById('resultsCards');
    
    const errorHTML = `
        <div style="text-align: center; padding: 40px; color: #666;">
            <div style="font-size: 60px; margin-bottom: 20px;">âš ï¸</div>
            <div style="color: #dc3545; font-weight: bold; margin-bottom: 15px; white-space: pre-line;">
                ${message}
            </div>
            <button onclick="loadLeaderboardData()" style="margin-top: 20px; padding: 12px 24px; background: #ff6b00; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                ğŸ”„ Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ ÎÎ±Î½Î¬
            </button>
        </div>
    `;
    
    if (tableBody) {
        tableBody.innerHTML = `<tr><td colspan="5">${errorHTML}</td></tr>`;
    }
    
    if (cardsContainer) {
        cardsContainer.innerHTML = errorHTML;
    }
}

function formatTime(ms) {
    if (!ms) return 'N/A';
    const seconds = Math.floor(ms / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    
    const h = hours;
    const m = minutes % 60;
    const s = seconds % 60;
    
    if (h > 0) return `${h}Ï‰ ${m}Î» ${s}Î´`;
    else if (m > 0) return `${m}Î» ${s}Î´`;
    else return `${s}Î´`;
}

function displayResultsStats(teams) {
    const totalTeams = teams.length;
    const perfectScores = teams.filter(t => {
        const suspects = t.solution.suspects || [];
        return suspects.length === 3 && 
               suspects.includes('konstantinos') && 
               suspects.includes('georgios') && 
               suspects.includes('eleni');
    }).length;
    
    const avgScore = totalTeams > 0 
        ? Math.round(teams.reduce((sum, t) => sum + t.solution.score, 0) / totalTeams)
        : 0;
    
    const avgTime = totalTeams > 0
        ? formatTime(teams.reduce((sum, t) => sum + (t.solution.completionTimeMs || 0), 0) / totalTeams)
        : 'N/A';

    document.getElementById('totalTeams').textContent = totalTeams;
    document.getElementById('perfectScores').textContent = perfectScores;
    document.getElementById('avgScore').textContent = avgScore;
    document.getElementById('avgTime').textContent = avgTime;
}

function displayResultsLeaderboard(teams) {
    const tableBody = document.getElementById('resultsTableBody');
    const cardsContainer = document.getElementById('resultsCards');
    const table = document.getElementById('resultsTable');
    const cards = document.getElementById('resultsCards');
    
    if (!tableBody || !cardsContainer || !table || !cards) {
        console.error('Leaderboard elements not found in DOM!');
        return;
    }
    
    if (teams.length === 0) {
        displayLeaderboardError('Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï…Ï€Î¿Î²Î¿Î»Î­Ï‚ Î±ÎºÏŒÎ¼Î±');
        return;
    }

    if (window.innerWidth > 768) {
        table.style.display = 'table';
        cards.style.display = 'none';
    } else {
        table.style.display = 'none';
        cards.style.display = 'block';
    }

    tableBody.innerHTML = teams.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? `rank-${rank}` : '';
        const solution = team.solution;
        
        const maxScore = solution.maxScore || 140;
        const percentage = Math.round((solution.score / maxScore) * 100);
        const grade = getResultsGrade(percentage);
        const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;

        const isCurrentTeam = team.name === teamCode;
        const rowStyle = isCurrentTeam ? 'background: #fff3cd; font-weight: bold;' : '';

        return `
            <tr style="${rowStyle}">
                <td class="rank ${rankClass}" style="padding: 12px 10px; font-size: clamp(18px, 4vw, 24px); font-weight: bold; text-align: center;">
                    ${rankEmoji}
                </td>
                <td style="padding: 12px 10px; font-weight: bold; color: #1a1a2e; text-transform: uppercase;">
                    ${team.name.toUpperCase()}
                </td>
                <td style="padding: 12px 10px; font-weight: bold; color: #28a745;">
                    ${solution.score}/${maxScore}
                </td>
                <td style="padding: 12px 10px;">
                    <span style="display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: clamp(10px, 2vw, 12px); font-weight: bold; background: ${grade.color}; color: ${percentage >= 50 ? '#000' : '#fff'};">
                        ${grade.name}
                    </span>
                </td>
                <td style="padding: 12px 10px;">
                    ${formatTime(solution.completionTimeMs)}
                </td>
            </tr>
        `;
    }).join('');

    cardsContainer.innerHTML = teams.map((team, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? `rank-${rank}` : '';
        const solution = team.solution;
        
        const maxScore = solution.maxScore || 140;
        const percentage = Math.round((solution.score / maxScore) * 100);
        const grade = getResultsGrade(percentage);
        const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `#${rank}`;

        const isCurrentTeam = team.name === teamCode;
        const cardStyle = isCurrentTeam ? 'border: 3px solid #ffc107; box-shadow: 0 5px 25px rgba(255,193,7,0.4);' : '';

        return `
            <div style="background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 15px; ${cardStyle}">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
                    <div class="${rankClass}" style="font-size: 36px; font-weight: bold;">${rankEmoji}</div>
                    <div style="font-size: 18px; font-weight: bold; color: #1a1a2e; text-transform: uppercase; flex: 1; margin: 0 15px;">
                        ${team.name.toUpperCase()}
                    </div>
                    <div style="font-size: 24px; font-weight: bold; color: #28a745;">
                        ${solution.score}/${maxScore}
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f5f5f5;">
                    <div style="font-weight: bold; color: #666; font-size: 13px;">Î¤Î™Î¤Î›ÎŸÎ£</div>
                    <div>
                        <span style="display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: 10px; font-weight: bold; background: ${grade.color}; color: ${percentage >= 50 ? '#000' : '#fff'};">
                            ${grade.name}
                        </span>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                    <div style="font-weight: bold; color: #666; font-size: 13px;">Î§Î¡ÎŸÎÎŸÎ£</div>
                    <div style="color: #333;">${formatTime(solution.completionTimeMs)}</div>
                </div>
            </div>
        `;
    }).join('');
    
    console.log('âœ… Leaderboard displayed successfully');
}

function setupResultsListener() {
    if (!window.firebaseDB) {
        console.warn('Firebase not ready for results listener');
        setTimeout(setupResultsListener, 500);
        return;
    }

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'config', 'leaderboard');
        
        if (resultsUnsubscribe) {
            resultsUnsubscribe();
        }

        resultsUnsubscribe = window.firebaseOnSnapshot(docRef, 
            () => {
                console.log('Leaderboard status changed, updating results tab...');
                const resultsTab = document.getElementById('tab-results');
                if (resultsTab && resultsTab.classList.contains('active')) {
                    updateResultsTabState();
                }
            },
            (error) => {
                console.error('Error listening to leaderboard status:', error);
            }
        );

        console.log('âœ… Results tab real-time listener active');
    } catch (error) {
        console.error('Error setting up results listener:', error);
    }
}

function initTabsWithResults() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
        button.addEventListener('click', async () => {
            const targetTab = button.getAttribute('data-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabPanes.forEach(pane => pane.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
            if (targetTab === 'results') {
                await updateResultsTabState();
            }
        });
    });
}

window.addEventListener('DOMContentLoaded', async () => {
    console.log('ğŸ”„ Initializing tabs...');
    initTabsWithResults();
    console.log('âœ… Tabs initialized');

    const isMemberAuth = sessionStorage.getItem('memberAuth');
    const storedTeam = sessionStorage.getItem('teamCode');
    const memberName = sessionStorage.getItem('memberName');

    if (teamCode === 'default' && !isMemberAuth) {
        console.warn('âš ï¸ Not authenticated, redirecting to member entry...');
        window.location.href = 'team_member_entry.html';
        return;
    }
    
    if (teamCode === 'default' && storedTeam) {
        console.log('Using stored team:', storedTeam);
        window.location.href = `index.html?team=${storedTeam}`;
        return;
    }
	
    try {
        const teamData = await getTeamData();
        if (!teamData.unlocked) {
            console.warn(`âš ï¸ Team ${teamCode} has no unlock data, initializing empty array`);
            teamData.unlocked = [];
        }
        
        console.log(`âœ… Team ${teamCode} loaded successfully`);
    } catch (error) {
        console.error('Error checking/creating team:', error);
    }
    
    try {
        if (typeof SuspectsModule !== 'undefined') {
            SuspectsModule.renderSuspects('suspectsContainer');
        } else {
            console.error('SuspectsModule not loaded! Make sure suspects.js is included before this script.');
        }
		
        renderEvidence();
        const teamData = await getTeamData();
        await updateProgress(teamData);
        await initSolutionTab(teamData);
        
    } catch (error) {
        console.error('Error during initialization:', error);
        alert('Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚! Î Î±ÏÎ±ÎºÎ±Î»Ï Î±Î½Î±Î½ÎµÏÏƒÏ„Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î±.');
    }

    setInterval(async () => {
        const solutionTab = document.getElementById('tab-solution');
        if (solutionTab && solutionTab.classList.contains('active')) {
            const teamData = await getTeamData();
            const solutionForm = document.getElementById('solutionForm');
            if (teamData.solution && solutionForm && solutionForm.style.display !== 'none') {
                console.log('Solution detected from another source, refreshing display...');
                await initSolutionTab(teamData);
            }
        }
    }, 5000);

    let firestoreUnsubscribe = null;

    function setupRealtimeListener() {
        if (!window.firebaseDB || !window.firebaseOnSnapshot) {
            console.warn('Firebase not ready, falling back to polling');
            setInterval(checkForUpdates, 3000);
            return;
        }
        
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            
            firestoreUnsubscribe = window.firebaseOnSnapshot(docRef, 
                (doc) => {
                    if (doc.exists()) {
                        const firebaseData = doc.data();
                        console.log('âš¡ Real-time update received for team:', teamCode);
                        
                        localStorage.setItem(getStorageKey(), JSON.stringify(firebaseData));
                        renderEvidence();
                        updateProgress(firebaseData);
                        
                        const solutionTab = document.getElementById('tab-solution');
                        if (solutionTab && solutionTab.classList.contains('active')) {
                            initSolutionTab(firebaseData);
                        }
                    }
                }, 
                (error) => {
                    console.error('Real-time listener error:', error);
                    setInterval(checkForUpdates, 3000);
                }
            );
            
            console.log('âœ… Real-time listener active for team:', teamCode);
        } catch (error) {
            console.error('Error setting up real-time listener:', error);
            setInterval(checkForUpdates, 3000);
        }
    }

    async function checkForUpdates() {
        if (!window.firebaseDB) return;
        
        try {
            const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamCode);
            const docSnap = await window.firebaseGetDoc(docRef);
            
            if (docSnap.exists()) {
                const firebaseData = docSnap.data();
                const localData = await getTeamData();
                
                if (firebaseData.lastUpdate && 
                    (!localData.lastUpdate || firebaseData.lastUpdate > localData.lastUpdate)) {
                    
                    localStorage.setItem(getStorageKey(), JSON.stringify(firebaseData));
                    renderEvidence();
                    await updateProgress(firebaseData);
                }
            }
        } catch (error) {
            console.error('Error checking for updates:', error);
        }
    }

    setTimeout(() => {
        setupRealtimeListener();
    }, 500);
    
    setTimeout(() => {
        setupResultsListener();
    }, 1000);
});

window.addEventListener('resize', () => {
    const table = document.getElementById('resultsTable');
    const cards = document.getElementById('resultsCards');
    
    if (table && cards) {
        if (window.innerWidth > 768) {
            table.style.display = 'table';
            cards.style.display = 'none';
        } else {
            table.style.display = 'none';
            cards.style.display = 'block';
        }
    }
});

window.addEventListener('beforeunload', () => {
    stopTimer();
    if (firestoreUnsubscribe) {
        firestoreUnsubscribe();
    }
    if (resultsUnsubscribe) {
        resultsUnsubscribe();
    }
});


</script>

</body>
</html>
