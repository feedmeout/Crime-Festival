<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - Crime Festival 2025</title>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, getDocs, collection, onSnapshot, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyA_9_40aa_wO_19g-1bIrSB6742aMOPwjo",
            authDomain: "crime-festival-2025.firebaseapp.com",
            projectId: "crime-festival-2025",
            storageBucket: "crime-festival-2025.firebasestorage.app",
            messagingSenderId: "663770004335",
            appId: "1:663770004335:web:e42dbd983ab9b5277bc69a"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.firebaseDB = db;
        window.firebaseGetDocs = getDocs;
        window.firebaseCollection = collection;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseDoc = doc;
        window.firebaseGetDoc = getDoc;
        
        console.log("✅ Firebase connected!");
        
        function checkFirestoreConnection() {
            if (!window.firebaseDB) return false;
            
            const testRef = window.firebaseDoc(window.firebaseDB, 'config', 'test');
            window.firebaseGetDoc(testRef)
                .then(() => {
                    console.log('🟢 Firestore connection active');
                    showSyncStatus('✅ Connected', 'success');
                })
                .catch((error) => {
                    console.error('🔴 Firestore connection failed:', error);
                    showSyncStatus('⚠️ Connection issues', 'error');
                });
        }
        
        setInterval(checkFirestoreConnection, 30000);
        
        setTimeout(() => {
            setupRealtimeListener();
        }, 500);
    </script>
    
    
    <link rel="stylesheet" href="../css/leaderboard.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 ΠΙΝΑΚΑΣ ΚΑΤΑΤΑΞΗΣ</h1>
        </div>

        <div class="action-bar">
            <a href="admin.html" class="btn btn-secondary">⬅️ ADMIN PANEL</a>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3>Σύνολο Υποβολών</h3>
                <div class="value">-</div>
            </div>
            <div class="stat-card">
                <h3>Τέλειες Λύσεις</h3>
                <div class="value">-</div>
            </div>
            <div class="stat-card">
                <h3>Μέσος Όρος Βαθμών</h3>
                <div class="value">-</div>
            </div>
            <div class="stat-card">
                <h3>Μέσος Χρόνος</h3>
                <div class="value" style="font-size: clamp(16px, 4vw, 20px);">-</div>
            </div>
        </div>

        <div class="leaderboard">
            <h2>🏆 ΚΑΤΑΤΑΞΗ ΟΜΑΔΩΝ</h2>
            
            <div class="table-container">
                <table class="leaderboard-table" id="leaderboardTable">
                    <thead>
                        <tr>
                            <th>Θέση</th>
                            <th>Ομάδα</th>
                            <th>Βαθμολογία</th>
                            <th>Τίτλος</th>
                            <th>Δράστες</th>
                            <th>Χρόνος</th>
                            <th>Prompts</th>
                            <th>Ενέργειες</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                                Φόρτωση δεδομένων...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="mobile-cards" id="mobileCards">
                <div style="text-align: center; padding: 40px; color: #666;">
                    Φόρτωση δεδομένων...
                </div>
            </div>
        </div>
    </div>

    <div id="solutionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTeamName">Λύση Ομάδας</h2>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <div id="syncStatus">🔴 Connected - Real-time sync active</div>

    
    <script src="../js/leaderboard.js"></script>
</body>
</html>