const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `11207index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `12598index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `13510index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `20559index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `21950index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `22862index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `const StorageManager = {
    saveAuth(teamCode, memberName) {
        localStorage.setItem('teamCode', teamCode);
        localStorage.setItem('memberName', memberName);
        localStorage.setItem('memberAuth', 'true');
        localStorage.setItem('lastLogin', new Date().toISOString());
        
        sessionStorage.setItem('teamCode', teamCode);
        sessionStorage.setItem('memberName', memberName);
        sessionStorage.setItem('sessionActive', 'true');
        sessionStorage.setItem('sessionStart', new Date().toISOString());
        
        console.log('âœ… Auth saved to both storages');
    },
    
    getAuth() {
        let teamCode = sessionStorage.getItem('teamCode') || localStorage.getItem('teamCode');
        let memberName = sessionStorage.getItem('memberName') || localStorage.getItem('memberName');
        return { teamCode, memberName };
    },
    
    isAuthenticated() {
        const hasLocalAuth = localStorage.getItem('memberAuth') === 'true';
        const hasTeamCode = localStorage.getItem('teamCode') !== null;
        return hasLocalAuth && hasTeamCode;
    }
};

function showAlert(message, type = 'error') {
    const alertBox = document.getElementById('alertBox');
    alertBox.innerHTML = `
        <div class="alert alert-${type}">
            ${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${message}
        </div>
    `;
    
    setTimeout(() => {
        alertBox.innerHTML = '';
    }, 5000);
}

function setLoading(isLoading) {
    const btn = document.getElementById('enterBtn');
    const teamInput = document.getElementById('teamName');
    const memberInput = document.getElementById('memberName');
    const passwordInput = document.getElementById('teamPassword');
    
    if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span>Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·...';
        teamInput.disabled = true;
        memberInput.disabled = true;
        passwordInput.disabled = true;
    } else {
        btn.disabled = false;
        btn.innerHTML = 'Î•ÎÎ‘Î¡ÎÎ— ÎœÎ¥Î£Î¤Î—Î¡Î™ÎŸÎ¥';
        teamInput.disabled = false;
        memberInput.disabled = false;
        passwordInput.disabled = false;
    }
}

async function enterGame(event) {
    event.preventDefault();
    
    const teamName = document.getElementById('teamName').value.trim().toLowerCase();
    const memberName = document.getElementById('memberName').value.trim();
    const password = document.getElementById('teamPassword').value.trim();

    if (!teamName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }

    if (!memberName) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ±Ï‚!');
        return;
    }

    if (!password) {
        showAlert('Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚!');
        return;
    }
    
    if (!window.firebaseReady) {
        showAlert('Î‘Î½Î±Î¼Î¿Î½Î® ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚... Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.', 'info');
        return;
    }

    setLoading(true);

    try {
        const docRef = window.firebaseDoc(window.firebaseDB, 'teams', teamName);
        const docSnap = await window.firebaseGetDoc(docRef);

        if (!docSnap.exists()) {
            setLoading(false);
            showAlert(`Î— Î¿Î¼Î¬Î´Î± "${teamName}" Î´ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ! Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÏ„Îµ Î¼Îµ Ï„Î¿Î½ Î´Î¹Î¿ÏÎ³Î±Î½Ï‰Ï„Î®.`);
            return;
        }

        const teamData = docSnap.data();
        
        // ğŸ” DEBUG: Log what we got from Firebase
        console.log('=== TEAM LOGIN DEBUG ===');
        console.log('Team name:', teamName);
        console.log('Full team data:', teamData);
        console.log('testingMode value:', teamData.testingMode);
        console.log('testingMode type:', typeof teamData.testingMode);
        console.log('All team keys:', Object.keys(teamData));
        console.log('========================');

        if (!teamData.password || teamData.password !== password) {
            setLoading(false);
            showAlert('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚! Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
            document.getElementById('teamPassword').value = '';
            document.getElementById('teamPassword').focus();
            return;
        }

        StorageManager.saveAuth(teamName, memberName);

        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');

        // âœ… ROBUST TESTING MODE CHECK
        // Check for multiple possible truthy values
        const isTestingMode = teamData.testingMode === true || 
                             teamData.testingMode === 'true' || 
                             teamData.testingMode === 1 ||
                             teamData.testingMode === '1';
        
        console.log('ğŸ§ª Testing mode check:', isTestingMode);

        if (isTestingMode) {
            console.log(`âœ… Testing mode ACTIVE for team ${teamName}`);
            console.log('ğŸš€ Bypassing all survey requirements');
            
            // Show confirmation alert so user knows testing mode is working
            setLoading(false);
            alert('ğŸ§ª Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î”ÎŸÎšÎ™ÎœÎ©Î Î•ÎÎ•Î¡Î“Î—\n\nÎ Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÏÏ‰Ï„Î·Î¼Î±Ï„Î¿Î»Î¿Î³Î¯Ï‰Î½...');
            setLoading(true);
            
            // Wait a moment then redirect
            setTimeout(() => {
                if (redirectUrl) {
                    console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                    window.location.href = redirectUrl;
                } else {
                    console.log('ğŸ”„ Redirecting to index.html');
                    window.location.href = `29432index.html?team=${teamName}`;
                }
            }, 500);
            return;
        }

        // âŒ NORMAL MODE: Survey requirement enforced
        console.log('ğŸ“‹ Normal mode - checking survey requirements');
        
        const preSurveyDoc = `${teamName}_pre_${memberName}`;
        const preSurveyRef = window.firebaseDoc(window.firebaseDB, 'surveys', preSurveyDoc);
        const preSurveySnap = await window.firebaseGetDoc(preSurveyRef);

        if (!preSurveySnap.exists()) {
            console.log('âŒ Pre-survey not found - redirecting to survey');
            setLoading(false);
            alert('Î ÏÏÏ„Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎºÎ±Ï„Î±ÏÎºÏ„Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±!');
            
            const surveyUrl = `survey.html?team=${teamName}&member=${encodeURIComponent(memberName)}&type=pre`;
            
            if (redirectUrl) {
                window.location.href = `${surveyUrl}&redirect=${encodeURIComponent(redirectUrl)}`;
            } else {
                window.location.href = surveyUrl;
            }
        } else {
            console.log(`âœ… Member authenticated: ${teamName}/${memberName}`);
            
            if (redirectUrl) {
                console.log(`ğŸ”„ Redirecting to: ${redirectUrl}`);
                window.location.href = redirectUrl;
            } else {
                window.location.href = `30823index.html?team=${teamName}`;
            }
        }

    } catch (error) {
        setLoading(false);
        console.error('âŒ Login error:', error);
        showAlert('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚. Î Î±ÏÎ±ÎºÎ±Î»Ï Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬.');
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (StorageManager.isAuthenticated()) {
        const { teamCode: storedTeam } = StorageManager.getAuth();
        console.log('Already authenticated, checking for redirect...');
        
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect');
        
        if (redirectUrl) {
            console.log(`ğŸ”„ Already logged in, redirecting to: ${redirectUrl}`);
            window.location.href = redirectUrl;
        } else {
            console.log('Already logged in, redirecting to index...');
            window.location.href = `31735index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});index.html?team=${storedTeam}`;
        }
    }
});